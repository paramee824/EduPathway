<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factory Legend: Rise of the Machinist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Kanit:wght@300;400;600;700&display=swap');
        
        body { font-family: 'Kanit', sans-serif; }
        .orbitron { font-family: 'Orbitron', monospace; }
        
        @keyframes machineWork {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        @keyframes sparks {
            0% { opacity: 0; transform: scale(0.5) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.8) rotate(360deg); }
        }
        
        @keyframes metalGlow {
            0%, 100% { box-shadow: 0 0 20px #ff6b35, inset 0 0 20px #ff6b35; }
            50% { box-shadow: 0 0 40px #ff4500, inset 0 0 30px #ff4500; }
        }
        
        @keyframes precisionPulse {
            0%, 100% { box-shadow: 0 0 15px #00ff88; }
            50% { box-shadow: 0 0 30px #00ff88, 0 0 45px #00ff88; }
        }
        
        @keyframes cncProcess {
            0% { background: linear-gradient(45deg, #1a1a1a, #2a2a2a); }
            25% { background: linear-gradient(45deg, #2a2a2a, #3a3a3a); }
            50% { background: linear-gradient(45deg, #3a3a3a, #4a4a4a); }
            75% { background: linear-gradient(45deg, #4a4a4a, #3a3a3a); }
            100% { background: linear-gradient(45deg, #2a2a2a, #1a1a1a); }
        }
        
        @keyframes assemblyGlow {
            0% { filter: brightness(1) saturate(1); }
            50% { filter: brightness(1.3) saturate(1.5); }
            100% { filter: brightness(1) saturate(1); }
        }
        
        @keyframes legendaryAwaken {
            0% { transform: scale(0.5) rotateY(0deg); opacity: 0; }
            25% { transform: scale(0.7) rotateY(90deg); opacity: 0.3; }
            50% { transform: scale(0.9) rotateY(180deg); opacity: 0.6; }
            75% { transform: scale(1.1) rotateY(270deg); opacity: 0.8; }
            100% { transform: scale(1) rotateY(360deg); opacity: 1; }
        }
        
        .machine-working { animation: machineWork 2s ease-in-out; }
        .sparks-effect { animation: sparks 0.8s ease-out infinite; }
        .metal-glow { animation: metalGlow 1.5s ease-in-out infinite; }
        .precision-pulse { animation: precisionPulse 1s ease-in-out infinite; }
        .cnc-processing { animation: cncProcess 3s ease-in-out; }
        .assembly-glow { animation: assemblyGlow 2s ease-in-out infinite; }
        .legendary-awaken { animation: legendaryAwaken 4s ease-out forwards; }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .neon-border {
            border: 2px solid;
            border-image: linear-gradient(45deg, #ff6b35, #f7931e, #ffd700) 1;
        }
        
        .workshop-bg {
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 136, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        }
        
        .stage-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(51, 65, 85, 0.6));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tool-button {
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tool-button:hover {
            background: linear-gradient(145deg, rgba(37, 99, 235, 0.9), rgba(29, 78, 216, 1));
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }
        
        .danger-button {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.8), rgba(220, 38, 38, 0.9));
        }
        
        .danger-button:hover {
            background: linear-gradient(145deg, rgba(220, 38, 38, 0.9), rgba(185, 28, 28, 1));
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
        }
        
        .success-button {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.8), rgba(22, 163, 74, 0.9));
        }
        
        .success-button:hover {
            background: linear-gradient(145deg, rgba(22, 163, 74, 0.9), rgba(21, 128, 61, 1));
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 25px rgba(34, 197, 94, 0.4);
        }
        
        .measurement-display {
            background: linear-gradient(145deg, #000000, #1a1a1a);
            border: 2px solid #00ff88;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .cnc-screen {
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
            border: 3px solid #ffd700;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px #00ff00;
        }
        
        .part-slot {
            background: linear-gradient(145deg, rgba(75, 85, 99, 0.5), rgba(55, 65, 81, 0.7));
            border: 2px dashed rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .part-slot.filled {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.5));
            border: 2px solid rgba(34, 197, 94, 0.8);
        }
        
        .legendary-machine {
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2), rgba(255, 107, 53, 0.1));
            border: 3px solid;
            border-image: linear-gradient(45deg, #ffd700, #ff6b35, #ffd700) 1;
        }
    </style>
</head>
<body class="workshop-bg min-h-screen text-white overflow-x-hidden">
    <!-- Particle Background -->
    <div class="fixed inset-0 pointer-events-none">
        <div class="absolute inset-0" id="particles"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-5xl font-black mb-4 orbitron bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 bg-clip-text text-transparent">
                ‚ö° FACTORY LEGEND ‚ö°
            </h1>
            <h2 class="text-2xl font-bold mb-2 text-orange-400">Rise of the Machinist</h2>
            <p class="text-lg text-gray-300 max-w-2xl mx-auto">
                ‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô ‡∏ú‡πà‡∏≤‡∏ô 5 ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏∏‡∏Å‡∏î‡πâ‡∏≤‡∏ô
            </p>
        </header>

        <!-- Progress System -->
        <div class="mb-8 stage-card rounded-xl p-6 hidden" id="progressSystem">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center space-x-4">
                    <h3 class="text-xl font-bold orbitron">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h3>
                    <button onclick="goHomeHandler()" class="danger-button px-4 py-2 rounded-lg font-bold text-sm">
                        üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                    </button>
                    <button onclick="restartHandler()" class="tool-button px-4 py-2 rounded-lg font-bold text-sm">
                        üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-center">
                        <div class="text-sm text-gray-400">‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                        <div class="text-2xl font-bold text-red-400 orbitron" id="timer">5:00</div>
                    </div>
                    <span class="text-lg font-bold text-yellow-400" id="progressText">‡∏î‡πà‡∏≤‡∏ô 1/5</span>
                </div>
            </div>
            <div class="relative w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 to-yellow-500 h-full rounded-full transition-all duration-1000 ease-out" 
                     id="progressBar" style="width: 20%"></div>
                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"></div>
            </div>
            <div class="flex justify-between mt-2 text-sm text-gray-400">
                <span>Metal Hero</span>
                <span>Precision Master</span>
                <span>CNC Guardian</span>
                <span>Assembly Expert</span>
                <span>Machine God</span>
            </div>
        </div>

        <!-- Score Display -->
        <div class="mb-8 grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="stage-card rounded-lg p-4 text-center">
                <div class="text-2xl mb-1">üî•</div>
                <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÇ‡∏•‡∏´‡∏∞</div>
                <div class="text-xl font-bold text-orange-400" id="machiningScore">0</div>
            </div>
            <div class="stage-card rounded-lg p-4 text-center">
                <div class="text-2xl mb-1">üìè</div>
                <div class="text-sm text-gray-400">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
                <div class="text-xl font-bold text-green-400" id="precisionScore">0</div>
            </div>
            <div class="stage-card rounded-lg p-4 text-center">
                <div class="text-2xl mb-1">ü§ñ</div>
                <div class="text-sm text-gray-400">CNC Programming</div>
                <div class="text-xl font-bold text-blue-400" id="cncScore">0</div>
            </div>
            <div class="stage-card rounded-lg p-4 text-center">
                <div class="text-2xl mb-1">‚öôÔ∏è</div>
                <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</div>
                <div class="text-xl font-bold text-purple-400" id="assemblyScore">0</div>
            </div>
        </div>

        <!-- Start Screen -->
        <div class="stage-card rounded-xl p-8 shadow-2xl text-center" id="startScreen">
            <div class="mb-8">
                <div class="text-9xl mb-6 legendary-awaken">üè≠</div>
                <h2 class="text-4xl font-bold mb-4 text-yellow-400 orbitron">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Factory Legend</h2>
                <p class="text-xl text-gray-300 mb-6 max-w-3xl mx-auto">
                    ‡πÄ‡∏Å‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‡∏ú‡πà‡∏≤‡∏ô 5 ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ 
                    ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≤‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                </p>
            </div>

            <!-- Game Rules -->
            <div class="glass-effect rounded-lg p-6 mb-8 text-left max-w-4xl mx-auto">
                <h3 class="text-2xl font-bold mb-4 text-yellow-400 text-center">üìã ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-lg font-bold mb-3 text-orange-400">‚è±Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤:</h4>
                        <ul class="space-y-2 text-gray-300 text-sm">
                            <li>‚Ä¢ ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏î‡πà‡∏≤‡∏ô‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≥‡∏Å‡∏±‡∏î 3-5 ‡∏ô‡∏≤‡∏ó‡∏µ</li>
                            <li>‚Ä¢ ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡πá‡∏ß = ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
                            <li>‚Ä¢ ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ = ‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 50%</li>
                            <li>‚Ä¢ ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î = ‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold mb-3 text-green-400">üèÜ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</h4>
                        <ul class="space-y-2 text-gray-300 text-sm">
                            <li>‚Ä¢ ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å = ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°</li>
                            <li>‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ = ‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 10%</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ = ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</li>
                            <li>‚Ä¢ ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏î‡πà‡∏≤‡∏ô = ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 50 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6 bg-blue-900 bg-opacity-30 rounded-lg p-4">
                    <h4 class="text-lg font-bold mb-2 text-blue-400">üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</h4>
                    <p class="text-gray-300 text-sm">
                        ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏î‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô 
                        ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠
                    </p>
                </div>
            </div>

            <!-- Difficulty Selection -->
            <div class="mb-8">
                <h3 class="text-xl font-bold mb-4 text-gray-300">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto">
                    <button class="difficulty-btn tool-button rounded-lg p-4" data-difficulty="easy">
                        <div class="text-3xl mb-2">üü¢</div>
                        <div class="font-bold">‡∏á‡πà‡∏≤‡∏¢</div>
                        <div class="text-xs text-gray-400 space-y-1">
                            <p>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤ +2 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
                            <p>üí° ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏´‡∏±‡∏Å -5%</p>
                            <p>üéØ ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
                            <p>üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</p>
                        </div>
                    </button>
                    <button class="difficulty-btn success-button rounded-lg p-4" data-difficulty="normal">
                        <div class="text-3xl mb-2">üü°</div>
                        <div class="font-bold">‡∏õ‡∏Å‡∏ï‡∏¥</div>
                        <div class="text-xs text-gray-400 space-y-1">
                            <p>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</p>
                            <p>üí° ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏´‡∏±‡∏Å -10%</p>
                            <p>üéØ ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏Å‡∏ï‡∏¥</p>
                            <p>üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏°‡∏î‡∏∏‡∏•</p>
                        </div>
                    </button>
                    <button class="difficulty-btn danger-button rounded-lg p-4" data-difficulty="hard">
                        <div class="text-3xl mb-2">üî¥</div>
                        <div class="font-bold">‡∏¢‡∏≤‡∏Å</div>
                        <div class="text-xs text-gray-400 space-y-1">
                            <p>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤ -2 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
                            <p>üí° ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏´‡∏±‡∏Å -15%</p>
                            <p>üéØ ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î</p>
                            <p>üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                        </div>
                    </button>
                </div>
            </div>

            <button id="startGame" class="success-button px-12 py-4 rounded-xl font-bold text-xl disabled:opacity-50" disabled>
                üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢
            </button>
        </div>

        <!-- Game Screen -->
        <div class="stage-card rounded-xl p-8 shadow-2xl hidden" id="gameScreen">
            
            <!-- Stage 1: Metal Hero -->
            <div id="stage1" class="stage">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 text-orange-400 orbitron">üî• METAL HERO</h2>
                    <p class="text-xl text-gray-300 mb-6">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏ï‡∏±‡∏î‡πÇ‡∏•‡∏´‡∏∞</p>
                </div>

                <!-- Rules Panel -->
                <div class="glass-effect rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-bold mb-3 text-yellow-400">üìã ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ <strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•‡∏∂‡∏á:</strong> ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏° ‡∏´‡∏°‡∏∏‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏µ‡∏î‡∏Å‡∏•‡∏∂‡∏á</li>
                        <li>‚Ä¢ <strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏±‡∏î:</strong> ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° ‡∏´‡∏°‡∏∏‡∏ô‡∏°‡∏µ‡∏î‡∏Å‡∏±‡∏î‡∏ï‡∏±‡∏î‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</li>
                        <li>‚Ä¢ <strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏à‡∏≤‡∏∞:</strong> ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡∏≤‡∏∞‡∏£‡∏π ‡∏´‡∏°‡∏∏‡∏ô‡∏î‡∏≠‡∏Å‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</li>
                        <li class="text-yellow-300">üí° <strong>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</strong> ‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏µ!</li>
                    </ul>
                </div>

                <!-- Workpiece Display -->
                <div class="text-center mb-8">
                    <div class="inline-block stage-card rounded-lg p-8">
                        <h3 class="text-xl font-bold mb-4 text-gray-300">‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡∏•‡∏¥‡∏ï:</h3>
                        <div class="text-8xl mb-4" id="workpiece">üî©</div>
                        <p class="text-lg text-gray-400" id="workpieceDesc">‡πÄ‡∏û‡∏•‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Å‡∏•‡∏° ‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á 50 ‡∏°‡∏°.</p>
                        <div class="mt-4 text-sm text-yellow-300">
                            <p>üìê ‡∏Ç‡∏ô‡∏≤‡∏î: √ò50 √ó 200 ‡∏°‡∏°.</p>
                            <p>üîß ‡∏ß‡∏±‡∏™‡∏î‡∏∏: ‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Å‡∏•‡πâ‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô</p>
                        </div>
                    </div>
                </div>

                <!-- Machine Selection -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button class="tool-button machine-btn rounded-xl p-6 text-center transition-all duration-300" data-machine="lathe">
                        <div class="text-6xl mb-4">üîÑ</div>
                        <h3 class="text-xl font-bold mb-2">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•‡∏∂‡∏á</h3>
                        <p class="text-sm text-gray-300 mb-3">Lathe Machine</p>
                        <div class="text-xs text-gray-400">
                            <p>‚Ä¢ ‡∏´‡∏°‡∏∏‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</p>
                            <p>‚Ä¢ ‡∏ï‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏µ‡∏î‡∏Å‡∏•‡∏∂‡∏á</p>
                            <p>‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏°</p>
                        </div>
                    </button>
                    
                    <button class="tool-button machine-btn rounded-xl p-6 text-center transition-all duration-300" data-machine="mill">
                        <div class="text-6xl mb-4">‚öôÔ∏è</div>
                        <h3 class="text-xl font-bold mb-2">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏±‡∏î</h3>
                        <p class="text-sm text-gray-300 mb-3">Milling Machine</p>
                        <div class="text-xs text-gray-400">
                            <p>‚Ä¢ ‡∏´‡∏°‡∏∏‡∏ô‡∏°‡∏µ‡∏î‡∏Å‡∏±‡∏î</p>
                            <p>‚Ä¢ ‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ô‡∏¥‡πà‡∏á</p>
                            <p>‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°</p>
                        </div>
                    </button>
                    
                    <button class="tool-button machine-btn rounded-xl p-6 text-center transition-all duration-300" data-machine="drill">
                        <div class="text-6xl mb-4">üî®</div>
                        <h3 class="text-xl font-bold mb-2">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏à‡∏≤‡∏∞</h3>
                        <p class="text-sm text-gray-300 mb-3">Drilling Machine</p>
                        <div class="text-xs text-gray-400">
                            <p>‚Ä¢ ‡∏´‡∏°‡∏∏‡∏ô‡∏î‡∏≠‡∏Å‡πÄ‡∏à‡∏≤‡∏∞</p>
                            <p>‚Ä¢ ‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</p>
                            <p>‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏≤‡∏∞‡∏£‡∏π</p>
                        </div>
                    </button>
                </div>

                <!-- Result Display -->
                <div id="stage1Result" class="text-center hidden">
                    <div id="stage1Success" class="hidden">
                        <div class="text-8xl mb-4 assembly-glow">‚ú®</div>
                        <h3 class="text-2xl font-bold text-green-400 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</h3>
                        <p class="text-lg text-gray-300 mb-4">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•‡∏∂‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏û‡∏•‡∏≤‡∏Å‡∏•‡∏°</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-yellow-400 font-bold">üèÜ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏Å +25 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                    <div id="stage1Fail" class="hidden">
                        <div class="text-8xl mb-4 sparks-effect">üí•</div>
                        <h3 class="text-2xl font-bold text-red-400 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏î! ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</h3>
                        <p class="text-lg text-gray-300 mb-4">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•‡∏∂‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏°‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-red-400 font-bold">‚ö†Ô∏è ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ +5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stage 2: Precision Master -->
            <div id="stage2" class="stage hidden">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 text-green-400 orbitron">üìè PRECISION MASTER</h2>
                    <p class="text-xl text-gray-300 mb-6">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p>
                </div>

                <!-- Rules Panel -->
                <div class="glass-effect rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-bold mb-3 text-yellow-400">üìã ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ <strong>‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏≤‡∏•‡∏¥‡πÄ‡∏õ‡∏≠‡∏£‡πå:</strong> ‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ñ‡∏∂‡∏á 0.02 ‡∏°‡∏°.</li>
                        <li>‚Ä¢ <strong>‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:</strong> ‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ñ‡∏∂‡∏á 0.01 ‡∏°‡∏°.</li>
                        <li>‚Ä¢ <strong>‡πÄ‡∏Å‡∏à‡∏ö‡∏•‡πá‡∏≠‡∏Å:</strong> ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</li>
                        <li class="text-yellow-300">üí° <strong>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</strong> ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ 25.50 ¬± 0.02 ‡∏°‡∏°.</li>
                    </ul>
                </div>

                <!-- Measurement Challenge -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="stage-card rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-center">üîß ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏±‡∏î</h3>
                        <div class="space-y-4">
                            <div class="measurement-display rounded-lg p-4 text-center">
                                <div class="text-sm text-gray-400 mb-2">‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
                                <div class="text-4xl font-bold orbitron" id="currentMeasurement">20.00</div>
                                <div class="text-lg">‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£</div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3" id="measurementButtons">
                                <button id="decreaseCoarse" class="danger-button rounded-lg py-3 font-bold">
                                    -1.0 ‡∏°‡∏°.
                                </button>
                                <button id="increaseCoarse" class="success-button rounded-lg py-3 font-bold">
                                    +1.0 ‡∏°‡∏°.
                                </button>
                                <button id="decreaseFine" class="danger-button rounded-lg py-3 font-bold">
                                    -0.1 ‡∏°‡∏°.
                                </button>
                                <button id="increaseFine" class="success-button rounded-lg py-3 font-bold">
                                    +0.1 ‡∏°‡∏°.
                                </button>
                                <button id="decreasePrecise" class="danger-button rounded-lg py-3 font-bold">
                                    -0.01 ‡∏°‡∏°.
                                </button>
                                <button id="increasePrecise" class="success-button rounded-lg py-3 font-bold">
                                    +0.01 ‡∏°‡∏°.
                                </button>
                            </div>
                            
                            <button id="measureBtn" class="tool-button w-full rounded-lg py-4 font-bold text-lg">
                                üìê ‡∏ß‡∏±‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô
                            </button>
                        </div>
                    </div>
                    
                    <div class="stage-card rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-center">üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h3>
                        <div class="text-center">
                            <div class="text-6xl mb-4">üî©</div>
                            <h4 class="text-lg font-bold mb-2">‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏•‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</h4>
                            <div class="bg-yellow-900 bg-opacity-30 rounded-lg p-4 mb-4">
                                <p class="text-yellow-300 font-bold text-xl">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: 25.50 ‡∏°‡∏°.</p>
                                <p class="text-sm text-gray-400">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô: ¬± 0.02 ‡∏°‡∏°.</p>
                            </div>
                            <div class="text-sm text-gray-400 space-y-1">
                                <p>üìè ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ:</p>
                                <p>25.48 - 25.52 ‡∏°‡∏°.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Result Display -->
                <div id="stage2Result" class="text-center hidden">
                    <div id="stage2Success" class="hidden">
                        <div class="text-8xl mb-4 precision-pulse">üéØ</div>
                        <h3 class="text-2xl font-bold text-green-400 mb-4">‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!</h3>
                        <p class="text-lg text-gray-300 mb-4">‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-yellow-400 font-bold">üèÜ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ +30 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                    <div id="stage2Fail" class="hidden">
                        <div class="text-8xl mb-4 sparks-effect">‚ö°</div>
                        <h3 class="text-2xl font-bold text-red-400 mb-4">‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥!</h3>
                        <p class="text-lg text-gray-300 mb-4">‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-red-400 font-bold">‚ö†Ô∏è ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô +10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stage 3: CNC Guardian -->
            <div id="stage3" class="stage hidden">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 text-blue-400 orbitron">ü§ñ CNC GUARDIAN</h2>
                    <p class="text-xl text-gray-300 mb-6">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° CNC</p>
                </div>

                <!-- Rules Panel -->
                <div class="glass-effect rounded-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-yellow-400">üìã ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</h3>
                        <button id="showCNCHint" class="tool-button px-4 py-2 rounded-lg text-sm font-bold">
                            üí° ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ (-10%)
                        </button>
                    </div>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ <strong>G-Code:</strong> ‡∏†‡∏≤‡∏©‡∏≤‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á CNC</li>
                        <li>‚Ä¢ <strong>‡πÅ‡∏Å‡∏ô X,Y,Z:</strong> ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</li>
                        <li>‚Ä¢ <strong>Feed Rate:</strong> ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô (mm/min)</li>
                        <li>‚Ä¢ <strong>Spindle Speed:</strong> ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏Å‡∏ô‡∏´‡∏°‡∏∏‡∏ô (RPM)</li>
                        <li class="text-yellow-300">üí° <strong>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> ‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° 50√ó50 ‡∏°‡∏°. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å (0,0)</li>
                    </ul>
                    
                    <!-- Hidden Hint Panel -->
                    <div id="cncHintPanel" class="hidden mt-4 bg-yellow-900 bg-opacity-30 rounded-lg p-4 border border-yellow-500">
                        <h4 class="text-yellow-400 font-bold mb-2">üîç ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞:</h4>
                        <div class="text-sm text-yellow-200 space-y-1">
                            <p>‚Ä¢ <strong>X = 50, Y = 50</strong> (‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°)</p>
                            <p>‚Ä¢ <strong>Feed Rate = 300</strong> (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)</p>
                            <p>‚Ä¢ <strong>Spindle Speed = 1200</strong> (RPM ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö End Mill)</p>
                            <p>‚Ä¢ <strong>Tool = End Mill √ò10mm</strong> (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏î)</p>
                        </div>
                    </div>
                </div>

                <!-- CNC Programming Interface -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="stage-card rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-center">‚å®Ô∏è CNC Control Panel</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-gray-300">‡πÅ‡∏Å‡∏ô X (‡∏°‡∏°.)</label>
                                    <input type="number" id="xAxis" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white" value="0" min="0" max="100">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-gray-300">‡πÅ‡∏Å‡∏ô Y (‡∏°‡∏°.)</label>
                                    <input type="number" id="yAxis" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white" value="0" min="0" max="100">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-gray-300">Feed Rate (mm/min)</label>
                                    <select id="feedRate" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                                        <option value="100">100</option>
                                        <option value="200">200</option>
                                        <option value="300">300</option>
                                        <option value="500">500</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-gray-300">Spindle Speed (RPM)</label>
                                    <select id="spindleSpeed" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                                        <option value="800">800</option>
                                        <option value="1000">1000</option>
                                        <option value="1200">1200</option>
                                        <option value="1500">1500</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-2 text-gray-300">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡∏î</label>
                                <select id="toolSelection" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                                    <option value="endmill6">End Mill √ò6mm</option>
                                    <option value="endmill10">End Mill √ò10mm</option>
                                    <option value="endmill12">End Mill √ò12mm</option>
                                </select>
                            </div>
                            
                            <button id="runCNC" class="danger-button w-full rounded-lg py-4 font-bold text-lg">
                                üöÄ RUN CNC PROGRAM
                            </button>
                        </div>
                    </div>
                    
                    <div class="stage-card rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-center">üì∫ CNC Monitor</h3>
                        <div id="cncDisplay" class="cnc-screen rounded-lg p-6 h-64 flex flex-col justify-center items-center">
                            <div class="text-center">
                                <div class="text-2xl mb-2">üü¢ SYSTEM READY</div>
                                <div class="text-sm">CNC Machine Online</div>
                                <div class="text-xs mt-4 text-gray-400">
                                    <p>Target: Rectangle 50√ó50mm</p>
                                    <p>Material: Aluminum 6061</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <div class="text-sm text-gray-400 mb-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                            <div class="bg-blue-900 bg-opacity-30 rounded-lg p-4">
                                <div class="text-4xl mb-2">‚¨ú</div>
                                <p class="text-blue-300 font-bold">‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™ 50√ó50 ‡∏°‡∏°.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Result Display -->
                <div id="stage3Result" class="text-center hidden">
                    <div id="stage3Success" class="hidden">
                        <div class="text-8xl mb-4 assembly-glow">üè≠</div>
                        <h3 class="text-2xl font-bold text-green-400 mb-4">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                        <p class="text-lg text-gray-300 mb-4">CNC ‡∏ú‡∏•‡∏¥‡∏ï‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-yellow-400 font-bold">üèÜ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ CNC +35 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                    <div id="stage3Fail" class="hidden">
                        <div class="text-8xl mb-4 sparks-effect">üí•</div>
                        <h3 class="text-2xl font-bold text-red-400 mb-4">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!</h3>
                        <p class="text-lg text-gray-300 mb-4">‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-red-400 font-bold">‚ö†Ô∏è ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ +15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stage 4: Assembly Expert -->
            <div id="stage4" class="stage hidden">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 text-purple-400 orbitron">‚öôÔ∏è ASSEMBLY EXPERT</h2>
                    <p class="text-xl text-gray-300 mb-6">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏•</p>
                </div>

                <!-- Rules Panel -->
                <div class="glass-effect rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-bold mb-3 text-yellow-400">üìã ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ <strong>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö:</strong> ‡∏ê‡∏≤‡∏ô ‚Üí ‡πÄ‡∏û‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏Å ‚Üí ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå ‚Üí ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå</li>
                        <li>‚Ä¢ <strong>‡∏Å‡∏≤‡∏£‡∏¢‡∏∂‡∏î‡∏ï‡∏¥‡∏î:</strong> ‡πÉ‡∏ä‡πâ‡∏™‡∏Å‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡πá‡∏≠‡∏ï‡∏¢‡∏∂‡∏î‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡∏ô</li>
                        <li>‚Ä¢ <strong>‡∏Å‡∏≤‡∏£‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô:</strong> ‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</li>
                        <li class="text-yellow-300">üí° <strong>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</strong> ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</li>
                    </ul>
                </div>

                <!-- Assembly Interface -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="stage-card rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-center">üîß ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ</h3>
                        <div class="space-y-3" id="availableParts">
                            <div class="part-item bg-gray-700 rounded-lg p-4 flex items-center justify-between" data-part="base">
                                <div class="flex items-center space-x-3">
                                    <div class="text-3xl">üèóÔ∏è</div>
                                    <div>
                                        <div class="font-bold">‡∏ê‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</div>
                                        <div class="text-sm text-gray-400">Machine Base</div>
                                    </div>
                                </div>
                                <button class="part-btn success-button px-4 py-2 rounded-lg font-bold">‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</button>
                            </div>
                            
                            <div class="part-item bg-gray-700 rounded-lg p-4 flex items-center justify-between" data-part="shaft">
                                <div class="flex items-center space-x-3">
                                    <div class="text-3xl">üî©</div>
                                    <div>
                                        <div class="font-bold">‡πÄ‡∏û‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏Å</div>
                                        <div class="text-sm text-gray-400">Main Shaft</div>
                                    </div>
                                </div>
                                <button class="part-btn success-button px-4 py-2 rounded-lg font-bold">‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</button>
                            </div>
                            
                            <div class="part-item bg-gray-700 rounded-lg p-4 flex items-center justify-between" data-part="gear">
                                <div class="flex items-center space-x-3">
                                    <div class="text-3xl">‚öôÔ∏è</div>
                                    <div>
                                        <div class="font-bold">‡∏ä‡∏∏‡∏î‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå</div>
                                        <div class="text-sm text-gray-400">Gear Set</div>
                                    </div>
                                </div>
                                <button class="part-btn success-button px-4 py-2 rounded-lg font-bold">‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</button>
                            </div>
                            
                            <div class="part-item bg-gray-700 rounded-lg p-4 flex items-center justify-between" data-part="motor">
                                <div class="flex items-center space-x-3">
                                    <div class="text-3xl">üîå</div>
                                    <div>
                                        <div class="font-bold">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå</div>
                                        <div class="text-sm text-gray-400">Electric Motor</div>
                                    </div>
                                </div>
                                <button class="part-btn success-button px-4 py-2 rounded-lg font-bold">‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stage-card rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-center">üè≠ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</h3>
                        <div id="machineAssembly" class="text-center space-y-4">
                            <div class="part-slot rounded-lg p-4 h-16 flex items-center justify-center" id="slot-motor">
                                <span class="text-gray-500">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå (4)</span>
                            </div>
                            <div class="part-slot rounded-lg p-4 h-16 flex items-center justify-center" id="slot-gear">
                                <span class="text-gray-500">‡∏ä‡∏∏‡∏î‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå (3)</span>
                            </div>
                            <div class="part-slot rounded-lg p-4 h-16 flex items-center justify-center" id="slot-shaft">
                                <span class="text-gray-500">‡πÄ‡∏û‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏Å (2)</span>
                            </div>
                            <div class="part-slot rounded-lg p-4 h-16 flex items-center justify-center" id="slot-base">
                                <span class="text-gray-500">‡∏ê‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (1)</span>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button id="testMachine" class="tool-button px-8 py-3 rounded-lg font-bold text-lg hidden">
                                ‚ö° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Result Display -->
                <div id="stage4Result" class="text-center hidden">
                    <div id="stage4Success" class="hidden">
                        <div class="text-8xl mb-4 assembly-glow">‚ú®</div>
                        <h3 class="text-2xl font-bold text-green-400 mb-4">‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                        <p class="text-lg text-gray-300 mb-4">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-yellow-400 font-bold">üèÜ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå +40 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                    <div id="stage4Fail" class="hidden">
                        <div class="text-8xl mb-4 sparks-effect">‚ö†Ô∏è</div>
                        <h3 class="text-2xl font-bold text-red-400 mb-4">‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö!</h3>
                        <p class="text-lg text-gray-300 mb-4">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</p>
                        <div class="stage-card rounded-lg p-4 inline-block">
                            <p class="text-red-400 font-bold">‚ö†Ô∏è ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå +20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stage 5: Machine God -->
            <div id="stage5" class="stage hidden">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 text-yellow-400 orbitron">üëë MACHINE GOD</h2>
                    <p class="text-xl text-gray-300 mb-6">‡∏î‡πà‡∏≤‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏±‡∏Å‡∏©‡πå</p>
                </div>

                <!-- Rules Panel -->
                <div class="glass-effect rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-bold mb-3 text-yellow-400">üìã ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢:</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ <strong>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏±‡∏Å‡∏©‡πå:</strong> ‡∏ú‡∏•‡∏¥‡∏ï‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</li>
                        <li>‚Ä¢ <strong>‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:</strong> ‡πÄ‡∏à‡∏≤‡∏∞ ‚Üí ‡∏Å‡∏±‡∏î ‚Üí ‡∏Å‡∏•‡∏∂‡∏á</li>
                        <li>‚Ä¢ <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</strong> ‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</li>
                        <li class="text-yellow-300">üí° <strong>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</strong> ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°!</li>
                    </ul>
                </div>

                <!-- Legendary Machine Display -->
                <div class="text-center mb-8">
                    <div class="legendary-machine rounded-xl p-8 inline-block">
                        <div id="legendaryMachine" class="text-9xl mb-4 legendary-awaken">üè≠</div>
                        <h3 class="text-3xl font-bold text-yellow-400 mb-2 orbitron">LEGENDARY CNC CENTER</h3>
                        <p class="text-lg text-gray-300">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏•‡πÉ‡∏ô‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô</p>
                    </div>
                </div>

                <!-- Machine Operations -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button class="operation-btn tool-button rounded-xl p-6 text-center transition-all duration-300" data-operation="drill">
                        <div class="text-6xl mb-4">üî©</div>
                        <h3 class="text-xl font-bold mb-2">‡πÄ‡∏à‡∏≤‡∏∞‡∏£‡∏π‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</h3>
                        <p class="text-sm text-gray-300 mb-3">Precision Drilling</p>
                        <div class="text-xs text-gray-400">
                            <p>‚Ä¢ ‡πÄ‡∏à‡∏≤‡∏∞‡∏£‡∏π √ò20mm</p>
                            <p>‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å 50mm</p>
                            <p>‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ¬±0.01mm</p>
                        </div>
                    </button>
                    
                    <button class="operation-btn tool-button rounded-xl p-6 text-center transition-all duration-300" data-operation="mill">
                        <div class="text-6xl mb-4">‚öôÔ∏è</div>
                        <h3 class="text-xl font-bold mb-2">‡∏Å‡∏±‡∏î‡∏£‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏≤</h3>
                        <p class="text-sm text-gray-300 mb-3">Shaft Milling</p>
                        <div class="text-xs text-gray-400">
                            <p>‚Ä¢ ‡∏Å‡∏±‡∏î‡∏£‡πà‡∏≠‡∏á‡∏Å‡∏∏‡∏ç‡πÅ‡∏à</p>
                            <p>‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á 8mm</p>
                            <p>‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å 4mm</p>
                        </div>
                    </button>
                    
                    <button class="operation-btn tool-button rounded-xl p-6 text-center transition-all duration-300" data-operation="lathe">
                        <div class="text-6xl mb-4">üîÑ</div>
                        <h3 class="text-xl font-bold mb-2">‡∏Å‡∏•‡∏∂‡∏á‡∏ú‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö</h3>
                        <p class="text-sm text-gray-300 mb-3">Surface Turning</p>
                        <div class="text-xs text-gray-400">
                            <p>‚Ä¢ ‡∏ú‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö Ra 0.8</p>
                            <p>‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ IT7</p>
                            <p>‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 200mm</p>
                        </div>
                    </button>
                </div>

                <!-- Operation Status -->
                <div class="stage-card rounded-lg p-6 mb-8">
                    <h3 class="text-xl font-bold mb-4 text-center">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-4xl mb-2" id="drillStatus">‚≠ï</div>
                            <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏≤‡∏∞</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl mb-2" id="millStatus">‚≠ï</div>
                            <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏î</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl mb-2" id="latheStatus">‚≠ï</div>
                            <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∂‡∏á</div>
                        </div>
                    </div>
                </div>

                <!-- Result Display -->
                <div id="stage5Result" class="text-center hidden">
                    <div class="text-8xl mb-6 assembly-glow">üèÜ</div>
                    <h3 class="text-4xl font-bold text-yellow-400 mb-4 orbitron">YOU ARE THE FACTORY LEGEND!</h3>
                    <p class="text-xl text-gray-300 mb-6">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô!</p>
                    <div class="legendary-machine rounded-xl p-6 inline-block">
                        <p class="text-2xl font-bold text-yellow-400 mb-2">üéâ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
                        <p class="text-lg text-gray-300">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏±‡∏Å‡∏©‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö</p>
                    </div>
                </div>
            </div>

            <!-- Final Results -->
            <div id="finalResults" class="hidden">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-4 text-yellow-400 orbitron">üèÜ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                    <p class="text-xl text-gray-300">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
                </div>
                
                <div class="stage-card rounded-xl p-8">
                    <div id="careerResult" class="text-center">
                        <div class="text-8xl mb-6" id="careerIcon">üéØ</div>
                        <h3 class="text-3xl font-bold mb-4 orbitron" id="careerTitle"></h3>
                        <p class="text-lg text-gray-300 mb-6 max-w-2xl mx-auto" id="careerDescription"></p>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            <div class="bg-orange-900 bg-opacity-30 rounded-lg p-4">
                                <div class="text-2xl mb-2">üî•</div>
                                <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÇ‡∏•‡∏´‡∏∞</div>
                                <div class="text-2xl font-bold text-orange-400" id="finalMachiningScore">0</div>
                            </div>
                            <div class="bg-green-900 bg-opacity-30 rounded-lg p-4">
                                <div class="text-2xl mb-2">üìè</div>
                                <div class="text-sm text-gray-400">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
                                <div class="text-2xl font-bold text-green-400" id="finalPrecisionScore">0</div>
                            </div>
                            <div class="bg-blue-900 bg-opacity-30 rounded-lg p-4">
                                <div class="text-2xl mb-2">ü§ñ</div>
                                <div class="text-sm text-gray-400">CNC Programming</div>
                                <div class="text-2xl font-bold text-blue-400" id="finalCncScore">0</div>
                            </div>
                            <div class="bg-purple-900 bg-opacity-30 rounded-lg p-4">
                                <div class="text-2xl mb-2">‚öôÔ∏è</div>
                                <div class="text-sm text-gray-400">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</div>
                                <div class="text-2xl font-bold text-purple-400" id="finalAssemblyScore">0</div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-900 bg-opacity-30 rounded-lg p-6 mb-6">
                            <h4 class="text-xl font-bold mb-4 text-yellow-400">üéì ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠:</h4>
                            <div id="recommendations" class="text-left space-y-2 text-gray-300"></div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-8 space-x-4">
                    <button onclick="homeFromResultsHandler()" class="danger-button px-8 py-4 rounded-xl font-bold text-lg">
                        üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                    </button>
                    <button onclick="restartGameHandler()" class="tool-button px-8 py-4 rounded-xl font-bold text-lg">
                        üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </div>
        </div>

        <!-- Next Stage Button -->
        <div class="text-center mt-8">
            <button id="nextStage" class="success-button px-8 py-4 rounded-xl font-bold text-lg hidden">
                ‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚Üí
            </button>
        </div>
    </div>

    <script>
        // Game State
        let gameStarted = false;
        let currentStage = 1;
        let difficulty = 'normal';
        let scores = {
            machining: 0,
            precision: 0,
            cnc: 0,
            assembly: 0
        };
        let stageCompleted = [false, false, false, false, false];
        let stageTimers = [300, 240, 300, 240, 180]; // 5min, 4min, 5min, 4min, 3min
        let currentTimer = 0;
        let timerInterval = null;
        let hintsUsed = [];
        let wrongAnswers = 0;
        let startTime = 0;

        // Initialize particles
        function createParticles() {
            const particles = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'absolute w-1 h-1 bg-yellow-400 rounded-full opacity-30';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 3 + 's';
                particle.style.animation = 'float 6s ease-in-out infinite';
                particles.appendChild(particle);
            }
        }

        // Start Game System
        function initStartScreen() {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-btn').forEach(b => {
                        b.classList.remove('ring-4', 'ring-yellow-400');
                    });
                    this.classList.add('ring-4', 'ring-yellow-400');
                    difficulty = this.dataset.difficulty;
                    document.getElementById('startGame').disabled = false;
                });
            });

            document.getElementById('startGame').addEventListener('click', function() {
                startGame();
            });
        }

        function startGame() {
            gameStarted = true;
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('progressSystem').classList.remove('hidden');
            
            // Adjust timers and scoring based on difficulty
            if (difficulty === 'easy') {
                stageTimers = [420, 360, 420, 360, 300]; // +2 minutes each
            } else if (difficulty === 'hard') {
                stageTimers = [180, 120, 180, 120, 90]; // -2 minutes each
            } else {
                stageTimers = [300, 240, 300, 240, 180]; // normal
            }
            
            startTime = Date.now();
            randomizeQuestions(); // Generate new questions
            updateProgress();
            showStage(1);
        }

        // Timer System
        function startTimer(seconds) {
            currentTimer = seconds;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                currentTimer--;
                updateTimerDisplay();
                
                if (currentTimer <= 30) {
                    document.getElementById('timer').classList.add('text-red-500', 'animate-pulse');
                }
                
                if (currentTimer <= 0) {
                    clearInterval(timerInterval);
                    handleTimeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(currentTimer / 60);
            const seconds = currentTimer % 60;
            document.getElementById('timer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function handleTimeUp() {
            // Reduce score by 50% for timeout
            const currentStageScore = getCurrentStageScore();
            reduceScore(Math.floor(currentStageScore * 0.5));
            
            // Show timeout message and move to next stage
            showTimeoutMessage();
        }

        function showTimeoutMessage() {
            const timeoutDiv = document.createElement('div');
            timeoutDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            timeoutDiv.innerHTML = `
                <div class="bg-red-900 bg-opacity-90 rounded-xl p-8 text-center max-w-md">
                    <div class="text-6xl mb-4">‚è∞</div>
                    <h3 class="text-2xl font-bold text-red-400 mb-4">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!</h3>
                    <p class="text-gray-300 mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡πÑ‡∏õ 50%</p>
                    <button class="success-button px-6 py-3 rounded-lg font-bold" onclick="this.parentElement.parentElement.remove(); nextStageAuto();">
                        ‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ
                    </button>
                </div>
            `;
            document.body.appendChild(timeoutDiv);
        }

        function getCurrentStageScore() {
            const stageScores = [scores.machining, scores.precision, scores.cnc, scores.assembly, 0];
            return stageScores[currentStage - 1] || 0;
        }

        function reduceScore(amount) {
            if (currentStage === 1) scores.machining = Math.max(0, scores.machining - amount);
            else if (currentStage === 2) scores.precision = Math.max(0, scores.precision - amount);
            else if (currentStage === 3) scores.cnc = Math.max(0, scores.cnc - amount);
            else if (currentStage === 4) scores.assembly = Math.max(0, scores.assembly - amount);
            updateScoreDisplay();
        }

        function nextStageAuto() {
            if (currentStage < 5) {
                currentStage++;
                updateProgress();
                showStage(currentStage);
            } else {
                showFinalResults();
            }
        }

        // Stage 1: Metal Hero
        function initStage1() {
            clearInterval(timerInterval);
            startTimer(stageTimers[0]);
            
            // Update workpiece display with current question
            const question = currentQuestions.stage1;
            document.getElementById('workpiece').textContent = question.workpiece;
            document.getElementById('workpieceDesc').textContent = question.desc;
            document.querySelector('#stage1 .text-sm.text-yellow-300').innerHTML = question.details;
            
            // Reset stage 1 elements
            document.querySelectorAll('.machine-btn').forEach(b => {
                b.disabled = false;
                b.classList.remove('machine-working', 'sparks-effect');
            });
            document.getElementById('stage1Result').classList.add('hidden');
            document.getElementById('stage1Success').classList.add('hidden');
            document.getElementById('stage1Fail').classList.add('hidden');
            
            // Remove existing listeners and add fresh ones
            document.querySelectorAll('.machine-btn').forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.replaceWith(newBtn);
            });
            
            document.querySelectorAll('.machine-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const machine = this.dataset.machine;
                    const result = document.getElementById('stage1Result');
                    const success = document.getElementById('stage1Success');
                    const fail = document.getElementById('stage1Fail');
                    
                    clearInterval(timerInterval);
                    
                    // Disable all buttons
                    document.querySelectorAll('.machine-btn').forEach(b => b.disabled = true);
                    
                    // Add working animation
                    this.classList.add('machine-working');
                    
                    setTimeout(() => {
                        result.classList.remove('hidden');
                        
                        if (machine === question.answer) {
                            success.classList.remove('hidden');
                            fail.classList.add('hidden');
                            
                            // Calculate score with time bonus and difficulty multiplier
                            let baseScore = difficulty === 'easy' ? 20 : difficulty === 'hard' ? 35 : 25;
                            const timeBonus = Math.floor(currentTimer / 10);
                            scores.machining += baseScore + timeBonus;
                            stageCompleted[0] = true;
                        } else {
                            success.classList.add('hidden');
                            fail.classList.remove('hidden');
                            
                            let penaltyScore = difficulty === 'easy' ? 8 : difficulty === 'hard' ? 3 : 5;
                            scores.machining += penaltyScore;
                            wrongAnswers++;
                            
                            // Penalty for wrong answer
                            let penalty = difficulty === 'easy' ? 10 : difficulty === 'hard' ? 30 : 20;
                            scores.machining = Math.max(0, scores.machining - penalty);
                            
                            // Add sparks effect
                            this.classList.add('sparks-effect');
                        }
                        
                        updateScoreDisplay();
                        showNextButton();
                    }, 2000);
                });
            });
        }

        // Stage 2: Precision Master
        function initStage2() {
            clearInterval(timerInterval);
            startTimer(stageTimers[1]);
            
            // Get current question
            const question = currentQuestions.stage2;
            const targetValue = question.target;
            const tolerance = question.tolerance;
            
            // Update target display
            document.querySelector('#stage2 .text-yellow-300.font-bold.text-xl').textContent = `‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${targetValue.toFixed(2)} ‡∏°‡∏°.`;
            document.querySelector('#stage2 .text-sm.text-gray-400').textContent = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô: ¬± ${tolerance.toFixed(2)} ‡∏°‡∏°.`;
            document.querySelector('#stage2 .text-sm.text-gray-400').nextElementSibling.innerHTML = `<p>üìè ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ:</p><p>${(targetValue - tolerance).toFixed(2)} - ${(targetValue + tolerance).toFixed(2)} ‡∏°‡∏°.</p>`;
            
            let measurement = Math.random() * 10 + 15; // Random starting point
            const measurementDisplay = document.getElementById('currentMeasurement');
            
            // Reset stage 2 elements
            document.getElementById('measureBtn').disabled = false;
            document.getElementById('measureBtn').textContent = 'üìê ‡∏ß‡∏±‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô';
            document.getElementById('stage2Result').classList.add('hidden');
            document.getElementById('stage2Success').classList.add('hidden');
            document.getElementById('stage2Fail').classList.add('hidden');
            measurementDisplay.parentElement.classList.remove('precision-pulse');
            
            function updateMeasurement() {
                measurementDisplay.textContent = measurement.toFixed(2);
                if (Math.abs(measurement - targetValue) <= tolerance) {
                    measurementDisplay.parentElement.classList.add('precision-pulse');
                } else {
                    measurementDisplay.parentElement.classList.remove('precision-pulse');
                }
            }
            
            updateMeasurement(); // Initial display
            
            // Remove existing listeners and add fresh ones for measurement buttons
            const measurementBtns = ['increaseCoarse', 'decreaseCoarse', 'increaseFine', 'decreaseFine', 'increasePrecise', 'decreasePrecise', 'measureBtn'];
            measurementBtns.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.replaceWith(btn.cloneNode(true));
            });
            
            // Adjust button increments based on difficulty
            const coarseStep = difficulty === 'easy' ? 0.5 : difficulty === 'hard' ? 2.0 : 1.0;
            const fineStep = difficulty === 'easy' ? 0.05 : difficulty === 'hard' ? 0.2 : 0.1;
            const preciseStep = difficulty === 'easy' ? 0.005 : difficulty === 'hard' ? 0.02 : 0.01;
            
            // Update button labels based on difficulty
            document.getElementById('decreaseCoarse').innerHTML = `-${coarseStep} ‡∏°‡∏°.`;
            document.getElementById('increaseCoarse').innerHTML = `+${coarseStep} ‡∏°‡∏°.`;
            document.getElementById('decreaseFine').innerHTML = `-${fineStep} ‡∏°‡∏°.`;
            document.getElementById('increaseFine').innerHTML = `+${fineStep} ‡∏°‡∏°.`;
            document.getElementById('decreasePrecise').innerHTML = `-${preciseStep.toFixed(3)} ‡∏°‡∏°.`;
            document.getElementById('increasePrecise').innerHTML = `+${preciseStep.toFixed(3)} ‡∏°‡∏°.`;
            
            document.getElementById('increaseCoarse').addEventListener('click', () => {
                measurement += coarseStep;
                updateMeasurement();
            });
            
            document.getElementById('decreaseCoarse').addEventListener('click', () => {
                measurement -= coarseStep;
                updateMeasurement();
            });
            
            document.getElementById('increaseFine').addEventListener('click', () => {
                measurement += fineStep;
                updateMeasurement();
            });
            
            document.getElementById('decreaseFine').addEventListener('click', () => {
                measurement -= fineStep;
                updateMeasurement();
            });
            
            document.getElementById('increasePrecise').addEventListener('click', () => {
                measurement += preciseStep;
                updateMeasurement();
            });
            
            document.getElementById('decreasePrecise').addEventListener('click', () => {
                measurement -= preciseStep;
                updateMeasurement();
            });
            
            document.getElementById('measureBtn').addEventListener('click', function() {
                const result = document.getElementById('stage2Result');
                const success = document.getElementById('stage2Success');
                const fail = document.getElementById('stage2Fail');
                
                this.disabled = true;
                this.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏î...';
                
                setTimeout(() => {
                    result.classList.remove('hidden');
                    
                    if (Math.abs(measurement - targetValue) <= tolerance) {
                        success.classList.remove('hidden');
                        fail.classList.add('hidden');
                        
                        // Score based on difficulty and accuracy
                        let baseScore = difficulty === 'easy' ? 25 : difficulty === 'hard' ? 40 : 30;
                        const accuracyBonus = Math.max(0, Math.floor((tolerance - Math.abs(measurement - targetValue)) * 100));
                        scores.precision += baseScore + accuracyBonus;
                        stageCompleted[1] = true;
                    } else {
                        success.classList.add('hidden');
                        fail.classList.remove('hidden');
                        
                        let penaltyScore = difficulty === 'easy' ? 12 : difficulty === 'hard' ? 5 : 10;
                        scores.precision += penaltyScore;
                    }
                    
                    updateScoreDisplay();
                    showNextButton();
                }, 1500);
            });
        }

        // Stage 3: CNC Guardian
        function initStage3() {
            clearInterval(timerInterval);
            startTimer(stageTimers[2]);
            
            // Get current question
            const question = currentQuestions.stage3;
            
            // Update display with current question
            document.getElementById('cncDisplay').innerHTML = `
                <div class="text-center">
                    <div class="text-2xl mb-2">üü¢ SYSTEM READY</div>
                    <div class="text-sm">CNC Machine Online</div>
                    <div class="text-xs mt-4 text-gray-400">
                        <p>Target: ${question.desc}</p>
                        <p>Material: Aluminum 6061</p>
                    </div>
                </div>
            `;
            
            // Update target shape display
            document.querySelector('#stage3 .text-4xl.mb-2').textContent = question.shape;
            document.querySelector('#stage3 .text-blue-300.font-bold').textContent = question.desc;
            
            // Update hint panel with current question
            document.querySelector('#cncHintPanel .text-yellow-200').innerHTML = `
                <p>‚Ä¢ <strong>X = ${question.x}, Y = ${question.y}</strong> (‡∏Ç‡∏ô‡∏≤‡∏î${question.desc.includes('‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™') ? '‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™' : '‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏ú‡∏∑‡∏ô‡∏ú‡πâ‡∏≤'})</p>
                <p>‚Ä¢ <strong>Feed Rate = ${question.feed}</strong> (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)</p>
                <p>‚Ä¢ <strong>Spindle Speed = ${question.speed}</strong> (RPM ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${question.tool.replace('endmill', 'End Mill √ò')}mm)</p>
                <p>‚Ä¢ <strong>Tool = ${question.tool.replace('endmill', 'End Mill √ò')}mm</strong> (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏î)</p>
            `;
            
            // Reset stage 3 elements
            document.getElementById('runCNC').disabled = false;
            document.getElementById('showCNCHint').disabled = false;
            document.getElementById('showCNCHint').textContent = difficulty === 'easy' ? 'üí° ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ (-5%)' : difficulty === 'hard' ? 'üí° ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ (-15%)' : 'üí° ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ (-10%)';
            document.getElementById('cncHintPanel').classList.add('hidden');
            document.getElementById('stage3Result').classList.add('hidden');
            document.getElementById('stage3Success').classList.add('hidden');
            document.getElementById('stage3Fail').classList.add('hidden');
            document.getElementById('cncDisplay').classList.remove('cnc-processing');
            
            // Reset form values
            document.getElementById('xAxis').value = '0';
            document.getElementById('yAxis').value = '0';
            document.getElementById('feedRate').value = '100';
            document.getElementById('spindleSpeed').value = '800';
            document.getElementById('toolSelection').value = 'endmill6';
            
            // Hint system - remove existing listener first
            const hintBtn = document.getElementById('showCNCHint');
            hintBtn.replaceWith(hintBtn.cloneNode(true));
            document.getElementById('showCNCHint').addEventListener('click', function() {
                document.getElementById('cncHintPanel').classList.remove('hidden');
                this.disabled = true;
                this.textContent = '‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß';
                hintsUsed.push('cnc');
            });
            
            // CNC run button - remove existing listener first
            const runBtn = document.getElementById('runCNC');
            runBtn.replaceWith(runBtn.cloneNode(true));
            document.getElementById('runCNC').addEventListener('click', function() {
                const x = parseInt(document.getElementById('xAxis').value);
                const y = parseInt(document.getElementById('yAxis').value);
                const feedRate = parseInt(document.getElementById('feedRate').value);
                const spindleSpeed = parseInt(document.getElementById('spindleSpeed').value);
                const tool = document.getElementById('toolSelection').value;
                
                const display = document.getElementById('cncDisplay');
                const result = document.getElementById('stage3Result');
                const success = document.getElementById('stage3Success');
                const fail = document.getElementById('stage3Fail');
                
                this.disabled = true;
                display.classList.add('cnc-processing');
                display.innerHTML = `
                    <div class="text-center">
                        <div class="text-2xl mb-2 text-yellow-400">üîÑ PROCESSING...</div>
                        <div class="text-sm">Running G-Code Program</div>
                        <div class="text-xs mt-2">
                            <p>X: ${x}mm, Y: ${y}mm</p>
                            <p>Feed: ${feedRate}mm/min</p>
                            <p>Speed: ${spindleSpeed}RPM</p>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    result.classList.remove('hidden');
                    clearInterval(timerInterval);
                    
                    if (x === question.x && y === question.y && feedRate === question.feed && spindleSpeed === question.speed && tool === question.tool) {
                        display.innerHTML = `
                            <div class="text-center">
                                <div class="text-2xl mb-2 text-green-400">‚úÖ SUCCESS</div>
                                <div class="text-sm">Perfect ${question.desc}</div>
                                <div class="text-xs mt-2 text-green-300">
                                    <p>Surface Finish: Ra 0.8</p>
                                    <p>Tolerance: ¬±0.05mm</p>
                                </div>
                            </div>
                        `;
                        success.classList.remove('hidden');
                        fail.classList.add('hidden');
                        
                        // Calculate score with bonuses/penalties based on difficulty
                        let baseScore = difficulty === 'easy' ? 30 : difficulty === 'hard' ? 45 : 35;
                        const timeBonus = Math.floor(currentTimer / 10);
                        let finalScore = baseScore + timeBonus;
                        
                        // Penalty for using hints
                        if (hintsUsed.includes('cnc')) {
                            const hintPenalty = difficulty === 'easy' ? 0.95 : difficulty === 'hard' ? 0.85 : 0.9;
                            finalScore = Math.floor(finalScore * hintPenalty);
                        }
                        
                        scores.cnc += finalScore;
                        stageCompleted[2] = true;
                    } else {
                        display.innerHTML = `
                            <div class="text-center">
                                <div class="text-2xl mb-2 text-red-400">‚ùå ERROR</div>
                                <div class="text-sm">Program Failed</div>
                                <div class="text-xs mt-2 text-red-300">
                                    <p>Check parameters:</p>
                                    <p>X=${question.x}, Y=${question.y}, F=${question.feed}, S=${question.speed}</p>
                                    <p>Tool: ${question.tool.replace('endmill', 'End Mill √ò')}mm</p>
                                </div>
                            </div>
                        `;
                        success.classList.add('hidden');
                        fail.classList.remove('hidden');
                        
                        let penaltyScore = difficulty === 'easy' ? 18 : difficulty === 'hard' ? 8 : 15;
                        scores.cnc += penaltyScore;
                        wrongAnswers++;
                        
                        // Penalty for wrong answer
                        let penalty = difficulty === 'easy' ? 15 : difficulty === 'hard' ? 25 : 20;
                        scores.cnc = Math.max(0, scores.cnc - penalty);
                    }
                    
                    updateScoreDisplay();
                    showNextButton();
                }, 3000);
            });
        }

        // Stage 4: Assembly Expert
        function initStage4() {
            clearInterval(timerInterval);
            startTimer(stageTimers[3]);
            
            let assemblyOrder = [];
            const correctOrder = ['base', 'shaft', 'gear', 'motor'];
            
            // Reset stage 4 elements
            document.getElementById('testMachine').classList.add('hidden');
            document.getElementById('testMachine').disabled = false;
            document.getElementById('testMachine').textContent = '‚ö° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£';
            document.getElementById('stage4Result').classList.add('hidden');
            document.getElementById('stage4Success').classList.add('hidden');
            document.getElementById('stage4Fail').classList.add('hidden');
            document.getElementById('machineAssembly').classList.remove('assembly-glow');
            
            // Reset part items and slots
            document.querySelectorAll('.part-item').forEach(item => {
                item.style.opacity = '1';
                const btn = item.querySelector('.part-btn');
                btn.disabled = false;
                btn.textContent = '‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö';
            });
            
            // Reset slots
            ['base', 'shaft', 'gear', 'motor'].forEach((part, index) => {
                const slot = document.getElementById(`slot-${part}`);
                slot.classList.remove('filled');
                const labels = ['‡∏ê‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (1)', '‡πÄ‡∏û‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏Å (2)', '‡∏ä‡∏∏‡∏î‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå (3)', '‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå (4)'];
                slot.innerHTML = `<span class="text-gray-500">${labels[index]}</span>`;
            });
            
            // Remove existing listeners and add fresh ones for part buttons
            document.querySelectorAll('.part-btn').forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.replaceWith(newBtn);
            });
            
            document.querySelectorAll('.part-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const partItem = this.closest('.part-item');
                    const partType = partItem.dataset.part;
                    
                    if (!assemblyOrder.includes(partType)) {
                        assemblyOrder.push(partType);
                        
                        // Update slot
                        const slot = document.getElementById(`slot-${partType}`);
                        slot.classList.add('filled');
                        slot.innerHTML = `
                            <div class="flex items-center space-x-2">
                                <div class="text-2xl">${partItem.querySelector('.text-3xl').textContent}</div>
                                <div class="font-bold text-green-400">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß</div>
                            </div>
                        `;
                        
                        // Disable button
                        partItem.style.opacity = '0.5';
                        this.disabled = true;
                        this.textContent = '‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß';
                        
                        if (assemblyOrder.length === 4) {
                            document.getElementById('testMachine').classList.remove('hidden');
                        }
                    }
                });
            });
            
            // Test machine button - remove existing listener first
            const testBtn = document.getElementById('testMachine');
            testBtn.replaceWith(testBtn.cloneNode(true));
            document.getElementById('testMachine').addEventListener('click', function() {
                const result = document.getElementById('stage4Result');
                const success = document.getElementById('stage4Success');
                const fail = document.getElementById('stage4Fail');
                
                this.disabled = true;
                this.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
                
                setTimeout(() => {
                    result.classList.remove('hidden');
                    
                    // Check if assembly order is correct
                    const isCorrect = JSON.stringify(assemblyOrder) === JSON.stringify(correctOrder);
                    
                    if (isCorrect) {
                        success.classList.remove('hidden');
                        fail.classList.add('hidden');
                        scores.assembly += 40;
                        stageCompleted[3] = true;
                        
                        // Add glow effect to machine
                        document.getElementById('machineAssembly').classList.add('assembly-glow');
                    } else {
                        success.classList.add('hidden');
                        fail.classList.remove('hidden');
                        scores.assembly += 20;
                    }
                    
                    updateScoreDisplay();
                    showNextButton();
                }, 2000);
            });
        }

        // Stage 5: Machine God
        function initStage5() {
            clearInterval(timerInterval);
            startTimer(stageTimers[4]);
            
            let operationsCompleted = [];
            const requiredOperations = ['drill', 'mill', 'lathe'];
            
            // Reset stage 5 elements
            document.getElementById('stage5Result').classList.add('hidden');
            document.querySelectorAll('.operation-btn').forEach(btn => {
                btn.style.opacity = '1';
                btn.disabled = false;
            });
            
            // Reset status indicators
            document.getElementById('drillStatus').textContent = '‚≠ï';
            document.getElementById('millStatus').textContent = '‚≠ï';
            document.getElementById('latheStatus').textContent = '‚≠ï';
            
            // Remove existing listeners and add fresh ones for operation buttons
            document.querySelectorAll('.operation-btn').forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.replaceWith(newBtn);
            });
            
            document.querySelectorAll('.operation-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const operation = this.dataset.operation;
                    
                    if (!operationsCompleted.includes(operation)) {
                        operationsCompleted.push(operation);
                        
                        // Update status
                        document.getElementById(`${operation}Status`).textContent = '‚úÖ';
                        
                        // Disable button
                        this.style.opacity = '0.5';
                        this.disabled = true;
                        
                        // Add score based on operation
                        if (operation === 'drill') scores.machining += 15;
                        else if (operation === 'mill') scores.cnc += 15;
                        else if (operation === 'lathe') scores.precision += 15;
                        
                        updateScoreDisplay();
                        
                        if (operationsCompleted.length === 3) {
                            setTimeout(() => {
                                document.getElementById('stage5Result').classList.remove('hidden');
                                stageCompleted[4] = true;
                                
                                setTimeout(() => {
                                    showFinalResults();
                                }, 3000);
                            }, 1000);
                        }
                    }
                });
            });
        }

        // Update score display
        function updateScoreDisplay() {
            document.getElementById('machiningScore').textContent = scores.machining;
            document.getElementById('precisionScore').textContent = scores.precision;
            document.getElementById('cncScore').textContent = scores.cnc;
            document.getElementById('assemblyScore').textContent = scores.assembly;
        }

        // Show next stage button
        function showNextButton() {
            if (currentStage < 5) {
                document.getElementById('nextStage').classList.remove('hidden');
            }
        }

        // Next stage handler
        document.getElementById('nextStage').addEventListener('click', function() {
            currentStage++;
            updateProgress();
            showStage(currentStage);
            this.classList.add('hidden');
        });

        // Show stage
        function showStage(stage) {
            document.querySelectorAll('.stage').forEach(s => s.classList.add('hidden'));
            document.getElementById(`stage${stage}`).classList.remove('hidden');
            
            // Initialize stage-specific functionality
            if (stage === 1) initStage1();
            else if (stage === 2) initStage2();
            else if (stage === 3) initStage3();
            else if (stage === 4) initStage4();
            else if (stage === 5) initStage5();
        }

        // Update progress
        function updateProgress() {
            const progress = (currentStage / 5) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `‡∏î‡πà‡∏≤‡∏ô ${currentStage}/5`;
        }

        // Show final results
        function showFinalResults() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('finalResults').classList.remove('hidden');
            
            // Add completion bonus
            const completedStages = stageCompleted.filter(Boolean).length;
            if (completedStages === 5) {
                scores.assembly += 50; // Completion bonus
            }
            
            // Update final scores
            document.getElementById('finalMachiningScore').textContent = scores.machining;
            document.getElementById('finalPrecisionScore').textContent = scores.precision;
            document.getElementById('finalCncScore').textContent = scores.cnc;
            document.getElementById('finalAssemblyScore').textContent = scores.assembly;
            
            // Calculate performance metrics
            const totalScore = Object.values(scores).reduce((a, b) => a + b, 0);
            const maxScore = Math.max(...Object.values(scores));
            const playTime = Math.floor((Date.now() - startTime) / 1000 / 60); // minutes
            const efficiency = Math.floor((completedStages / 5) * 100);
            
            let career = '';
            let description = '';
            let icon = '';
            let recommendations = [];
            let grade = '';
            
            // Determine grade
            if (totalScore >= 150) grade = 'A+';
            else if (totalScore >= 130) grade = 'A';
            else if (totalScore >= 110) grade = 'B+';
            else if (totalScore >= 90) grade = 'B';
            else if (totalScore >= 70) grade = 'C+';
            else if (totalScore >= 50) grade = 'C';
            else grade = 'D';

            if (totalScore >= 120 && Object.values(scores).every(s => s >= 25)) {
                career = 'üëë MASTER MACHINIST';
                description = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏î‡πâ‡∏≤‡∏ô ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô';
                icon = 'üëë';
                recommendations = [
                    '‚Ä¢ ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•',
                    '‚Ä¢ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥',
                    '‚Ä¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ Industry 4.0 ‡πÅ‡∏•‡∏∞ IoT',
                    '‚Ä¢ ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏™‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ'
                ];
            } else if (scores.cnc === maxScore && scores.cnc >= 30) {
                career = 'ü§ñ CNC PROGRAMMING SPECIALIST';
                description = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° CNC ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á';
                icon = 'ü§ñ';
                recommendations = [
                    '‚Ä¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ CAD/CAM Software ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
                    '‚Ä¢ ‡∏®‡∏∂‡∏Å‡∏©‡∏≤ Multi-axis CNC Programming',
                    '‚Ä¢ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞ Automation ‡πÅ‡∏•‡∏∞ Robotics'
                ];
            } else if (scores.precision === maxScore && scores.precision >= 30) {
                career = 'üìè QUALITY CONTROL SPECIALIST';
                description = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡πÉ‡∏à‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö';
                icon = 'üìè';
                recommendations = [
                    '‚Ä¢ ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏ö‡∏ö ISO 9001 ‡πÅ‡∏•‡∏∞ Quality Management',
                    '‚Ä¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏±‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á ‡πÄ‡∏ä‡πà‡∏ô CMM',
                    '‚Ä¢ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞ Statistical Process Control'
                ];
            } else if (scores.machining === maxScore && scores.machining >= 30) {
                career = 'üî• MACHINING SPECIALIST';
                description = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏ï‡∏±‡∏î‡πÇ‡∏•‡∏´‡∏∞ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏∂‡∏á ‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥';
                icon = 'üî•';
                recommendations = [
                    '‚Ä¢ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á',
                    '‚Ä¢ ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÜ',
                    '‚Ä¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á'
                ];
            } else if (scores.assembly === maxScore && scores.assembly >= 30) {
                career = '‚öôÔ∏è ASSEMBLY & MAINTENANCE EXPERT';
                description = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á';
                icon = '‚öôÔ∏è';
                recommendations = [
                    '‚Ä¢ ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏ö‡∏ö Preventive Maintenance',
                    '‚Ä¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á',
                    '‚Ä¢ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£'
                ];
            } else {
                career = 'üéØ APPRENTICE MACHINIST';
                description = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç';
                icon = 'üéØ';
                recommendations = [
                    '‚Ä¢ ‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á',
                    '‚Ä¢ ‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô',
                    '‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©'
                ];
            }
            
            document.getElementById('careerIcon').textContent = icon;
            document.getElementById('careerTitle').textContent = `${career} (‡πÄ‡∏Å‡∏£‡∏î ${grade})`;
            document.getElementById('careerDescription').textContent = description;
            
            const recommendationsDiv = document.getElementById('recommendations');
            recommendationsDiv.innerHTML = `
                <div class="mb-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-blue-900 bg-opacity-30 rounded-lg p-3">
                        <div class="text-2xl font-bold text-blue-400">${totalScore}</div>
                        <div class="text-xs text-gray-400">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
                    </div>
                    <div class="bg-green-900 bg-opacity-30 rounded-lg p-3">
                        <div class="text-2xl font-bold text-green-400">${efficiency}%</div>
                        <div class="text-xs text-gray-400">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                    </div>
                    <div class="bg-purple-900 bg-opacity-30 rounded-lg p-3">
                        <div class="text-2xl font-bold text-purple-400">${playTime}</div>
                        <div class="text-xs text-gray-400">‡∏ô‡∏≤‡∏ó‡∏µ</div>
                    </div>
                    <div class="bg-red-900 bg-opacity-30 rounded-lg p-3">
                        <div class="text-2xl font-bold text-red-400">${wrongAnswers}</div>
                        <div class="text-xs text-gray-400">‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î</div>
                    </div>
                </div>
                ${recommendations.map(rec => `<p>${rec}</p>`).join('')}
            `;
        }

        // Question variations for each stage
        const questionSets = {
            stage1: [
                {
                    workpiece: 'üî©',
                    desc: '‡πÄ‡∏û‡∏•‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Å‡∏•‡∏° ‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á 50 ‡∏°‡∏°.',
                    details: 'üìê ‡∏Ç‡∏ô‡∏≤‡∏î: √ò50 √ó 200 ‡∏°‡∏°.<br>üîß ‡∏ß‡∏±‡∏™‡∏î‡∏∏: ‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Å‡∏•‡πâ‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô',
                    answer: 'lathe'
                },
                {
                    workpiece: '‚¨ú',
                    desc: '‡πÅ‡∏ú‡πà‡∏ô‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° 100√ó50 ‡∏°‡∏°.',
                    details: 'üìê ‡∏Ç‡∏ô‡∏≤‡∏î: 100√ó50√ó20 ‡∏°‡∏°.<br>üîß ‡∏ß‡∏±‡∏™‡∏î‡∏∏: ‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 6061',
                    answer: 'mill'
                },
                {
                    workpiece: 'üï≥Ô∏è',
                    desc: '‡πÅ‡∏ú‡πà‡∏ô‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏à‡∏≤‡∏∞‡∏£‡∏π 12 ‡∏£‡∏π',
                    details: 'üìê ‡∏£‡∏π: √ò8 ‡∏°‡∏°. ‡∏•‡∏∂‡∏Å 15 ‡∏°‡∏°.<br>üîß ‡∏ß‡∏±‡∏™‡∏î‡∏∏: ‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Å‡∏•‡πâ‡∏≤‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô',
                    answer: 'drill'
                },
                {
                    workpiece: 'üîß',
                    desc: '‡∏Å‡πâ‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Å‡∏•‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÅ‡∏à',
                    details: 'üìê ‡∏Ç‡∏ô‡∏≤‡∏î: √ò25 √ó 150 ‡∏°‡∏°.<br>üîß ‡∏ß‡∏±‡∏™‡∏î‡∏∏: ‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Å‡∏•‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠',
                    answer: 'lathe'
                },
                {
                    workpiece: 'üìê',
                    desc: '‡πÅ‡∏ú‡πà‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏£‡∏π‡∏õ‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°',
                    details: 'üìê ‡∏Ç‡∏ô‡∏≤‡∏î: 200√ó150√ó25 ‡∏°‡∏°.<br>üîß ‡∏ß‡∏±‡∏™‡∏î‡∏∏: ‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏´‡∏•‡πà‡∏≠',
                    answer: 'mill'
                }
            ],
            stage2: [
                { target: 25.50, tolerance: 0.02 },
                { target: 12.75, tolerance: 0.01 },
                { target: 38.25, tolerance: 0.03 },
                { target: 15.00, tolerance: 0.02 },
                { target: 42.80, tolerance: 0.05 }
            ],
            stage3: [
                { x: 50, y: 50, feed: 300, speed: 1200, tool: 'endmill10', shape: '‚¨ú', desc: '‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™ 50√ó50 ‡∏°‡∏°.' },
                { x: 75, y: 25, feed: 250, speed: 1000, tool: 'endmill6', shape: '‚ñ≠', desc: '‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏ú‡∏∑‡∏ô‡∏ú‡πâ‡∏≤ 75√ó25 ‡∏°‡∏°.' },
                { x: 30, y: 30, feed: 400, speed: 1500, tool: 'endmill12', shape: '‚¨ú', desc: '‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™ 30√ó30 ‡∏°‡∏°.' },
                { x: 60, y: 40, feed: 350, speed: 1200, tool: 'endmill10', shape: '‚ñ≠', desc: '‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏ú‡∏∑‡∏ô‡∏ú‡πâ‡∏≤ 60√ó40 ‡∏°‡∏°.' },
                { x: 80, y: 80, feed: 200, speed: 800, tool: 'endmill12', shape: '‚¨ú', desc: '‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™ 80√ó80 ‡∏°‡∏°.' }
            ]
        };

        let currentQuestions = {};

        // Randomize questions for new game
        function randomizeQuestions() {
            currentQuestions = {
                stage1: questionSets.stage1[Math.floor(Math.random() * questionSets.stage1.length)],
                stage2: questionSets.stage2[Math.floor(Math.random() * questionSets.stage2.length)],
                stage3: questionSets.stage3[Math.floor(Math.random() * questionSets.stage3.length)]
            };
        }

        // Navigation functions
        function goHome() {
            // Reset all game state
            gameStarted = false;
            currentStage = 1;
            difficulty = 'normal';
            scores = { machining: 0, precision: 0, cnc: 0, assembly: 0 };
            stageCompleted = [false, false, false, false, false];
            hintsUsed = [];
            wrongAnswers = 0;
            clearInterval(timerInterval);
            
            // Show start screen, hide others
            document.getElementById('startScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('finalResults').classList.add('hidden');
            document.getElementById('progressSystem').classList.add('hidden');
            document.getElementById('nextStage').classList.add('hidden');
            
            // Reset difficulty selection
            document.querySelectorAll('.difficulty-btn').forEach(b => {
                b.classList.remove('ring-4', 'ring-yellow-400');
            });
            document.getElementById('startGame').disabled = true;
            
            // Reset timer display
            document.getElementById('timer').textContent = '5:00';
            document.getElementById('timer').classList.remove('text-red-500', 'animate-pulse');
            
            // Reset progress
            document.getElementById('progressBar').style.width = '20%';
            document.getElementById('progressText').textContent = '‡∏î‡πà‡∏≤‡∏ô 1/5';
            
            // Reset scores display
            updateScoreDisplay();
            
            // Randomize questions for next game
            randomizeQuestions();
            
            // Re-setup start screen listeners
            initStartScreen();
        }
        
        function restartGame() {
            goHome();
        }
        
        // Global navigation handlers
        window.goHomeHandler = function() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ')) {
                goHome();
            }
        };
        
        window.restartHandler = function() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ')) {
                restartGame();
            }
        };
        
        window.homeFromResultsHandler = function() {
            goHome();
        };
        
        window.restartGameHandler = function() {
            restartGame();
        };

        // Add floating animation for particles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                33% { transform: translateY(-10px) rotate(120deg); }
                66% { transform: translateY(5px) rotate(240deg); }
            }
        `;
        document.head.appendChild(style);

        // Initialize game
        createParticles();
        initStartScreen();
        randomizeQuestions(); // Initialize questions on page load
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978595dec7637b68',t:'MTc1NjczODI4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
