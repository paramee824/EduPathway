<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Garage Master Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            overflow-x: hidden;
        }
        
        .neon-text {
            text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff;
        }
        
        .neon-border {
            box-shadow: 0 0 15px #ff6b35, 0 0 30px #ff6b35;
            border: 2px solid #ff6b35;
        }
        
        .car-shake {
            animation: shake 0.5s ease-in-out;
        }
        
        .smoke-effect {
            animation: smoke 2s ease-out;
        }
        
        .success-glow {
            animation: successGlow 1s ease-in-out;
        }
        
        .countdown-pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes smoke {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(2); }
        }
        
        @keyframes successGlow {
            0% { box-shadow: 0 0 5px #00ff00; }
            50% { box-shadow: 0 0 25px #00ff00, 0 0 50px #00ff00; }
            100% { box-shadow: 0 0 5px #00ff00; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .racing-stripes {
            background: repeating-linear-gradient(
                45deg,
                #ff6b35,
                #ff6b35 10px,
                #ffa500 10px,
                #ffa500 20px
            );
        }
        
        .engine-part {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .engine-part:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }
        
        .customer-queue {
            background: linear-gradient(90deg, #2d3748 0%, #4a5568 100%);
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <!-- Main Game Container -->
    <div id="gameContainer" class="container mx-auto px-4 py-6">
        
        <!-- Start Screen -->
        <div id="startScreen" class="text-center min-h-screen flex flex-col justify-center">
            <div class="mb-8">
                <h1 class="text-7xl font-black neon-text mb-6 animate-pulse">üéÆ GARAGE MASTER CHALLENGE</h1>
                <div class="racing-stripes h-4 w-full rounded-full mb-6 animate-pulse"></div>
                <p class="text-2xl text-cyan-300 mb-4">‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏ù‡∏µ‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏õ‡∏£! üîß‚ö°</p>
                <p class="text-lg text-yellow-400 mb-8">‚ö†Ô∏è ‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏¢‡∏≤‡∏Å‡∏°‡∏≤‡∏Å! ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°!</p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6 mb-8 max-w-4xl mx-auto">
                <div class="bg-gradient-to-br from-red-900/70 to-orange-900/70 rounded-xl p-6 neon-border">
                    <div class="text-5xl mb-4">üèÅ</div>
                    <h3 class="text-xl font-bold text-orange-300">PIT STOP HELL</h3>
                    <p class="text-sm text-gray-300">15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ | 6 ‡∏á‡∏≤‡∏ô | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ!</p>
                </div>
                <div class="bg-gradient-to-br from-blue-900/70 to-purple-900/70 rounded-xl p-6 neon-border">
                    <div class="text-5xl mb-4">üîß</div>
                    <h3 class="text-xl font-bold text-blue-300">ENGINE NIGHTMARE</h3>
                    <p class="text-sm text-gray-300">3 ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô | ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î!</p>
                </div>
                <div class="bg-gradient-to-br from-green-900/70 to-teal-900/70 rounded-xl p-6 neon-border">
                    <div class="text-5xl mb-4">üëî</div>
                    <h3 class="text-xl font-bold text-green-300">CHAOS MANAGER</h3>
                    <p class="text-sm text-gray-300">10 ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à 90%+ | ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≥‡∏Å‡∏±‡∏î!</p>
                </div>
            </div>
            
            <button onclick="showMissionSelect()" class="bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600 hover:from-red-700 hover:via-orange-700 hover:to-yellow-700 px-12 py-6 rounded-2xl text-3xl font-black transition-all hover:scale-110 neon-border animate-bounce">
                üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° HARDCORE!
            </button>
            
            <div class="mt-8 text-center">
                <div class="text-sm text-gray-400 mb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å:</div>
                <div class="flex justify-center space-x-8 text-xs">
                    <span class="text-red-400">üî• ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ: 12%</span>
                    <span class="text-yellow-400">‚ö° ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: 45/300</span>
                    <span class="text-green-400">üëë ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏õ‡∏£: 3%</span>
                </div>
            </div>
        </div>

        <!-- Mission Selection Screen -->
        <div id="missionSelect" class="hidden grid md:grid-cols-3 gap-6 mb-8">
            <div class="neon-border rounded-xl p-6 bg-gradient-to-br from-red-900/50 to-orange-900/50 cursor-pointer hover:scale-105 transition-all" onclick="startMission(1)">
                <div class="text-center">
                    <div class="text-4xl mb-4">üèÅ</div>
                    <h3 class="text-2xl font-bold text-orange-300 mb-2">PIT STOP SPEED</h3>
                    <p class="text-sm text-gray-300">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏≤‡∏á ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ö‡∏£‡∏Å</p>
                    <p class="text-xs text-yellow-400 mt-2">‚ö° ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß + ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p>
                </div>
            </div>
            
            <div class="neon-border rounded-xl p-6 bg-gradient-to-br from-blue-900/50 to-purple-900/50 cursor-pointer hover:scale-105 transition-all" onclick="startMission(2)">
                <div class="text-center">
                    <div class="text-4xl mb-4">üîß</div>
                    <h3 class="text-2xl font-bold text-blue-300 mb-2">ENGINE SURGERY</h3>
                    <p class="text-sm text-gray-300">‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå</p>
                    <p class="text-xs text-yellow-400 mt-2">üß† ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå + ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ã‡πà‡∏≠‡∏°</p>
                </div>
            </div>
            
            <div class="neon-border rounded-xl p-6 bg-gradient-to-br from-green-900/50 to-teal-900/50 cursor-pointer hover:scale-105 transition-all" onclick="startMission(3)">
                <div class="text-center">
                    <div class="text-4xl mb-4">üëî</div>
                    <h3 class="text-2xl font-bold text-green-300 mb-2">GARAGE MANAGER</h3>
                    <p class="text-sm text-gray-300">‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
                    <p class="text-xs text-yellow-400 mt-2">üìä ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ + ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
                </div>
            </div>
        </div>

        <!-- Mission 1: Pit Stop Hell -->
        <div id="mission1" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-orange-300 mb-2">üèÅ PIT STOP HELL MODE</h2>
                <div class="flex justify-center space-x-8 mb-4">
                    <div class="text-center">
                        <div id="countdown1" class="text-4xl font-black text-red-400 countdown-pulse">15</div>
                        <div class="text-sm">‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏¥)</div>
                    </div>
                    <div class="text-center">
                        <div id="lives1" class="text-4xl font-black text-green-400">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                        <div class="text-sm">‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</div>
                    </div>
                    <div class="text-center">
                        <div id="combo1" class="text-4xl font-black text-yellow-400">0</div>
                        <div class="text-sm">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö</div>
                    </div>
                </div>
                <div class="text-lg text-red-400 animate-pulse">‚ö†Ô∏è ‡∏ó‡∏≥‡∏ú‡∏¥‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö = ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï!</div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Race Car -->
                <div class="text-center">
                    <div id="raceCar" class="text-8xl mb-4">üèéÔ∏è</div>
                    <div class="bg-gray-800 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-yellow-300 mb-4">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏á‡∏≤‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö!):</h3>
                        <div class="space-y-2" id="taskList1">
                            <div id="task1" class="flex items-center justify-between p-2 bg-red-900/50 rounded">
                                <span>1Ô∏è‚É£ ‡∏¢‡∏Å‡∏£‡∏ñ</span>
                                <span class="text-red-400">‚ùå</span>
                            </div>
                            <div id="task2" class="flex items-center justify-between p-2 bg-red-900/50 rounded">
                                <span>2Ô∏è‚É£ ‡∏ñ‡∏≠‡∏î‡∏¢‡∏≤‡∏á‡πÄ‡∏Å‡πà‡∏≤</span>
                                <span class="text-red-400">‚ùå</span>
                            </div>
                            <div id="task3" class="flex items-center justify-between p-2 bg-red-900/50 rounded">
                                <span>3Ô∏è‚É£ ‡πÉ‡∏™‡πà‡∏¢‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</span>
                                <span class="text-red-400">‚ùå</span>
                            </div>
                            <div id="task4" class="flex items-center justify-between p-2 bg-red-900/50 rounded">
                                <span>4Ô∏è‚É£ ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</span>
                                <span class="text-red-400">‚ùå</span>
                            </div>
                            <div id="task5" class="flex items-center justify-between p-2 bg-red-900/50 rounded">
                                <span>5Ô∏è‚É£ ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ö‡∏£‡∏Å</span>
                                <span class="text-red-400">‚ùå</span>
                            </div>
                            <div id="task6" class="flex items-center justify-between p-2 bg-red-900/50 rounded">
                                <span>6Ô∏è‚É£ ‡∏•‡∏î‡∏£‡∏ñ</span>
                                <span class="text-red-400">‚ùå</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tools -->
                <div>
                    <h3 class="text-xl font-bold text-cyan-300 mb-4 text-center">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏≤‡∏á (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö!)</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="performTask(1)" class="bg-purple-600 hover:bg-purple-700 p-4 rounded-xl text-lg font-bold transition-all hover:scale-105">
                            üèóÔ∏è ‡∏¢‡∏Å‡∏£‡∏ñ
                        </button>
                        <button onclick="performTask(2)" class="bg-red-600 hover:bg-red-700 p-4 rounded-xl text-lg font-bold transition-all hover:scale-105">
                            üîß ‡∏ñ‡∏≠‡∏î‡∏¢‡∏≤‡∏á
                        </button>
                        <button onclick="performTask(3)" class="bg-orange-600 hover:bg-orange-700 p-4 rounded-xl text-lg font-bold transition-all hover:scale-105">
                            üõû ‡πÉ‡∏™‡πà‡∏¢‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                        </button>
                        <button onclick="performTask(4)" class="bg-blue-600 hover:bg-blue-700 p-4 rounded-xl text-lg font-bold transition-all hover:scale-105">
                            ‚õΩ ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô
                        </button>
                        <button onclick="performTask(5)" class="bg-yellow-600 hover:bg-yellow-700 p-4 rounded-xl text-lg font-bold transition-all hover:scale-105">
                            üõë ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ö‡∏£‡∏Å
                        </button>
                        <button onclick="performTask(6)" class="bg-green-600 hover:bg-green-700 p-4 rounded-xl text-lg font-bold transition-all hover:scale-105">
                            ‚¨áÔ∏è ‡∏•‡∏î‡∏£‡∏ñ
                        </button>
                    </div>
                    <button onclick="finishPitStop()" class="w-full mt-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 p-4 rounded-xl text-xl font-bold transition-all hover:scale-105">
                        üèÅ ‡∏™‡πà‡∏á‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å‡πÅ‡∏Ç‡πà‡∏á!
                    </button>
                </div>
            </div>
        </div>

        <!-- Mission 2: Engine Nightmare -->
        <div id="mission2" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-blue-300 mb-2">üîß ENGINE NIGHTMARE MODE</h2>
                <div class="flex justify-center space-x-8 mb-4">
                    <div class="text-center">
                        <div id="lives2" class="text-4xl font-black text-red-400">üíÄüíÄüíÄ</div>
                        <div class="text-sm">‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</div>
                    </div>
                    <div class="text-center">
                        <div id="round2" class="text-4xl font-black text-yellow-400">1/5</div>
                        <div class="text-sm">‡∏£‡∏≠‡∏ö</div>
                    </div>
                    <div class="text-center">
                        <div id="timer2" class="text-4xl font-black text-green-400">10</div>
                        <div class="text-sm">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
                    </div>
                </div>
                <div id="engineProblem" class="text-xl text-red-400 mb-4 animate-pulse">üöóüí® ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏±‡∏ô‡∏î‡∏≥!</div>
                <div class="text-sm text-yellow-400">‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏î = ‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πâ‡∏≤ = ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï!</div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Engine Display -->
                <div class="text-center">
                    <div id="engineDisplay" class="text-8xl mb-4">üöó</div>
                    <div id="engineStatus" class="text-2xl text-red-400">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏™‡∏µ‡∏¢!</div>
                    <div id="smokeEffect" class="text-4xl opacity-0">üí®üí®üí®</div>
                    <div id="explosionEffect" class="text-6xl opacity-0">üí•üî•üí•</div>
                    
                    <!-- Diagnostic Info -->
                    <div class="bg-gray-800 rounded-lg p-4 mt-4">
                        <h4 class="text-lg font-bold text-cyan-300 mb-2">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö:</h4>
                        <div id="symptoms" class="text-sm text-gray-300 space-y-1">
                            <div>üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</div>
                            <div>üí® ‡∏Ñ‡∏ß‡∏±‡∏ô‡∏™‡∏µ‡∏î‡∏≥‡∏≠‡∏≠‡∏Å‡∏ó‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢</div>
                            <div>‚õΩ ‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</div>
                        </div>
                    </div>
                </div>
                
                <!-- Parts Selection -->
                <div>
                    <h3 class="text-xl font-bold text-cyan-300 mb-4 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏£‡πá‡∏ß!)</h3>
                    <div class="grid grid-cols-3 gap-3" id="engineParts">
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('airFilter')">
                            <div class="text-2xl mb-1">üå™Ô∏è</div>
                            <div class="text-xs">‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('sparkPlug')">
                            <div class="text-2xl mb-1">‚ö°</div>
                            <div class="text-xs">‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('gasket')">
                            <div class="text-2xl mb-1">‚≠ï</div>
                            <div class="text-xs">‡∏õ‡∏∞‡πÄ‡∏Å‡πá‡∏ô</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('oilFilter')">
                            <div class="text-2xl mb-1">üõ¢Ô∏è</div>
                            <div class="text-xs">‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('fuelPump')">
                            <div class="text-2xl mb-1">‚õΩ</div>
                            <div class="text-xs">‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('radiator')">
                            <div class="text-2xl mb-1">üå°Ô∏è</div>
                            <div class="text-xs">‡∏´‡∏°‡πâ‡∏≠‡∏ô‡πâ‡∏≥</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('battery')">
                            <div class="text-2xl mb-1">üîã</div>
                            <div class="text-xs">‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('alternator')">
                            <div class="text-2xl mb-1">‚öôÔ∏è</div>
                            <div class="text-xs">‡πÑ‡∏î‡∏ô‡∏≤‡πÇ‡∏°</div>
                        </div>
                        <div class="engine-part bg-gray-700 p-3 rounded-xl text-center cursor-pointer hover:bg-gray-600" onclick="selectPart('timing')">
                            <div class="text-2xl mb-1">‚è∞</div>
                            <div class="text-xs">‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mission 3: Chaos Manager -->
        <div id="mission3" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-green-300 mb-2">üëî CHAOS MANAGER MODE</h2>
                <div class="flex justify-center space-x-6 mb-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-yellow-400" id="satisfaction">üòä 100%</div>
                        <div class="text-sm">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-400" id="revenue">üí∞ 0</div>
                        <div class="text-sm">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-400" id="timeLeft3">120</div>
                        <div class="text-sm">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ß‡∏¥)</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-400" id="served">0/10</div>
                        <div class="text-sm">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>
                    </div>
                </div>
                <div class="text-lg text-red-400 animate-pulse">‚ö†Ô∏è ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 10 ‡∏Ñ‡∏ô | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à 90%+ | 2 ‡∏ô‡∏≤‡∏ó‡∏µ!</div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Customer Queue -->
                <div>
                    <h3 class="text-xl font-bold text-cyan-300 mb-4">‡∏Ñ‡∏¥‡∏ß‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Ñ‡∏¥‡∏ß)</h3>
                    <div id="customerQueue" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Customers will be added here -->
                    </div>
                    
                    <!-- Emergency Alerts -->
                    <div id="emergencyAlerts" class="mt-4 space-y-2">
                        <!-- Emergency situations will appear here -->
                    </div>
                </div>
                
                <!-- Service Bays -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-cyan-300">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
                        <div class="text-sm text-gray-400">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</div>
                    </div>
                    
                    <!-- Service Bays Grid -->
                    <div id="serviceBays" class="grid grid-cols-2 gap-2 mb-4">
                        <!-- Bays will be generated dynamically -->
                    </div>
                    
                    <!-- Fuel Station -->
                    <div class="mb-4">
                        <h4 class="text-lg font-bold text-yellow-400 mb-2">‚õΩ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <div id="fuel1" class="bg-yellow-900/50 p-3 rounded-xl text-center min-h-16 flex items-center justify-center cursor-pointer hover:bg-yellow-800/50" onclick="selectFuelStation(0)">
                                <span class="text-gray-400">‡∏õ‡∏±‡πä‡∏° 1 (‡∏ß‡πà‡∏≤‡∏á)</span>
                            </div>
                            <div id="fuel2" class="bg-yellow-900/50 p-3 rounded-xl text-center min-h-16 flex items-center justify-center cursor-pointer hover:bg-yellow-800/50" onclick="selectFuelStation(1)">
                                <span class="text-gray-400">‡∏õ‡∏±‡πä‡∏° 2 (‡∏ß‡πà‡∏≤‡∏á)</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expansion Options -->
                    <div class="mb-4 space-y-2">
                        <button onclick="buyServiceBay()" id="buyBayBtn" class="w-full bg-green-600 hover:bg-green-700 p-2 rounded-xl text-sm font-bold transition-all">
                            üèóÔ∏è ‡∏ã‡∏∑‡πâ‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° (1,500‡∏ø)
                        </button>
                        <button onclick="buyFuelStation()" id="buyFuelBtn" class="w-full bg-yellow-600 hover:bg-yellow-700 p-2 rounded-xl text-sm font-bold transition-all">
                            ‚õΩ ‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° (2,000‡∏ø)
                        </button>
                    </div>
                    
                    <!-- Special Actions -->
                    <div class="space-y-2">
                        <button onclick="hireExtraStaff()" id="hireBtn" class="w-full bg-purple-600 hover:bg-purple-700 p-2 rounded-xl text-sm font-bold transition-all">
                            üë∑ ‡∏à‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° (800‡∏ø)
                        </button>
                        <button onclick="rushService()" id="rushBtn" class="w-full bg-red-600 hover:bg-red-700 p-2 rounded-xl text-sm font-bold transition-all">
                            üö® ‡πÇ‡∏´‡∏°‡∏î‡∏î‡πà‡∏ß‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (500‡∏ø)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results" class="hidden text-center min-h-screen flex flex-col justify-center">
            <div class="mb-8">
                <h2 class="text-5xl font-black neon-text mb-6 animate-pulse">üèÜ GARAGE MASTER RESULTS</h2>
                <div class="racing-stripes h-3 w-full rounded-full mb-6"></div>
            </div>
            
            <!-- Score Breakdown -->
            <div class="grid md:grid-cols-3 gap-6 mb-8 max-w-4xl mx-auto">
                <div class="bg-gradient-to-br from-red-900/70 to-orange-900/70 rounded-xl p-6 neon-border">
                    <div class="text-4xl mb-2">üèÅ</div>
                    <h3 class="text-xl font-bold text-orange-300 mb-2">PIT STOP</h3>
                    <div id="score1" class="text-3xl font-black text-white">0</div>
                    <div class="text-sm text-gray-300">/ 100 ‡πÅ‡∏ï‡πâ‡∏°</div>
                </div>
                <div class="bg-gradient-to-br from-blue-900/70 to-purple-900/70 rounded-xl p-6 neon-border">
                    <div class="text-4xl mb-2">üîß</div>
                    <h3 class="text-xl font-bold text-blue-300 mb-2">ENGINE</h3>
                    <div id="score2" class="text-3xl font-black text-white">0</div>
                    <div class="text-sm text-gray-300">/ 100 ‡πÅ‡∏ï‡πâ‡∏°</div>
                </div>
                <div class="bg-gradient-to-br from-green-900/70 to-teal-900/70 rounded-xl p-6 neon-border">
                    <div class="text-4xl mb-2">üëî</div>
                    <h3 class="text-xl font-bold text-green-300 mb-2">MANAGER</h3>
                    <div id="score3" class="text-3xl font-black text-white">0</div>
                    <div class="text-sm text-gray-300">/ 100 ‡πÅ‡∏ï‡πâ‡∏°</div>
                </div>
            </div>
            
            <!-- Total Score -->
            <div class="mb-8">
                <div class="text-2xl text-gray-400 mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
                <div id="finalScore" class="text-8xl font-black neon-text mb-4">0</div>
                <div class="text-xl text-gray-300">/ 300 ‡πÅ‡∏ï‡πâ‡∏°</div>
                <div id="rank" class="text-3xl font-bold mt-4">ü•â ‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</div>
            </div>
            
            <!-- Career Recommendation -->
            <div id="recommendation" class="bg-gradient-to-r from-purple-900/70 to-pink-900/70 rounded-2xl p-8 mb-8 max-w-2xl mx-auto neon-border">
                <h3 class="text-3xl font-bold mb-6 neon-text">üéØ ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</h3>
                <div id="careerPath" class="text-xl mb-4"></div>
                <div id="careerDescription" class="text-sm text-gray-300 mb-4"></div>
                <div id="salaryRange" class="text-lg font-bold text-green-400"></div>
            </div>
            
            <!-- Achievement Badges -->
            <div id="achievements" class="mb-8">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">üèÖ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ</h3>
                <div id="badgeList" class="flex justify-center space-x-4 flex-wrap">
                    <!-- Badges will be added here -->
                </div>
            </div>
            
            <!-- Global Stats -->
            <div class="bg-gray-800/50 rounded-xl p-6 mb-8 max-w-2xl mx-auto">
                <h3 class="text-xl font-bold text-cyan-300 mb-4">üìä ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å</h3>
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <div class="text-center">
                        <div id="percentile" class="text-2xl font-bold text-yellow-400">50%</div>
                        <div class="text-gray-400">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå</div>
                    </div>
                    <div class="text-center">
                        <div id="betterThan" class="text-2xl font-bold text-green-400">50%</div>
                        <div class="text-gray-400">‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤</div>
                    </div>
                    <div class="text-center">
                        <div id="worldRank" class="text-2xl font-bold text-purple-400">#5000</div>
                        <div class="text-gray-400">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÇ‡∏•‡∏Å</div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="space-y-4">
                <button onclick="restartGame()" class="bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600 hover:from-red-700 hover:via-orange-700 hover:to-yellow-700 px-12 py-4 rounded-2xl text-2xl font-black transition-all hover:scale-110 neon-border">
                    üîÑ ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà (HARDCORE!)
                </button>
                <div class="text-sm text-gray-400">
                    üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏´‡∏°‡πà!
                </div>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            currentMission: 0,
            scores: { pitStop: 0, engine: 0, manager: 0 },
            mission1: { 
                tasks: [false, false, false, false, false, false], 
                timeLeft: 15, 
                timer: null, 
                lives: 3, 
                combo: 0, 
                currentTask: 0 
            },
            mission2: { 
                currentProblem: 'smoke', 
                solved: false, 
                lives: 3, 
                round: 1, 
                timeLeft: 10, 
                timer: null,
                problems: []
            },
            mission3: { 
                customers: [], 
                satisfaction: 100, 
                revenue: 0, 
                bays: [null, null], 
                fuelStations: [null, null],
                timeLeft: 120, 
                served: 0, 
                selectedCustomer: null,
                extraStaff: false,
                rushMode: false,
                timer: null,
                customerTimer: null,
                emergencyTimer: null,
                totalBays: 6,
                activeBays: 2,
                mechanicAnimations: {}
            }
        };

        const engineProblems = {
            smoke: { 
                description: 'üöóüí® ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏±‡∏ô‡∏î‡∏≥!', 
                solution: 'airFilter', 
                symptoms: ['üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥', 'üí® ‡∏Ñ‡∏ß‡∏±‡∏ô‡∏™‡∏µ‡∏î‡∏≥‡∏≠‡∏≠‡∏Å‡∏ó‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢', '‚õΩ ‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô', 'üå™Ô∏è ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠']
            },
            noStart: { 
                description: 'üöó‚ùå ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î!', 
                solution: 'sparkPlug', 
                symptoms: ['üîã ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏õ‡∏Å‡∏ï‡∏¥', '‚ö° ‡πÑ‡∏ü‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏Å‡∏ï‡∏¥', 'üîß ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó', '‚ö° ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢‡πÑ‡∏ü']
            },
            oilLeak: { 
                description: 'üöóüõ¢Ô∏è ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏£‡∏±‡πà‡∏ß‡∏°‡∏≤‡∏Å!', 
                solution: 'gasket', 
                symptoms: ['üõ¢Ô∏è ‡∏Ñ‡∏£‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÉ‡∏ï‡πâ‡∏£‡∏ñ', 'üå°Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô', 'üíß ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏•‡∏î‡πÄ‡∏£‡πá‡∏ß', '‚≠ï ‡∏ã‡∏µ‡∏•‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û']
            },
            overHeat: { 
                description: 'üöóüå°Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤‡∏Å!', 
                solution: 'radiator', 
                symptoms: ['üå°Ô∏è ‡πÄ‡∏Ç‡πá‡∏°‡∏ß‡∏±‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏î‡∏á', 'üí® ‡πÑ‡∏≠‡∏ô‡πâ‡∏≥‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ù‡∏≤‡∏Å‡∏£‡∏∞‡πÇ‡∏õ‡∏£‡∏á', 'üíß ‡∏ô‡πâ‡∏≥‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏•‡∏î', 'üå°Ô∏è ‡∏´‡∏°‡πâ‡∏≠‡∏ô‡πâ‡∏≥‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏±‡∏î']
            },
            electrical: { 
                description: 'üöó‚ö° ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏°‡∏î!', 
                solution: 'alternator', 
                symptoms: ['üí° ‡πÑ‡∏ü‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ï‡∏¥‡∏î‡πÅ‡∏î‡∏á', 'üîã ‡πÅ‡∏ö‡∏ï‡∏´‡∏°‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å', 'üí° ‡πÑ‡∏ü‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏•‡∏±‡∏ß‡∏°‡∏≤‡∏Å', '‚öôÔ∏è ‡πÑ‡∏î‡∏ô‡∏≤‡πÇ‡∏°‡πÑ‡∏°‡πà‡∏ä‡∏≤‡∏£‡πå‡∏à']
            },
            timing: { 
                description: 'üöó‚è∞ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏¥‡∏î‡∏°‡∏≤‡∏Å!', 
                solution: 'timing', 
                symptoms: ['üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥', '‚ö° ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡πà‡∏ô‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á', 'üí® ‡∏Ñ‡∏ß‡∏±‡∏ô‡∏Ç‡∏≤‡∏ß‡∏≠‡∏≠‡∏Å‡∏ó‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢', '‚è∞ ‡∏•‡∏¥‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞']
            },
            fuelSystem: {
                description: 'üöó‚õΩ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢!',
                solution: 'fuelPump',
                symptoms: ['‚õΩ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡πà‡∏á', 'üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏î‡∏±‡∏á', '‚ö° ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∞‡∏î‡∏∏‡∏î', '‚õΩ ‡∏õ‡∏±‡πä‡∏°‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô']
            },
            oilSystem: {
                description: 'üöóüõ¢Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢!',
                solution: 'oilFilter',
                symptoms: ['üõ¢Ô∏è ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏™‡∏Å‡∏õ‡∏£‡∏Å', 'üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥', '‚ö° ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô', 'üõ¢Ô∏è ‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô']
            },
            batteryDead: {
                description: 'üöóüîã ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏´‡∏°‡∏î‡πÄ‡∏õ‡∏•‡πà‡∏≤!',
                solution: 'battery',
                symptoms: ['üîã ‡πÑ‡∏ü‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡πÄ‡∏•‡∏¢', 'üí° ‡πÑ‡∏ü‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏ß‡πà‡∏≤‡∏á', 'üîß ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó', 'üîã ‡πÅ‡∏ö‡∏ï‡∏≠‡∏≤‡∏¢‡∏∏‡∏°‡∏≤‡∏Å']
            }
        };

        const customerTypes = [
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢', problem: 'üöó‚ùå ‡∏£‡∏ñ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤', time: 15, payment: 500, type: 'repair' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏•‡∏µ', problem: 'üõëüîä ‡πÄ‡∏ö‡∏£‡∏Å‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á', time: 20, payment: 800, type: 'repair' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå', problem: 'üí°‚ùå ‡πÑ‡∏ü‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏±‡∏ö', time: 10, payment: 300, type: 'repair' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏¥‡∏î‡∏≤', problem: 'üå°Ô∏èüî• ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô', time: 25, payment: 1200, type: 'repair' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏ó‡∏ò‡πå', problem: 'üîß‚öôÔ∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', time: 12, payment: 400, type: 'repair' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏∏‡∏î‡∏≤', problem: 'üõûüîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏≤‡∏á‡∏£‡∏ñ', time: 18, payment: 600, type: 'repair' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏¥‡∏ä‡∏±‡∏¢', problem: '‚õΩüöó ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô 95', time: 5, payment: 200, type: 'fuel' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏£‡∏∏‡∏ì', problem: '‚õΩüöõ ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡∏µ‡πÄ‡∏ã‡∏•', time: 7, payment: 300, type: 'fuel' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á', problem: '‚õΩ‚ö° ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô + ‡∏ï‡∏£‡∏ß‡∏à‡∏•‡∏°', time: 8, payment: 250, type: 'fuel' },
            { name: '‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏∏‡∏ç‡∏°‡∏µ', problem: '‚õΩüßΩ ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô + ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ', time: 12, payment: 400, type: 'fuel' }
        ];

        function showMissionSelect() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('missionSelect').classList.remove('hidden');
        }

        function startMission(missionNum) {
            document.getElementById('missionSelect').classList.add('hidden');
            document.getElementById(`mission${missionNum}`).classList.remove('hidden');
            gameState.currentMission = missionNum;

            if (missionNum === 1) {
                startPitStopTimer();
            } else if (missionNum === 2) {
                setupEngineChallenge();
            } else if (missionNum === 3) {
                startGarageManager();
            }
        }

        function startPitStopTimer() {
            gameState.mission1.timer = setInterval(() => {
                gameState.mission1.timeLeft--;
                document.getElementById('countdown1').textContent = gameState.mission1.timeLeft;
                
                if (gameState.mission1.timeLeft <= 0) {
                    clearInterval(gameState.mission1.timer);
                    endMission1(false);
                }
            }, 1000);
        }

        function performTask(taskNum) {
            // Check if it's the correct task in sequence
            if (taskNum - 1 === gameState.mission1.currentTask) {
                gameState.mission1.tasks[taskNum - 1] = true;
                gameState.mission1.currentTask++;
                gameState.mission1.combo++;
                
                const taskElement = document.getElementById(`task${taskNum}`);
                taskElement.classList.remove('bg-red-900/50');
                taskElement.classList.add('bg-green-900/50', 'success-glow');
                taskElement.querySelector('span:last-child').innerHTML = '<span class="text-green-400">‚úÖ</span>';
                
                document.getElementById('combo1').textContent = gameState.mission1.combo;
                playSound('wrench');
            } else {
                // Wrong sequence - lose life
                gameState.mission1.lives--;
                gameState.mission1.combo = 0;
                
                const livesElement = document.getElementById('lives1');
                const hearts = '‚ù§Ô∏è'.repeat(gameState.mission1.lives) + 'üíî'.repeat(3 - gameState.mission1.lives);
                livesElement.textContent = hearts;
                
                document.getElementById('combo1').textContent = '0';
                document.getElementById('raceCar').classList.add('car-shake');
                
                setTimeout(() => {
                    document.getElementById('raceCar').classList.remove('car-shake');
                }, 500);
                
                playSound('fail');
                
                if (gameState.mission1.lives <= 0) {
                    clearInterval(gameState.mission1.timer);
                    endMission1(false);
                }
            }
        }

        function finishPitStop() {
            const allTasksComplete = gameState.mission1.tasks.every(task => task);
            if (allTasksComplete) {
                clearInterval(gameState.mission1.timer);
                endMission1(true);
            } else {
                alert('‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà');
            }
        }

        function endMission1(success) {
            const car = document.getElementById('raceCar');
            if (success) {
                gameState.scores.pitStop = Math.max(0, gameState.mission1.timeLeft * 10);
                car.textContent = 'üèéÔ∏èüí®';
                playSound('cheer');
                setTimeout(() => {
                    alert(`üéâ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${gameState.scores.pitStop} ‡πÅ‡∏ï‡πâ‡∏°`);
                    nextMission();
                }, 1000);
            } else {
                car.classList.add('car-shake');
                car.textContent = 'üèéÔ∏èüí•';
                playSound('fail');
                setTimeout(() => {
                    alert('‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‡∏£‡∏ñ‡πÅ‡∏Ç‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö');
                    nextMission();
                }, 1000);
            }
        }

        function setupEngineChallenge() {
            // Clear any existing timer first
            if (gameState.mission2.timer) {
                clearInterval(gameState.mission2.timer);
            }
            
            // Reset engine display
            document.getElementById('engineDisplay').textContent = 'üöó';
            document.getElementById('engineStatus').textContent = '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏™‡∏µ‡∏¢!';
            document.getElementById('engineStatus').className = 'text-2xl text-red-400';
            document.getElementById('smokeEffect').classList.add('opacity-0');
            document.getElementById('explosionEffect').classList.add('opacity-0');
            
            // Enable all parts for clicking
            document.querySelectorAll('.engine-part').forEach(part => {
                part.style.pointerEvents = 'auto';
                part.style.opacity = '1';
            });
            
            const problems = Object.keys(engineProblems);
            const randomProblem = problems[Math.floor(Math.random() * problems.length)];
            gameState.mission2.currentProblem = randomProblem;
            
            const problem = engineProblems[randomProblem];
            document.getElementById('engineProblem').textContent = problem.description;
            
            // Update symptoms with more detailed info for ‡∏õ‡∏ß‡∏ä.3 level
            const symptomsDiv = document.getElementById('symptoms');
            symptomsDiv.innerHTML = '';
            problem.symptoms.forEach(symptom => {
                const div = document.createElement('div');
                div.textContent = symptom;
                symptomsDiv.appendChild(div);
            });
            
            // Add technical hints for educational value
            const hintDiv = document.createElement('div');
            hintDiv.className = 'text-xs text-cyan-400 mt-2 p-2 bg-gray-900/50 rounded';
            hintDiv.innerHTML = `üí° <strong>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:</strong> ${getEducationalHint(randomProblem)}`;
            symptomsDiv.appendChild(hintDiv);
            
            // Start timer - reduced time for more challenge
            gameState.mission2.timeLeft = Math.max(6, 10 - gameState.mission2.round); // Gets harder each round
            gameState.mission2.timer = setInterval(() => {
                gameState.mission2.timeLeft--;
                document.getElementById('timer2').textContent = gameState.mission2.timeLeft;
                
                // Visual urgency effects
                if (gameState.mission2.timeLeft <= 3) {
                    document.getElementById('timer2').classList.add('countdown-pulse', 'text-red-500');
                }
                
                if (gameState.mission2.timeLeft <= 0) {
                    clearInterval(gameState.mission2.timer);
                    // Time's up - lose life
                    gameState.mission2.lives--;
                    updateEngineLives();
                    showTimeUpEffect();
                    if (gameState.mission2.lives > 0) {
                        setTimeout(() => nextEngineRound(), 2000);
                    } else {
                        setTimeout(() => endMission2(false), 2000);
                    }
                }
            }, 1000);
        }
        
        function updateEngineLives() {
            const livesElement = document.getElementById('lives2');
            const skulls = 'üíÄ'.repeat(gameState.mission2.lives) + '‚ò†Ô∏è'.repeat(3 - gameState.mission2.lives);
            livesElement.textContent = skulls;
        }
        
        function nextEngineRound() {
            gameState.mission2.round++;
            document.getElementById('round2').textContent = `${gameState.mission2.round}/5`;
            
            // Add progressive difficulty message
            let difficultyMsg = '';
            if (gameState.mission2.round === 2) {
                difficultyMsg = '‚ö†Ô∏è ‡∏£‡∏≠‡∏ö 2: ‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏î‡∏•‡∏á!';
            } else if (gameState.mission2.round === 3) {
                difficultyMsg = 'üî• ‡∏£‡∏≠‡∏ö 3: ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô!';
            } else if (gameState.mission2.round === 4) {
                difficultyMsg = 'üíÄ ‡∏£‡∏≠‡∏ö 4: ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏£‡∏Å!';
            } else if (gameState.mission2.round === 5) {
                difficultyMsg = 'üëπ ‡∏£‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î!';
            }
            
            if (difficultyMsg) {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-900/90 p-6 rounded-xl text-center z-50 animate-pulse';
                alertDiv.innerHTML = `
                    <div class="text-2xl font-bold text-red-300 mb-2">${difficultyMsg}</div>
                    <div class="text-sm text-gray-300">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°!</div>
                `;
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    document.body.removeChild(alertDiv);
                    if (gameState.mission2.round <= 5) {
                        setupEngineChallenge();
                    } else {
                        endMission2(true);
                    }
                }, 2000);
            } else if (gameState.mission2.round <= 5) {
                setupEngineChallenge();
            } else {
                endMission2(true);
            }
        }

        function getEducationalHint(problemType) {
            const hints = {
                smoke: '‡∏Ñ‡∏ß‡∏±‡∏ô‡∏î‡∏≥ = ‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏≤‡πÑ‡∏´‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏Ç‡πâ‡∏≤',
                noStart: '‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î + ‡∏°‡∏µ‡πÑ‡∏ü = ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô',
                oilLeak: '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏£‡∏±‡πà‡∏ß + ‡∏£‡πâ‡∏≠‡∏ô = ‡∏ã‡∏µ‡∏•‡πÄ‡∏™‡∏µ‡∏¢ ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∞‡πÄ‡∏Å‡πá‡∏ô/‡∏ã‡∏µ‡∏•',
                overHeat: '‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô + ‡πÑ‡∏≠‡∏ô‡πâ‡∏≥ = ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏°‡πâ‡∏≠‡∏ô‡πâ‡∏≥',
                electrical: '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡∏¢ + ‡πÅ‡∏ö‡∏ï‡∏´‡∏°‡∏î = ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏î‡∏ô‡∏≤‡πÇ‡∏°',
                timing: '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ + ‡∏™‡∏±‡πà‡∏ô = ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏¥‡∏î ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô',
                fuelSystem: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡πà‡∏á = ‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢ ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á',
                oilSystem: '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏™‡∏Å‡∏õ‡∏£‡∏Å + ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏á = ‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏£‡∏≠‡∏á',
                batteryDead: '‡πÑ‡∏ü‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡πÄ‡∏•‡∏¢ + ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á = ‡πÅ‡∏ö‡∏ï‡∏´‡∏°‡∏î ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà'
            };
            return hints[problemType] || '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏î‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á';
        }
        
        function showTimeUpEffect() {
            const engineDisplay = document.getElementById('engineDisplay');
            const smokeEffect = document.getElementById('smokeEffect');
            
            engineDisplay.textContent = 'üöóüí®';
            engineDisplay.classList.add('car-shake');
            smokeEffect.classList.remove('opacity-0');
            smokeEffect.classList.add('smoke-effect');
            document.getElementById('engineStatus').textContent = '‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÇ‡∏Å‡∏£‡∏ò!';
            document.getElementById('engineStatus').className = 'text-2xl text-red-400';
            
            // Disable all parts temporarily
            document.querySelectorAll('.engine-part').forEach(part => {
                part.style.pointerEvents = 'none';
                part.style.opacity = '0.5';
            });
            
            setTimeout(() => {
                engineDisplay.classList.remove('car-shake');
                smokeEffect.classList.add('opacity-0');
                smokeEffect.classList.remove('smoke-effect');
            }, 2000);
        }

        function selectPart(partType) {
            const correctPart = engineProblems[gameState.mission2.currentProblem].solution;
            const engineDisplay = document.getElementById('engineDisplay');
            const smokeEffect = document.getElementById('smokeEffect');
            const explosionEffect = document.getElementById('explosionEffect');
            
            // Disable all parts to prevent multiple clicks
            document.querySelectorAll('.engine-part').forEach(part => {
                part.style.pointerEvents = 'none';
                part.style.opacity = '0.5';
            });
            
            clearInterval(gameState.mission2.timer);
            document.getElementById('timer2').classList.remove('countdown-pulse', 'text-red-500');
            
            if (partType === correctPart) {
                // Correct answer
                engineDisplay.textContent = 'üöó‚ú®';
                document.getElementById('engineStatus').textContent = 'üéâ ‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! +10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô';
                document.getElementById('engineStatus').className = 'text-2xl text-green-400';
                
                // Show educational explanation
                const symptomsDiv = document.getElementById('symptoms');
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'text-xs text-green-400 mt-2 p-2 bg-green-900/30 rounded';
                explanationDiv.innerHTML = `‚úÖ <strong>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</strong> ${getCorrectExplanation(gameState.mission2.currentProblem)}`;
                symptomsDiv.appendChild(explanationDiv);
                
                playSound('vroom');
                
                setTimeout(() => {
                    if (gameState.mission2.round < 5) {
                        nextEngineRound();
                    } else {
                        // Calculate score with bonus for remaining lives and speed
                        const baseScore = 60;
                        const livesBonus = gameState.mission2.lives * 10;
                        const speedBonus = Math.max(0, gameState.mission2.timeLeft * 2);
                        gameState.scores.engine = Math.min(100, baseScore + livesBonus + speedBonus);
                        endMission2(true);
                    }
                }, 2000);
            } else {
                // Wrong answer - explosion!
                gameState.mission2.lives--;
                updateEngineLives();
                
                engineDisplay.classList.add('car-shake');
                explosionEffect.classList.remove('opacity-0');
                explosionEffect.classList.add('smoke-effect');
                document.getElementById('engineStatus').textContent = 'üí• ‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏î! -10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô';
                document.getElementById('engineStatus').className = 'text-2xl text-red-400';
                
                // Show educational correction
                const symptomsDiv = document.getElementById('symptoms');
                const correctionDiv = document.createElement('div');
                correctionDiv.className = 'text-xs text-red-400 mt-2 p-2 bg-red-900/30 rounded';
                correctionDiv.innerHTML = `‚ùå <strong>‡∏ú‡∏¥‡∏î!</strong> ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠: ${getPartName(correctPart)} - ${getCorrectExplanation(gameState.mission2.currentProblem)}`;
                symptomsDiv.appendChild(correctionDiv);
                
                playSound('explosion');
                
                setTimeout(() => {
                    engineDisplay.classList.remove('car-shake');
                    explosionEffect.classList.add('opacity-0');
                    explosionEffect.classList.remove('smoke-effect');
                    
                    if (gameState.mission2.lives > 0) {
                        nextEngineRound();
                    } else {
                        endMission2(false);
                    }
                }, 2500);
            }
        }
        
        function getCorrectExplanation(problemType) {
            const explanations = {
                smoke: '‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏≤‡πÑ‡∏´‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                noStart: '‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏à‡∏∏‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á',
                oilLeak: '‡∏õ‡∏∞‡πÄ‡∏Å‡πá‡∏ô‡πÅ‡∏ï‡∏Å ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏• ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô',
                overHeat: '‡∏´‡∏°‡πâ‡∏≠‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏î‡∏µ',
                electrical: '‡πÑ‡∏î‡∏ô‡∏≤‡πÇ‡∏°‡πÄ‡∏™‡∏µ‡∏¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ä‡∏≤‡∏£‡πå‡∏à‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡πÑ‡∏î‡πâ',
                timing: '‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô‡πÑ‡∏ó‡∏°‡∏¥‡πà‡∏á‡∏´‡∏•‡∏ß‡∏° ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏•‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏™‡∏π‡∏ö‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô',
                fuelSystem: '‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡πÑ‡∏î‡πâ',
                oilSystem: '‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÑ‡∏´‡∏•‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô',
                batteryDead: '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏∏‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÑ‡∏î‡πâ'
            };
            return explanations[problemType] || '‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        }
        
        function getPartName(partType) {
            const names = {
                airFilter: '‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®',
                sparkPlug: '‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô',
                gasket: '‡∏õ‡∏∞‡πÄ‡∏Å‡πá‡∏ô',
                oilFilter: '‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô',
                fuelPump: '‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô',
                radiator: '‡∏´‡∏°‡πâ‡∏≠‡∏ô‡πâ‡∏≥',
                battery: '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà',
                alternator: '‡πÑ‡∏î‡∏ô‡∏≤‡πÇ‡∏°',
                timing: '‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô‡πÑ‡∏ó‡∏°‡∏¥‡πà‡∏á'
            };
            return names[partType] || partType;
        }
        
        function endMission2(success) {
            clearInterval(gameState.mission2.timer);
            if (success) {
                alert(`üéâ ‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô Engine Nightmare! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${gameState.scores.engine}`);
            } else {
                alert('üíÄ Game Over! ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏´‡∏°‡∏î!');
            }
            nextMission();
        }

        function startGarageManager() {
            // Initialize service bays (only 2 active initially)
            gameState.mission3.totalBays = 6;
            gameState.mission3.activeBays = 2;
            gameState.mission3.mechanicAnimations = {};
            
            // Start countdown timer
            gameState.mission3.timer = setInterval(() => {
                gameState.mission3.timeLeft--;
                document.getElementById('timeLeft3').textContent = gameState.mission3.timeLeft;
                
                if (gameState.mission3.timeLeft <= 0) {
                    endMission3();
                }
            }, 1000);
            
            // Add initial customers rapidly
            addCustomer();
            addCustomer();
            gameState.mission3.customerTimer = setInterval(addCustomer, 8000); // New customer every 8 seconds
            
            // Random emergencies
            gameState.mission3.emergencyTimer = setInterval(addEmergency, 20000);
            
            // Initialize bay display
            updateServiceBays();
        }
        
        function addEmergency() {
            const emergencies = [
                { text: 'üö® ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ VIP ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á! ‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô!', effect: 'vip' },
                { text: '‚ö° ‡πÑ‡∏ü‡∏î‡∏±‡∏ö! ‡∏ä‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ä‡πâ‡∏≤‡∏•‡∏á 50%!', effect: 'blackout' },
                { text: 'üîß ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏´‡∏≤‡∏¢! ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà 200‡∏ø!', effect: 'tools' }
            ];
            
            const emergency = emergencies[Math.floor(Math.random() * emergencies.length)];
            const alertDiv = document.createElement('div');
            alertDiv.className = 'bg-red-900/70 p-3 rounded-lg text-center animate-pulse';
            alertDiv.innerHTML = `
                <div class="text-sm font-bold text-red-300">${emergency.text}</div>
                <button onclick="handleEmergency('${emergency.effect}', this)" class="mt-2 bg-red-600 hover:bg-red-700 px-4 py-1 rounded text-xs">
                    ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                </button>
            `;
            
            document.getElementById('emergencyAlerts').appendChild(alertDiv);
        }
        
        function handleEmergency(type, button) {
            if (type === 'vip') {
                // Add VIP customer to front of queue
                const vipCustomer = {
                    name: 'üëë VIP ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                    problem: 'üíé ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©',
                    time: 30,
                    payment: 2000,
                    id: Date.now(),
                    waitTime: 0,
                    isVip: true
                };
                gameState.mission3.customers.unshift(vipCustomer);
            } else if (type === 'blackout') {
                // Slow down all services
                gameState.mission3.bays.forEach((bay, index) => {
                    if (bay) bay.time += 10;
                });
            } else if (type === 'tools') {
                gameState.mission3.revenue = Math.max(0, gameState.mission3.revenue - 200);
            }
            
            button.parentElement.remove();
            updateCustomerQueue();
            updateManagerStats();
        }
        
        function selectCustomer(customerId) {
            gameState.mission3.selectedCustomer = customerId;
            // Highlight selected customer
            document.querySelectorAll('#customerQueue > div').forEach(div => {
                div.classList.remove('bg-blue-900/50');
            });
            event.target.closest('div').classList.add('bg-blue-900/50');
        }
        
        function updateServiceBays() {
            const serviceBaysDiv = document.getElementById('serviceBays');
            serviceBaysDiv.innerHTML = '';
            
            for (let i = 0; i < gameState.mission3.totalBays; i++) {
                const bayDiv = document.createElement('div');
                bayDiv.id = `bay${i + 1}`;
                
                if (i < gameState.mission3.activeBays) {
                    // Active bay
                    bayDiv.className = 'customer-queue p-3 rounded-xl text-center min-h-20 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-600 transition-all';
                    bayDiv.onclick = () => selectBay(i);
                    bayDiv.innerHTML = `<span class="text-gray-400">‡∏ä‡πà‡∏≠‡∏á ${i + 1} (‡∏ß‡πà‡∏≤‡∏á)</span>`;
                } else {
                    // Locked bay
                    bayDiv.className = 'bg-gray-800/50 p-3 rounded-xl text-center min-h-20 flex flex-col items-center justify-center border-2 border-dashed border-gray-600';
                    bayDiv.innerHTML = `
                        <span class="text-gray-600">üîí ‡∏ä‡πà‡∏≠‡∏á ${i + 1}</span>
                        <span class="text-xs text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î</span>
                    `;
                }
                
                serviceBaysDiv.appendChild(bayDiv);
            }
        }
        
        function selectBay(bayIndex) {
            if (gameState.mission3.selectedCustomer && gameState.mission3.bays[bayIndex] === null) {
                const customer = gameState.mission3.customers.find(c => c.id === gameState.mission3.selectedCustomer);
                if (customer && customer.type === 'repair') {
                    assignToBay(gameState.mission3.selectedCustomer, bayIndex);
                    gameState.mission3.selectedCustomer = null;
                    document.querySelectorAll('#customerQueue > div').forEach(div => {
                        div.classList.remove('bg-blue-900/50');
                    });
                } else {
                    alert('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô!');
                }
            }
        }
        
        function selectFuelStation(stationIndex) {
            if (gameState.mission3.selectedCustomer && gameState.mission3.fuelStations[stationIndex] === null) {
                const customer = gameState.mission3.customers.find(c => c.id === gameState.mission3.selectedCustomer);
                if (customer && customer.type === 'fuel') {
                    assignToFuelStation(gameState.mission3.selectedCustomer, stationIndex);
                    gameState.mission3.selectedCustomer = null;
                    document.querySelectorAll('#customerQueue > div').forEach(div => {
                        div.classList.remove('bg-blue-900/50');
                    });
                } else {
                    alert('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°!');
                }
            }
        }
        
        function buyServiceBay() {
            if (gameState.mission3.revenue >= 1500 && gameState.mission3.activeBays < gameState.mission3.totalBays) {
                gameState.mission3.revenue -= 1500;
                gameState.mission3.activeBays++;
                
                // Expand bays array
                gameState.mission3.bays.push(null);
                
                updateServiceBays();
                updateManagerStats();
                
                document.getElementById('buyBayBtn').textContent = `üèóÔ∏è ‡∏ã‡∏∑‡πâ‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° (1,500‡∏ø) [${gameState.mission3.activeBays}/${gameState.mission3.totalBays}]`;
                
                if (gameState.mission3.activeBays >= gameState.mission3.totalBays) {
                    document.getElementById('buyBayBtn').textContent = '‚úÖ ‡∏ä‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß';
                    document.getElementById('buyBayBtn').disabled = true;
                }
                
                playSound('cheer');
            } else if (gameState.mission3.revenue < 1500) {
                alert('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 1,500‡∏ø');
            } else {
                alert('‡∏ä‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
            }
        }
        
        function buyFuelStation() {
            if (gameState.mission3.revenue >= 2000 && gameState.mission3.fuelStations.length < 4) {
                gameState.mission3.revenue -= 2000;
                gameState.mission3.fuelStations.push(null);
                
                const fuelDiv = document.querySelector('#fuel1').parentElement;
                const newFuelStation = document.createElement('div');
                newFuelStation.id = `fuel${gameState.mission3.fuelStations.length}`;
                newFuelStation.className = 'bg-yellow-900/50 p-3 rounded-xl text-center min-h-16 flex items-center justify-center cursor-pointer hover:bg-yellow-800/50';
                newFuelStation.onclick = () => selectFuelStation(gameState.mission3.fuelStations.length - 1);
                newFuelStation.innerHTML = `<span class="text-gray-400">‡∏õ‡∏±‡πä‡∏° ${gameState.mission3.fuelStations.length} (‡∏ß‡πà‡∏≤‡∏á)</span>`;
                
                fuelDiv.appendChild(newFuelStation);
                updateManagerStats();
                
                document.getElementById('buyFuelBtn').textContent = `‚õΩ ‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° (2,000‡∏ø) [${gameState.mission3.fuelStations.length}/4]`;
                
                if (gameState.mission3.fuelStations.length >= 4) {
                    document.getElementById('buyFuelBtn').textContent = '‚úÖ ‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß';
                    document.getElementById('buyFuelBtn').disabled = true;
                }
                
                playSound('cheer');
            } else if (gameState.mission3.revenue < 2000) {
                alert('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 2,000‡∏ø');
            } else {
                alert('‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
            }
        }
        
        function hireExtraStaff() {
            if (gameState.mission3.revenue >= 800 && !gameState.mission3.extraStaff) {
                gameState.mission3.revenue -= 800;
                gameState.mission3.extraStaff = true;
                document.getElementById('hireBtn').textContent = '‚úÖ ‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß';
                document.getElementById('hireBtn').disabled = true;
                
                // Reduce service time by 25% for future services
                alert('üéâ ‡∏à‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô 25%');
                updateManagerStats();
                playSound('cheer');
            } else if (gameState.mission3.revenue < 800) {
                alert('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 800‡∏ø');
            }
        }
        
        function rushService() {
            if (gameState.mission3.revenue >= 500 && !gameState.mission3.rushMode) {
                gameState.mission3.revenue -= 500;
                gameState.mission3.rushMode = true;
                document.getElementById('rushBtn').textContent = 'üö® ‡πÇ‡∏´‡∏°‡∏î‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡∏¥‡∏î';
                document.getElementById('rushBtn').disabled = true;
                
                // Speed up all current services by reducing remaining time
                gameState.mission3.bays.forEach((bay, index) => {
                    if (bay && gameState.mission3.mechanicAnimations[index]) {
                        // Speed up current animations
                        const bayElement = document.getElementById(`bay${index + 1}`);
                        const timeDiv = bayElement.querySelector('.text-yellow-400');
                        if (timeDiv) {
                            const currentTime = parseInt(timeDiv.textContent.match(/\d+/)[0]);
                            const newTime = Math.max(2, Math.floor(currentTime / 2));
                            timeDiv.textContent = `‚è±Ô∏è ${newTime}s`;
                        }
                    }
                });
                
                alert('üö® ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏î‡πà‡∏ß‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©! ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô!');
                updateManagerStats();
                playSound('cheer');
            } else if (gameState.mission3.revenue < 500) {
                alert('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 500‡∏ø');
            }
        }
        
        function endMission3() {
            // Clear all timers
            clearInterval(gameState.mission3.timer);
            clearInterval(gameState.mission3.customerTimer);
            clearInterval(gameState.mission3.emergencyTimer);
            
            // Clear all mechanic animations
            Object.values(gameState.mission3.mechanicAnimations).forEach(timer => {
                clearInterval(timer);
            });
            
            // Calculate score based on services completed
            if (gameState.mission3.served >= 10) {
                let baseScore = 70; // Base score for completing 10 services
                let bonusScore = Math.min(30, gameState.mission3.satisfaction - 70); // Bonus for high satisfaction
                let efficiencyBonus = Math.max(0, gameState.mission3.timeLeft) / 2; // Time bonus
                
                gameState.scores.manager = Math.min(100, baseScore + bonusScore + efficiencyBonus);
                
                alert(`üéâ ‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô Chaos Manager! 
                ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${gameState.mission3.served}/10
                ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à: ${gameState.mission3.satisfaction}%
                ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°: ${gameState.mission3.revenue}‡∏ø
                ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${Math.round(gameState.scores.manager)}`);
            } else {
                // Partial score for incomplete mission
                gameState.scores.manager = Math.max(0, (gameState.mission3.served / 10) * 50);
                alert(`‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! 
                ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ: ${gameState.mission3.served}/10
                ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à: ${gameState.mission3.satisfaction}%
                ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°: ${gameState.mission3.revenue}‡∏ø
                ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${Math.round(gameState.scores.manager)}`);
            }
            
            showResults();
        }

        function addCustomer() {
            if (gameState.mission3.customers.length < 6) {
                const customer = customerTypes[Math.floor(Math.random() * customerTypes.length)];
                customer.id = Date.now();
                customer.waitTime = 0;
                gameState.mission3.customers.push(customer);
                updateCustomerQueue();
            }
        }

        function updateCustomerQueue() {
            const queue = document.getElementById('customerQueue');
            queue.innerHTML = '';
            
            gameState.mission3.customers.forEach((customer, index) => {
                const customerDiv = document.createElement('div');
                customerDiv.className = 'customer-queue p-2 rounded-lg cursor-pointer hover:bg-gray-600 transition-all';
                customerDiv.onclick = () => selectCustomer(customer.id);
                
                const urgency = customer.waitTime > 40 ? 'üî•' : customer.waitTime > 20 ? '‚ö†Ô∏è' : customer.isVip ? 'üëë' : 'üòä';
                const bgColor = customer.isVip ? 'bg-yellow-900/50' : customer.waitTime > 40 ? 'bg-red-900/50' : '';
                const serviceIcon = customer.type === 'fuel' ? '‚õΩ' : 'üîß';
                
                customerDiv.className += ` ${bgColor}`;
                
                customerDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-bold text-sm">${urgency} ${customer.name}</div>
                            <div class="text-xs text-gray-300">${serviceIcon} ${customer.problem}</div>
                            <div class="text-xs text-yellow-400">‡∏£‡∏≠: ${customer.waitTime}s | ‡∏à‡πà‡∏≤‡∏¢: ${customer.payment}‡∏ø</div>
                        </div>
                        <div class="text-lg">${customer.type === 'fuel' ? 'üöó‚õΩ' : 'üöóüîß'}</div>
                    </div>
                `;
                
                queue.appendChild(customerDiv);
            });
        }

        function assignToBay(customerId, bayIndex) {
            const customer = gameState.mission3.customers.find(c => c.id === customerId);
            
            if (customer && gameState.mission3.bays[bayIndex] === null) {
                gameState.mission3.bays[bayIndex] = customer;
                gameState.mission3.customers = gameState.mission3.customers.filter(c => c.id !== customerId);
                
                const bayElement = document.getElementById(`bay${bayIndex + 1}`);
                bayElement.innerHTML = `
                    <div class="text-center">
                        <div class="text-sm font-bold">${customer.name}</div>
                        <div class="text-xs">${customer.problem}</div>
                        <div class="text-xs text-yellow-400">‚è±Ô∏è ${customer.time}s</div>
                        <div class="text-lg animate-bounce">üë∑‚Äç‚ôÇÔ∏èüîß</div>
                    </div>
                `;
                bayElement.classList.add('bg-blue-900/50');
                
                // Animate mechanic working
                animateMechanic(bayIndex, customer.time);
                
                // Start service timer
                setTimeout(() => {
                    completeService(bayIndex, customer, 'repair');
                }, customer.time * 1000);
                
                updateCustomerQueue();
            }
        }
        
        function assignToFuelStation(customerId, stationIndex) {
            const customer = gameState.mission3.customers.find(c => c.id === customerId);
            
            if (customer && gameState.mission3.fuelStations[stationIndex] === null) {
                gameState.mission3.fuelStations[stationIndex] = customer;
                gameState.mission3.customers = gameState.mission3.customers.filter(c => c.id !== customerId);
                
                const stationElement = document.getElementById(`fuel${stationIndex + 1}`);
                stationElement.innerHTML = `
                    <div class="text-center">
                        <div class="text-sm font-bold">${customer.name}</div>
                        <div class="text-xs">${customer.problem}</div>
                        <div class="text-xs text-yellow-400">‚è±Ô∏è ${customer.time}s</div>
                        <div class="text-lg animate-pulse">‚õΩüí®</div>
                    </div>
                `;
                stationElement.classList.add('bg-yellow-800/70');
                
                // Start service timer
                setTimeout(() => {
                    completeService(stationIndex, customer, 'fuel');
                }, customer.time * 1000);
                
                updateCustomerQueue();
            }
        }
        
        function animateMechanic(bayIndex, duration) {
            const bayElement = document.getElementById(`bay${bayIndex + 1}`);
            let timeLeft = duration;
            
            const mechanicTimer = setInterval(() => {
                timeLeft--;
                const mechanicDiv = bayElement.querySelector('.text-lg');
                if (mechanicDiv) {
                    // Rotate between different mechanic animations
                    const animations = ['üë∑‚Äç‚ôÇÔ∏èüîß', 'üë∑‚Äç‚ôÇÔ∏èüî®', 'üë∑‚Äç‚ôÇÔ∏è‚öôÔ∏è', 'üë∑‚Äç‚ôÇÔ∏èüõ†Ô∏è'];
                    mechanicDiv.textContent = animations[timeLeft % animations.length];
                    
                    // Update time display
                    const timeDiv = bayElement.querySelector('.text-yellow-400');
                    if (timeDiv) {
                        timeDiv.textContent = `‚è±Ô∏è ${timeLeft}s`;
                    }
                }
                
                if (timeLeft <= 0) {
                    clearInterval(mechanicTimer);
                }
            }, 1000);
            
            gameState.mission3.mechanicAnimations[bayIndex] = mechanicTimer;
        }

        function completeService(index, customer, serviceType) {
            gameState.mission3.revenue += customer.payment;
            gameState.mission3.served++;
            
            if (serviceType === 'repair') {
                gameState.mission3.bays[index] = null;
                
                // Clear mechanic animation
                if (gameState.mission3.mechanicAnimations[index]) {
                    clearInterval(gameState.mission3.mechanicAnimations[index]);
                    delete gameState.mission3.mechanicAnimations[index];
                }
                
                const bayElement = document.getElementById(`bay${index + 1}`);
                bayElement.innerHTML = `<span class="text-gray-400">‡∏ä‡πà‡∏≠‡∏á ${index + 1} (‡∏ß‡πà‡∏≤‡∏á)</span>`;
                bayElement.classList.remove('bg-blue-900/50');
                bayElement.classList.add('success-glow');
                
                setTimeout(() => {
                    bayElement.classList.remove('success-glow');
                }, 1000);
                
            } else if (serviceType === 'fuel') {
                gameState.mission3.fuelStations[index] = null;
                
                const stationElement = document.getElementById(`fuel${index + 1}`);
                stationElement.innerHTML = `<span class="text-gray-400">‡∏õ‡∏±‡πä‡∏° ${index + 1} (‡∏ß‡πà‡∏≤‡∏á)</span>`;
                stationElement.classList.remove('bg-yellow-800/70');
                stationElement.classList.add('success-glow');
                
                setTimeout(() => {
                    stationElement.classList.remove('success-glow');
                }, 1000);
            }
            
            // Update served counter
            document.getElementById('served').textContent = `${gameState.mission3.served}/10`;
            
            updateManagerStats();
            
            // Show completion effect
            playSound('cheer');
            
            // Check win condition - complete 10 services
            if (gameState.mission3.served >= 10) {
                setTimeout(() => {
                    endMission3();
                }, 1000);
            }
        }

        function updateManagerStats() {
            // Decrease satisfaction for waiting customers
            gameState.mission3.customers.forEach(customer => {
                customer.waitTime += 1;
                if (customer.waitTime > 30) {
                    gameState.mission3.satisfaction = Math.max(0, gameState.mission3.satisfaction - 2);
                }
            });
            
            document.getElementById('satisfaction').textContent = `üòä ${gameState.mission3.satisfaction}%`;
            document.getElementById('revenue').textContent = `üí∞ ${gameState.mission3.revenue}`;
            
            updateCustomerQueue();
        }

        // Update customer wait times
        setInterval(() => {
            if (gameState.currentMission === 3) {
                updateManagerStats();
            }
        }, 1000);

        function nextMission() {
            document.getElementById(`mission${gameState.currentMission}`).classList.add('hidden');
            
            if (gameState.currentMission < 3) {
                document.getElementById('missionSelect').classList.remove('hidden');
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById(`mission${gameState.currentMission}`).classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            
            // Update individual scores
            document.getElementById('score1').textContent = gameState.scores.pitStop;
            document.getElementById('score2').textContent = gameState.scores.engine;
            document.getElementById('score3').textContent = gameState.scores.manager;
            
            const totalScore = gameState.scores.pitStop + gameState.scores.engine + gameState.scores.manager;
            document.getElementById('finalScore').textContent = totalScore;
            
            // Determine rank and performance level
            let rank, rankColor, rankDescription;
            if (totalScore >= 250) {
                rank = 'üëë GARAGE MASTER';
                rankColor = 'text-yellow-400';
                rankDescription = '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ó‡∏û! ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏•‡∏Å!';
            } else if (totalScore >= 200) {
                rank = 'üèÜ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏õ‡∏£';
                rankColor = 'text-purple-400';
                rankDescription = '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß';
            } else if (totalScore >= 150) {
                rank = 'ü•á ‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç';
                rankColor = 'text-blue-400';
                rankDescription = '‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏°‡∏µ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û';
            } else if (totalScore >= 100) {
                rank = 'ü•à ‡∏ä‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô';
                rankColor = 'text-green-400';
                rankDescription = '‡∏î‡∏µ! ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏ï‡πà‡∏≠';
            } else if (totalScore >= 50) {
                rank = 'ü•â ‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà';
                rankColor = 'text-orange-400';
                rankDescription = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°';
            } else {
                rank = 'üî∞ ‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î';
                rankColor = 'text-red-400';
                rankDescription = '‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ!';
            }
            
            document.getElementById('rank').innerHTML = `<span class="${rankColor}">${rank}</span>`;
            document.getElementById('rank').innerHTML += `<div class="text-lg text-gray-300 mt-2">${rankDescription}</div>`;
            
            // Career path analysis
            analyzeCareerPath(totalScore);
            
            // Global comparison
            updateGlobalStats(totalScore);
            
            // Achievement system
            updateAchievements();
        }
        
        function analyzeCareerPath(totalScore) {
            const scores = gameState.scores;
            const maxScore = Math.max(scores.pitStop, scores.engine, scores.manager);
            
            let careerPath = '';
            let careerDescription = '';
            let salaryRange = '';
            let strengths = [];
            let improvements = [];
            
            // Determine primary career path
            if (maxScore === scores.pitStop) {
                careerPath = 'üèÅ ‡∏ä‡πà‡∏≤‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô (Quick Service Technician)';
                careerDescription = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏î‡∏±‡∏ô ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏≤‡∏á ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô';
                salaryRange = 'üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: 18,000 - 35,000 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
                
                if (scores.pitStop >= 80) strengths.push('‚ö° ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å');
                if (scores.pitStop >= 60) strengths.push('üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô');
                if (scores.engine < 50) improvements.push('üîß ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
                if (scores.manager < 50) improvements.push('üë• ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤');
                
            } else if (maxScore === scores.engine) {
                careerPath = 'üîß ‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå (Engine Specialist)';
                careerDescription = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á';
                salaryRange = 'üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: 25,000 - 50,000 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
                
                if (scores.engine >= 80) strengths.push('üß† ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏π‡∏á');
                if (scores.engine >= 60) strengths.push('üîç ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡∏µ');
                if (scores.pitStop < 50) improvements.push('‚ö° ‡∏Ñ‡∏ß‡∏£‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô');
                if (scores.manager < 50) improvements.push('üíº ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô');
                
            } else {
                careerPath = 'üëî ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (Service Manager)';
                careerDescription = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå';
                salaryRange = 'üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: 30,000 - 80,000 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
                
                if (scores.manager >= 80) strengths.push('üë• ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏á');
                if (scores.manager >= 60) strengths.push('üòä ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°');
                if (scores.pitStop < 50) improvements.push('üîß ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°');
                if (scores.engine < 50) improvements.push('‚öôÔ∏è ‡∏Ñ‡∏ß‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
            }
            
            // Secondary skills analysis
            let secondarySkills = [];
            if (scores.pitStop >= 70 && maxScore !== scores.pitStop) {
                secondarySkills.push('üèÅ ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©');
            }
            if (scores.engine >= 70 && maxScore !== scores.engine) {
                secondarySkills.push('üîß ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©');
            }
            if (scores.manager >= 70 && maxScore !== scores.manager) {
                secondarySkills.push('üëî ‡∏°‡∏µ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©');
            }
            
            // Update UI
            document.getElementById('careerPath').innerHTML = careerPath;
            document.getElementById('careerDescription').innerHTML = careerDescription;
            document.getElementById('salaryRange').innerHTML = salaryRange;
            
            // Add detailed analysis
            let analysisHTML = '<div class="mt-4 space-y-3">';
            
            if (strengths.length > 0) {
                analysisHTML += '<div class="bg-green-900/30 p-3 rounded-lg">';
                analysisHTML += '<h4 class="text-green-400 font-bold mb-2">üåü ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</h4>';
                strengths.forEach(strength => {
                    analysisHTML += `<div class="text-sm text-green-300">‚Ä¢ ${strength}</div>`;
                });
                analysisHTML += '</div>';
            }
            
            if (secondarySkills.length > 0) {
                analysisHTML += '<div class="bg-blue-900/30 p-3 rounded-lg">';
                analysisHTML += '<h4 class="text-blue-400 font-bold mb-2">‚ú® ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏°:</h4>';
                secondarySkills.forEach(skill => {
                    analysisHTML += `<div class="text-sm text-blue-300">‚Ä¢ ${skill}</div>`;
                });
                analysisHTML += '</div>';
            }
            
            if (improvements.length > 0) {
                analysisHTML += '<div class="bg-yellow-900/30 p-3 rounded-lg">';
                analysisHTML += '<h4 class="text-yellow-400 font-bold mb-2">üìà ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤:</h4>';
                improvements.forEach(improvement => {
                    analysisHTML += `<div class="text-sm text-yellow-300">‚Ä¢ ${improvement}</div>`;
                });
                analysisHTML += '</div>';
            }
            
            analysisHTML += '</div>';
            document.getElementById('careerDescription').innerHTML += analysisHTML;
        }
        
        function updateGlobalStats(totalScore) {
            // Simulate global comparison
            let percentile, betterThan, worldRank;
            
            if (totalScore >= 250) {
                percentile = 99;
                betterThan = 99;
                worldRank = Math.floor(Math.random() * 100) + 1;
            } else if (totalScore >= 200) {
                percentile = 95;
                betterThan = 95;
                worldRank = Math.floor(Math.random() * 500) + 100;
            } else if (totalScore >= 150) {
                percentile = 80;
                betterThan = 80;
                worldRank = Math.floor(Math.random() * 2000) + 500;
            } else if (totalScore >= 100) {
                percentile = 60;
                betterThan = 60;
                worldRank = Math.floor(Math.random() * 5000) + 2000;
            } else if (totalScore >= 50) {
                percentile = 30;
                betterThan = 30;
                worldRank = Math.floor(Math.random() * 10000) + 5000;
            } else {
                percentile = 10;
                betterThan = 10;
                worldRank = Math.floor(Math.random() * 20000) + 10000;
            }
            
            document.getElementById('percentile').textContent = `${percentile}%`;
            document.getElementById('betterThan').textContent = `${betterThan}%`;
            document.getElementById('worldRank').textContent = `#${worldRank}`;
        }
        
        function updateAchievements() {
            const badges = [];
            const scores = gameState.scores;
            
            // Performance badges
            if (scores.pitStop >= 90) badges.push({ emoji: '‚ö°', name: 'Speed Demon', desc: 'Pit Stop ‡πÄ‡∏ó‡∏û!' });
            if (scores.engine >= 90) badges.push({ emoji: 'üîß', name: 'Engine Master', desc: '‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå!' });
            if (scores.manager >= 90) badges.push({ emoji: 'üëë', name: 'Boss Level', desc: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ó‡∏û!' });
            
            // Combo badges
            if (gameState.mission1.combo >= 6) badges.push({ emoji: 'üî•', name: 'Perfect Combo', desc: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!' });
            if (gameState.mission2.lives === 3) badges.push({ emoji: 'üíÄ', name: 'Survivor', desc: '‡∏£‡∏≠‡∏î‡∏ï‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î!' });
            if (gameState.mission3.satisfaction >= 95) badges.push({ emoji: 'üòç', name: 'Customer Love', desc: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏á‡∏£‡∏±‡∏Å!' });
            
            // Special achievements
            const totalScore = scores.pitStop + scores.engine + scores.manager;
            if (totalScore >= 250) badges.push({ emoji: 'üèÜ', name: 'Garage Legend', desc: '‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå!' });
            if (totalScore >= 200) badges.push({ emoji: 'üåü', name: 'Pro Mechanic', desc: '‡∏ä‡πà‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û!' });
            if (Math.min(scores.pitStop, scores.engine, scores.manager) >= 60) {
                badges.push({ emoji: '‚öñÔ∏è', name: 'All-Rounder', desc: '‡πÄ‡∏Å‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏î‡πâ‡∏≤‡∏ô!' });
            }
            
            // Update badges display
            const badgeList = document.getElementById('badgeList');
            badgeList.innerHTML = '';
            
            if (badges.length === 0) {
                badgeList.innerHTML = '<div class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà!</div>';
            } else {
                badges.forEach(badge => {
                    const badgeDiv = document.createElement('div');
                    badgeDiv.className = 'bg-gradient-to-br from-yellow-600/50 to-orange-600/50 rounded-xl p-3 text-center m-1 neon-border';
                    badgeDiv.innerHTML = `
                        <div class="text-2xl mb-1">${badge.emoji}</div>
                        <div class="text-xs font-bold text-yellow-300">${badge.name}</div>
                        <div class="text-xs text-gray-300">${badge.desc}</div>
                    `;
                    badgeList.appendChild(badgeDiv);
                });
            }
        }

        function restartGame() {
            gameState = {
                currentMission: 0,
                scores: { pitStop: 0, engine: 0, manager: 0 },
                mission1: { tasks: [false, false, false], timeLeft: 30, timer: null },
                mission2: { currentProblem: 'smoke', solved: false },
                mission3: { customers: [], satisfaction: 100, revenue: 0, bays: [null, null, null, null] }
            };
            
            document.getElementById('results').classList.add('hidden');
            document.getElementById('missionSelect').classList.remove('hidden');
            
            // Reset mission 1
            document.getElementById('countdown1').textContent = '30';
            for (let i = 1; i <= 3; i++) {
                const task = document.getElementById(`task${i}`);
                task.classList.remove('bg-green-900/50', 'success-glow');
                task.classList.add('bg-red-900/50');
                task.querySelector('span:last-child').innerHTML = '<span class="text-red-400">‚ùå</span>';
            }
            document.getElementById('raceCar').textContent = 'üèéÔ∏è';
            
            // Reset mission 2
            document.getElementById('engineDisplay').textContent = 'üöó';
            document.getElementById('engineStatus').textContent = '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏™‡∏µ‡∏¢!';
            document.getElementById('engineStatus').className = 'text-2xl text-red-400';
            
            // Reset mission 3
            document.getElementById('customerQueue').innerHTML = '';
            for (let i = 1; i <= 4; i++) {
                const bay = document.getElementById(`bay${i}`);
                bay.innerHTML = '<span class="text-gray-400">‡∏ß‡πà‡∏≤‡∏á</span>';
                bay.className = 'customer-queue p-4 rounded-xl text-center min-h-24 flex items-center justify-center';
            }
            document.getElementById('satisfaction').textContent = 'üòä 100%';
            document.getElementById('revenue').textContent = 'üí∞ 0';
        }

        function playSound(type) {
            // Sound effect simulation with visual feedback
            const sounds = {
                wrench: 'üîß‚ú®',
                cheer: 'üéâüèÅ',
                fail: 'üí•‚ùå',
                vroom: 'üöóüí®',
                explosion: 'üí•üî•'
            };
            
            // Create temporary sound effect display
            const soundDiv = document.createElement('div');
            soundDiv.textContent = sounds[type] || 'üîä';
            soundDiv.className = 'fixed top-4 right-4 text-4xl z-50 animate-bounce';
            document.body.appendChild(soundDiv);
            
            setTimeout(() => {
                document.body.removeChild(soundDiv);
            }, 1500);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9784982015d77b68',t:'MTc1NjcyNzg5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
