<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuit Symphony Pro - วงจรซิมโฟนีโปร</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;600&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* PCB Board Styling */
        .pcb-board {
            background: linear-gradient(45deg, #1a4d3a 0%, #2d5a3d 50%, #1a4d3a 100%);
            border: 3px solid #4ade80;
            position: relative;
            box-shadow: 
                inset 0 0 20px rgba(74, 222, 128, 0.3),
                0 0 30px rgba(74, 222, 128, 0.2);
        }
        
        .pcb-board::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20px 20px, #4ade80 1px, transparent 1px),
                radial-gradient(circle at 60px 60px, #4ade80 1px, transparent 1px);
            background-size: 40px 40px, 80px 80px;
            opacity: 0.3;
            pointer-events: none;
        }
        
        /* Component Styling */
        .component {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: grab;
            position: relative;
            transform-style: preserve-3d;
        }
        
        .component:hover {
            transform: translateY(-2px) scale(1.05);
            filter: brightness(1.2) drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }
        
        .component.dragging {
            cursor: grabbing;
            transform: rotate(5deg) scale(1.1) translateZ(50px);
            z-index: 1000;
            filter: brightness(1.3) drop-shadow(0 10px 25px rgba(0,0,0,0.5));
        }
        
        /* Resistor */
        .resistor {
            background: linear-gradient(90deg, #8B4513 0%, #D2691E 20%, #FF6347 40%, #FFD700 60%, #32CD32 80%, #8B4513 100%);
            border: 2px solid #654321;
            border-radius: 15px;
            position: relative;
        }
        
        .resistor::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -5px;
            right: -5px;
            height: 2px;
            background: #C0C0C0;
            transform: translateY(-50%);
        }
        
        /* Capacitor */
        .capacitor {
            background: linear-gradient(90deg, #4169E1 0%, #1E90FF 50%, #4169E1 100%);
            border: 2px solid #000080;
            border-radius: 8px;
            position: relative;
        }
        
        .capacitor::before {
            content: '';
            position: absolute;
            top: 10%;
            bottom: 10%;
            left: 45%;
            width: 2px;
            background: #FFD700;
        }
        
        .capacitor::after {
            content: '';
            position: absolute;
            top: 10%;
            bottom: 10%;
            right: 45%;
            width: 2px;
            background: #FFD700;
        }
        
        /* IC Chip */
        .ic-chip {
            background: linear-gradient(135deg, #2C2C2C 0%, #1C1C1C 50%, #2C2C2C 100%);
            border: 2px solid #444;
            border-radius: 4px;
            position: relative;
        }
        
        .ic-chip::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            width: 8px;
            height: 4px;
            background: #FFD700;
            border-radius: 2px;
            transform: translateX(-50%);
        }
        
        /* LED */
        .led {
            background: radial-gradient(circle, #FF4444 0%, #CC0000 70%);
            border: 2px solid #990000;
            border-radius: 50%;
            position: relative;
            animation: ledPulse 2s infinite;
        }
        
        @keyframes ledPulse {
            0%, 100% { box-shadow: 0 0 5px #FF4444; }
            50% { box-shadow: 0 0 20px #FF4444, 0 0 30px #FF4444; }
        }
        
        /* Transistor */
        .transistor {
            background: linear-gradient(45deg, #2F4F4F 0%, #708090 50%, #2F4F4F 100%);
            border: 2px solid #1C1C1C;
            border-radius: 50% 50% 0 0;
            position: relative;
        }
        
        .transistor::before {
            content: 'T';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        /* Diode */
        .diode {
            background: linear-gradient(90deg, #8B008B 0%, #FF1493 50%, #8B008B 100%);
            border: 2px solid #4B0082;
            border-radius: 20px;
            position: relative;
        }
        
        .diode::before {
            content: '▶';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
        }
        
        /* Connection Points */
        .connection-point {
            width: 12px;
            height: 12px;
            background: #FFD700;
            border: 2px solid #FFA500;
            border-radius: 50%;
            position: absolute;
            cursor: crosshair;
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .connection-point:hover {
            background: #FF6347;
            transform: scale(1.3);
            box-shadow: 0 0 10px #FF6347;
        }
        
        .connection-point.connected {
            background: #32CD32;
            border-color: #228B22;
            box-shadow: 0 0 8px #32CD32;
        }
        
        /* Wire Connections */
        .wire {
            stroke: #FFD700;
            stroke-width: 3;
            fill: none;
            filter: drop-shadow(0 0 3px #FFD700);
            transition: all 0.3s ease;
        }
        
        .wire.active {
            stroke: #32CD32;
            stroke-width: 4;
            filter: drop-shadow(0 0 8px #32CD32);
            animation: wireFlow 1s infinite;
        }
        
        @keyframes wireFlow {
            0% { stroke-dasharray: 0 10; }
            100% { stroke-dasharray: 10 0; }
        }
        
        /* Breadboard */
        .breadboard {
            background: linear-gradient(90deg, #F5F5DC 0%, #FFFACD 50%, #F5F5DC 100%);
            border: 3px solid #DDD;
            position: relative;
        }
        
        .breadboard-hole {
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
            position: absolute;
            box-shadow: inset 0 0 3px rgba(0,0,0,0.5);
        }
        
        /* Oscilloscope */
        .oscilloscope {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 3px solid #444;
            border-radius: 10px;
            position: relative;
        }
        
        .oscilloscope-screen {
            background: #001100;
            border: 2px solid #333;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .oscilloscope-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0,255,0,0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,255,0,0.2) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .waveform {
            stroke: #00ff00;
            stroke-width: 2;
            fill: none;
            filter: drop-shadow(0 0 5px #00ff00);
        }
        
        /* Multimeter */
        .multimeter {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: 3px solid #FF8C00;
            border-radius: 15px;
            position: relative;
        }
        
        .multimeter-display {
            background: #000;
            color: #00ff00;
            border: 2px solid #333;
            border-radius: 5px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: bold;
            text-align: center;
            line-height: 1;
        }
        
        /* Power Supply */
        .power-supply {
            background: linear-gradient(135deg, #4169E1 0%, #1E90FF 100%);
            border: 3px solid #000080;
            border-radius: 10px;
            position: relative;
        }
        
        .power-indicator {
            width: 10px;
            height: 10px;
            background: #ff0000;
            border-radius: 50%;
            position: absolute;
            top: 5px;
            right: 5px;
            animation: powerBlink 1s infinite;
        }
        
        @keyframes powerBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        /* Function Generator */
        .function-generator {
            background: linear-gradient(135deg, #8B008B 0%, #9932CC 100%);
            border: 3px solid #4B0082;
            border-radius: 10px;
            position: relative;
        }
        
        /* Spectrum Analyzer */
        .spectrum-analyzer {
            background: linear-gradient(135deg, #2F4F4F 0%, #708090 100%);
            border: 3px solid #1C1C1C;
            border-radius: 10px;
        }
        
        .spectrum-bar {
            background: linear-gradient(to top, #ff0000 0%, #ffff00 50%, #00ff00 100%);
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        /* Animations */
        .spark-effect {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700 0%, transparent 70%);
            border-radius: 50%;
            animation: sparkAnimation 0.5s ease-out;
            pointer-events: none;
        }
        
        @keyframes sparkAnimation {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% { 
                transform: scale(1.5) rotate(180deg);
                opacity: 0.8;
            }
            100% { 
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }
        
        .voltage-ripple {
            position: absolute;
            border: 2px solid #00ff00;
            border-radius: 50%;
            animation: rippleEffect 1s ease-out infinite;
            pointer-events: none;
        }
        
        @keyframes rippleEffect {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 100px;
                height: 100px;
                opacity: 0;
            }
        }
        
        /* Modal Animations */
        .modal-enter {
            animation: modalEnter 0.3s ease-out;
        }
        
        @keyframes modalEnter {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* Success Effects */
        .success-burst {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .success-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #FFD700;
            border-radius: 50%;
            animation: particleBurst 2s ease-out forwards;
        }
        
        @keyframes particleBurst {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0) translate(var(--dx), var(--dy));
            }
        }
        
        /* Circuit Analysis */
        .analysis-panel {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .node-voltage {
            position: absolute;
            background: rgba(255, 215, 0, 0.9);
            color: black;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            pointer-events: none;
            z-index: 20;
        }
        
        .current-arrow {
            position: absolute;
            color: #ff6b6b;
            font-size: 16px;
            pointer-events: none;
            z-index: 20;
            animation: currentFlow 1s infinite;
        }
        
        @keyframes currentFlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .component {
                transform: scale(0.8);
            }
            
            .pcb-board {
                padding: 10px;
            }
            
            .connection-point {
                width: 10px;
                height: 10px;
            }
        }
        
        /* Loading Animation */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #FFD700;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .tooltip.show {
            opacity: 1;
        }
        
        /* Advanced Effects */
        .electromagnetic-field {
            position: absolute;
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            animation: electromagneticPulse 2s infinite;
            pointer-events: none;
        }
        
        @keyframes electromagneticPulse {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-gradient-to-br from-gray-900 to-black flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold text-white mb-2">กำลังโหลด Circuit Symphony Pro</h2>
            <p class="text-gray-400">กำลังเตรียมห้องปฏิบัติการอิเล็กทรอนิกส์...</p>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="mainMenu" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-black/20 backdrop-blur-xl rounded-3xl p-8 max-w-4xl w-full border border-white/10">
            <div class="text-center mb-8">
                <h1 class="text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 mb-4">
                    ⚡ Circuit Symphony Pro
                </h1>
                <h2 class="text-4xl font-semibold text-cyan-300 mb-6">วงจรซิมโฟนีโปร</h2>
                <p class="text-xl text-white/90 leading-relaxed max-w-3xl mx-auto">
                    ยินดีต้อนรับสู่ห้องปฏิบัติการอิเล็กทรอนิกส์ขั้นสูง! สร้างวงจรที่ซับซ้อนด้วยเครื่องมือมืออาชีพ<br>
                    🔬 Oscilloscope • 🔋 Power Supply • 📊 Spectrum Analyzer • ⚡ Function Generator
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-600/20 to-purple-600/20 rounded-xl p-6 border border-blue-400/30">
                    <h3 class="text-2xl font-bold text-blue-300 mb-3">🎼 Basic Circuit Lab</h3>
                    <p class="text-white/80 mb-4">เรียนรู้พื้นฐานด้วย PCB Board และ Breadboard</p>
                    <ul class="text-sm text-white/70 space-y-1">
                        <li>• Resistor, Capacitor, LED</li>
                        <li>• Voltage & Current Analysis</li>
                        <li>• Real-time Oscilloscope</li>
                    </ul>
                </div>
                
                <div class="bg-gradient-to-br from-green-600/20 to-teal-600/20 rounded-xl p-6 border border-green-400/30">
                    <h3 class="text-2xl font-bold text-green-300 mb-3">🎹 Advanced Synthesis</h3>
                    <p class="text-white/80 mb-4">สร้างวงจรซับซ้อนด้วย IC และ Logic Gates</p>
                    <ul class="text-sm text-white/70 space-y-1">
                        <li>• Op-Amp Circuits</li>
                        <li>• Digital Logic Design</li>
                        <li>• Frequency Analysis</li>
                    </ul>
                </div>
                
                <div class="bg-gradient-to-br from-red-600/20 to-orange-600/20 rounded-xl p-6 border border-red-400/30">
                    <h3 class="text-2xl font-bold text-red-300 mb-3">🎵 Master Engineer</h3>
                    <p class="text-white/80 mb-4">ออกแบบระบบเสียงและ RF Circuits</p>
                    <ul class="text-sm text-white/70 space-y-1">
                        <li>• Audio Amplifiers</li>
                        <li>• Signal Processing</li>
                        <li>• Electromagnetic Analysis</li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center space-y-6">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-white mb-4">🎯 เลือกด่านที่ต้องการเล่น (เล่นด่านไหนก็ได้!)</h3>
                    <div class="flex justify-center mb-6">
                        <button onclick="startGame()" class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-4 px-12 rounded-full text-2xl transform hover:scale-105 transition-all duration-300 shadow-xl">
                            🚀 เริ่มเกม (Start Game)
                        </button>
                    </div>
                    <div class="flex justify-center space-x-3">
                        <button onclick="startLevel(1)" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-2 px-6 rounded-full text-sm transform hover:scale-105 transition-all duration-300 shadow-xl">
                            🟢 ด่าน 1 - ง่าย
                        </button>
                        <button onclick="startLevel(2)" class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 px-6 rounded-full text-sm transform hover:scale-105 transition-all duration-300 shadow-xl">
                            🟡 ด่าน 2 - ปานกลาง
                        </button>
                        <button onclick="startLevel(3)" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-2 px-6 rounded-full text-sm transform hover:scale-105 transition-all duration-300 shadow-xl">
                            🔴 ด่าน 3 - ยาก
                        </button>
                    </div>
                    <p class="text-white/80 mt-3 text-sm">🎮 เลือกด่านไหนก็ได้ตามใจชอบ! มีปุ่มข้ามด่านในเกมด้วย</p>
                </div>
                
                <div class="flex justify-center space-x-4">
                    <button onclick="showInstructions()" class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold py-3 px-6 rounded-full text-lg transform hover:scale-105 transition-all duration-300 shadow-xl">
                        📖 วิธีเล่นละเอียด
                    </button>
                    <button onclick="showQuickGuide()" class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-3 px-6 rounded-full text-lg transform hover:scale-105 transition-all duration-300 shadow-xl">
                        ⚡ เริ่มเล่นด่วน
                    </button>
                </div>
                
                <div class="flex justify-center space-x-4 text-sm text-white/60">
                    <span>⚡ จำลองแบบเรียลไทม์</span>
                    <span>🔬 เครื่องมือมืออาชีพ</span>
                    <span>🎵 เสียงเพลงจากวงจร</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="hidden min-h-screen p-2">
        <!-- Top Control Panel -->
        <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 mb-4 border border-white/10">
            <div class="flex flex-wrap justify-between items-center gap-4">
                <div class="flex items-center space-x-6">
                    <h2 id="levelTitle" class="text-2xl font-bold text-white">🎼 Basic Circuit Lab</h2>
                    <div class="bg-gradient-to-r from-yellow-500 to-orange-500 text-black px-4 py-2 rounded-full font-bold">
                        Score: <span id="score">0</span>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-4 py-2 rounded-full font-bold">
                        Level: <span id="currentLevelDisplay">1</span>/3
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="showInstructions()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        📖 วิธีเล่น
                    </button>
                    <button onclick="showHints()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                        💡 คำใบ้
                    </button>
                    <button onclick="skipLevel()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ⏭️ ข้ามด่าน
                    </button>
                    <button onclick="togglePower()" id="powerButton" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                        🔴 Power OFF
                    </button>
                    <button onclick="resetCircuit()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors">
                        🔄 Reset
                    </button>
                    <button onclick="showMenu()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                        🏠 Menu
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-4">
            <!-- Left Panel - Components & Tools -->
            <div class="xl:col-span-3 space-y-4">
                <!-- Component Library -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        🔧 Component Library
                        <span class="ml-2 text-sm bg-blue-500 px-2 py-1 rounded">Pro</span>
                    </h3>
                    <div id="componentLibrary" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Components will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Measurement Tools -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <h3 class="text-lg font-bold text-white mb-3">📊 Measurement Tools</h3>
                    
                    <!-- Multimeter -->
                    <div class="multimeter p-3 mb-3 rounded-lg">
                        <div class="text-center text-black font-bold mb-2">MULTIMETER</div>
                        <div class="multimeter-display p-2 text-lg">
                            <div id="voltageReading">0.00V</div>
                            <div id="currentReading" class="text-sm">0.00mA</div>
                        </div>
                        <div class="flex justify-center space-x-2 mt-2">
                            <button onclick="setMultimeterMode('voltage')" class="bg-red-600 text-white px-2 py-1 rounded text-xs">V</button>
                            <button onclick="setMultimeterMode('current')" class="bg-blue-600 text-white px-2 py-1 rounded text-xs">A</button>
                            <button onclick="setMultimeterMode('resistance')" class="bg-green-600 text-white px-2 py-1 rounded text-xs">Ω</button>
                        </div>
                    </div>
                    
                    <!-- Power Supply -->
                    <div class="power-supply p-3 rounded-lg">
                        <div class="power-indicator"></div>
                        <div class="text-center text-white font-bold mb-2">POWER SUPPLY</div>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2">
                                <label class="text-white text-sm">V:</label>
                                <input type="range" id="voltageSlider" min="0" max="12" value="5" step="0.1" class="flex-1">
                                <span id="voltageValue" class="text-white text-sm mono-font">5.0V</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="text-white text-sm">I:</label>
                                <input type="range" id="currentSlider" min="0" max="1000" value="100" step="10" class="flex-1">
                                <span id="currentValue" class="text-white text-sm mono-font">100mA</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Circuit Board -->
            <div class="xl:col-span-6 space-y-4">
                <!-- Main Circuit Board -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">⚡ Professional PCB Board</h3>
                        <div class="flex space-x-2">
                            <button onclick="toggleGrid()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">Grid</button>
                            <button onclick="autoRoute()" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm">Auto Route</button>
                        </div>
                    </div>
                    
                    <div id="circuitBoard" class="pcb-board rounded-xl p-6 min-h-96 relative">
                        <svg id="connectionSvg" class="absolute inset-0 w-full h-full pointer-events-none z-10">
                            <!-- Connection wires will be drawn here -->
                        </svg>
                        <div id="circuitGrid" class="relative z-20 grid grid-cols-12 gap-3 h-full">
                            <!-- Circuit connection points will be created here -->
                        </div>
                        
                        <!-- Node voltage indicators -->
                        <div id="voltageIndicators" class="absolute inset-0 pointer-events-none z-30">
                            <!-- Voltage readings will appear here -->
                        </div>
                        
                        <!-- Current flow arrows -->
                        <div id="currentIndicators" class="absolute inset-0 pointer-events-none z-30">
                            <!-- Current flow indicators will appear here -->
                        </div>
                    </div>
                    
                    <!-- Circuit Controls -->
                    <div class="mt-4 flex flex-wrap justify-center gap-3">
                        <button onclick="analyzeCircuit()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                            🔬 Analyze Circuit
                        </button>
                        <button onclick="simulateCircuit()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                            ⚡ Run Simulation
                        </button>
                        <button onclick="playCircuitMusic()" id="playMusicBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors hidden">
                            🎵 Play Symphony
                        </button>
                    </div>
                </div>
                
                <!-- Breadboard -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-white">🍞 Breadboard Prototyping</h3>
                        <div class="flex space-x-2">
                            <button onclick="clearBreadboard()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">Clear</button>
                            <button onclick="saveBreadboard()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Save</button>
                        </div>
                    </div>
                    <div id="breadboard" class="breadboard rounded-lg p-4 min-h-32 relative cursor-crosshair">
                        <div class="text-center text-white/60 py-8">
                            <div class="text-2xl mb-2">🔌</div>
                            <div>คลิกเพื่อวางอุปกรณ์บน Breadboard</div>
                            <div class="text-sm mt-1">หรือลากอุปกรณ์มาวางที่นี่</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Analysis & Visualization -->
            <div class="xl:col-span-3 space-y-4">
                <!-- Oscilloscope -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <h3 class="text-lg font-bold text-white mb-3">📺 Oscilloscope</h3>
                    <div class="oscilloscope p-3 rounded-lg">
                        <div class="oscilloscope-screen h-32 mb-3 relative">
                            <div class="oscilloscope-grid"></div>
                            <svg class="absolute inset-0 w-full h-full">
                                <path id="waveform" class="waveform" d=""></path>
                            </svg>
                        </div>
                        <div class="flex justify-between text-white text-xs">
                            <div>
                                <label>Time/Div:</label>
                                <select id="timeScale" class="bg-gray-700 text-white text-xs rounded">
                                    <option value="1">1ms</option>
                                    <option value="10">10ms</option>
                                    <option value="100">100ms</option>
                                </select>
                            </div>
                            <div>
                                <label>Volt/Div:</label>
                                <select id="voltScale" class="bg-gray-700 text-white text-xs rounded">
                                    <option value="1">1V</option>
                                    <option value="2">2V</option>
                                    <option value="5">5V</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Function Generator -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <h3 class="text-lg font-bold text-white mb-3">🌊 Function Generator</h3>
                    <div class="function-generator p-3 rounded-lg">
                        <div class="space-y-2">
                            <div>
                                <label class="text-white text-sm">Waveform:</label>
                                <select id="waveformType" class="w-full bg-gray-700 text-white text-sm rounded p-1">
                                    <option value="sine">Sine Wave</option>
                                    <option value="square">Square Wave</option>
                                    <option value="triangle">Triangle Wave</option>
                                    <option value="sawtooth">Sawtooth Wave</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-white text-sm">Frequency:</label>
                                <input type="range" id="frequencySlider" min="1" max="1000" value="100" class="w-full">
                                <span id="frequencyValue" class="text-white text-xs mono-font">100 Hz</span>
                            </div>
                            <div>
                                <label class="text-white text-sm">Amplitude:</label>
                                <input type="range" id="amplitudeSlider" min="0" max="10" value="5" step="0.1" class="w-full">
                                <span id="amplitudeValue" class="text-white text-xs mono-font">5.0 V</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Spectrum Analyzer -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <h3 class="text-lg font-bold text-white mb-3">📊 Spectrum Analyzer</h3>
                    <div class="spectrum-analyzer p-3 rounded-lg">
                        <div class="h-24 flex items-end justify-center space-x-1">
                            <div class="spectrum-bar w-2 bg-gradient-to-t from-red-500 to-green-500" style="height: 20%"></div>
                            <div class="spectrum-bar w-2 bg-gradient-to-t from-red-500 to-green-500" style="height: 40%"></div>
                            <div class="spectrum-bar w-2 bg-gradient-to-t from-red-500 to-green-500" style="height: 60%"></div>
                            <div class="spectrum-bar w-2 bg-gradient-to-t from-red-500 to-green-500" style="height: 80%"></div>
                            <div class="spectrum-bar w-2 bg-gradient-to-t from-red-500 to-green-500" style="height: 45%"></div>
                            <div class="spectrum-bar w-2 bg-gradient-to-t from-red-500 to-green-500" style="height: 30%"></div>
                            <div class="spectrum-bar w-2 bg-gradient-to-t from-red-500 to-green-500" style="height: 15%"></div>
                        </div>
                        <div class="text-white text-xs text-center mt-2">
                            <div>Peak: <span id="peakFrequency" class="mono-font">440 Hz</span></div>
                            <div>THD: <span id="thd" class="mono-font">2.3%</span></div>
                        </div>
                    </div>
                </div>
                
                <!-- Circuit Analysis -->
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-4 border border-white/10">
                    <h3 class="text-lg font-bold text-white mb-3">🧮 Circuit Analysis</h3>
                    <div class="analysis-panel p-3 rounded-lg">
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between text-white">
                                <span>Total Resistance:</span>
                                <span id="totalResistance" class="mono-font">0 Ω</span>
                            </div>
                            <div class="flex justify-between text-white">
                                <span>Total Current:</span>
                                <span id="totalCurrent" class="mono-font">0 mA</span>
                            </div>
                            <div class="flex justify-between text-white">
                                <span>Power Consumption:</span>
                                <span id="powerConsumption" class="mono-font">0 mW</span>
                            </div>
                            <div class="flex justify-between text-white">
                                <span>Efficiency:</span>
                                <span id="efficiency" class="mono-font">0%</span>
                            </div>
                        </div>
                        
                        <div class="mt-3 pt-3 border-t border-gray-600">
                            <div class="text-white text-sm mb-2">Circuit Status:</div>
                            <div id="circuitStatus" class="text-yellow-400 text-sm">⏳ Ready for analysis</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Modals -->
    
    <!-- Circuit Analysis Modal -->
    <div id="analysisModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
        <div class="bg-gray-900 rounded-3xl p-8 max-w-4xl w-full mx-4 border border-gray-600 modal-enter">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-3xl font-bold text-white">🔬 Advanced Circuit Analysis</h3>
                <button onclick="closeAnalysisModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="text-xl font-bold text-cyan-300 mb-3">📊 Electrical Parameters</h4>
                    <div class="space-y-3">
                        <div class="bg-black/50 p-3 rounded-lg">
                            <div class="text-white text-sm">Node Voltages:</div>
                            <div id="nodeVoltages" class="mono-font text-green-400 text-sm mt-1"></div>
                        </div>
                        <div class="bg-black/50 p-3 rounded-lg">
                            <div class="text-white text-sm">Branch Currents:</div>
                            <div id="branchCurrents" class="mono-font text-blue-400 text-sm mt-1"></div>
                        </div>
                        <div class="bg-black/50 p-3 rounded-lg">
                            <div class="text-white text-sm">Power Distribution:</div>
                            <div id="powerDistribution" class="mono-font text-red-400 text-sm mt-1"></div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-xl font-bold text-purple-300 mb-3">🎵 Musical Analysis</h4>
                    <div class="space-y-3">
                        <div class="bg-black/50 p-3 rounded-lg">
                            <div class="text-white text-sm">Harmonic Content:</div>
                            <div id="harmonicContent" class="text-yellow-400 text-sm mt-1"></div>
                        </div>
                        <div class="bg-black/50 p-3 rounded-lg">
                            <div class="text-white text-sm">Musical Key:</div>
                            <div id="musicalKey" class="text-pink-400 text-sm mt-1"></div>
                        </div>
                        <div class="bg-black/50 p-3 rounded-lg">
                            <div class="text-white text-sm">Rhythm Pattern:</div>
                            <div id="rhythmPattern" class="text-orange-400 text-sm mt-1"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 flex justify-center">
                <button onclick="exportAnalysis()" class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white px-6 py-3 rounded-lg font-semibold">
                    📄 Export Analysis Report
                </button>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-green-900 to-blue-900 rounded-3xl p-8 max-w-lg w-full mx-4 border border-green-400 modal-enter">
            <div class="success-burst">
                <!-- Success particles will be created here -->
            </div>
            <div class="text-center">
                <div class="text-8xl mb-4">🎉</div>
                <h3 class="text-3xl font-bold text-white mb-4">Circuit Symphony Complete!</h3>
                <p id="successMessage" class="text-xl text-green-300 mb-6"></p>
                <div id="performanceMetrics" class="bg-black/30 rounded-lg p-4 mb-6">
                    <!-- Performance metrics will be shown here -->
                </div>
                <div class="flex justify-center space-x-4">
                    <button onclick="nextLevel()" id="nextLevelBtn" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white px-6 py-3 rounded-lg font-semibold">
                        🚀 Next Challenge
                    </button>
                    <button onclick="closeSuccessModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                        Continue Experimenting
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Game Complete Modal -->
    <div id="gameCompleteModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-purple-900 to-pink-900 rounded-3xl p-8 max-w-2xl w-full mx-4 border border-purple-400 modal-enter">
            <div class="text-center">
                <div class="text-8xl mb-4">🏆</div>
                <h3 class="text-4xl font-bold text-white mb-4">Master Electronics Engineer!</h3>
                <div id="finalScoreDisplay" class="text-2xl text-yellow-300 mb-6"></div>
                <div id="engineerRating" class="bg-black/30 rounded-lg p-6 mb-6">
                    <!-- Engineer rating will be shown here -->
                </div>
                <div id="achievements" class="grid grid-cols-2 gap-4 mb-6">
                    <!-- Achievements will be shown here -->
                </div>
                <button onclick="restartGame()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-8 py-4 rounded-lg font-bold text-xl">
                    🎮 Start New Laboratory Session
                </button>
            </div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div id="instructionsModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-gray-900 rounded-3xl p-8 max-w-4xl w-full mx-4 border border-gray-600 modal-enter max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-3xl font-bold text-white">📖 วิธีเล่น Circuit Symphony Pro</h3>
                <button onclick="closeInstructions()" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <div class="space-y-8">
                <!-- Basic Instructions -->
                <div class="bg-blue-900/30 rounded-xl p-6 border border-blue-400/30">
                    <h4 class="text-2xl font-bold text-blue-300 mb-4">🎯 เป้าหมายของเกม</h4>
                    <p class="text-white text-lg leading-relaxed mb-4">
                        สร้างวงจรอิเล็กทรอนิกส์ที่สมบูรณ์และสามารถเล่นเสียงเพลงได้! 
                        แต่ละด่านจะมีความยากและอุปกรณ์ที่แตกต่างกัน
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-black/30 p-3 rounded-lg">
                            <div class="text-green-400 font-bold">🟢 ด่าน 1 - ง่าย</div>
                            <div class="text-white">วงจรพื้นฐาน LED + ตัวต้านทาน</div>
                        </div>
                        <div class="bg-black/30 p-3 rounded-lg">
                            <div class="text-yellow-400 font-bold">🟡 ด่าน 2 - ปานกลาง</div>
                            <div class="text-white">วงจรขยายสัญญาณ Op-Amp</div>
                        </div>
                        <div class="bg-black/30 p-3 rounded-lg">
                            <div class="text-red-400 font-bold">🔴 ด่าน 3 - ยาก</div>
                            <div class="text-white">ระบบเสียงครบวงจร</div>
                        </div>
                    </div>
                </div>

                <!-- Step by Step Guide -->
                <div class="bg-green-900/30 rounded-xl p-6 border border-green-400/30">
                    <h4 class="text-2xl font-bold text-green-300 mb-4">📋 ขั้นตอนการเล่น (ง่ายมาก!)</h4>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-4">
                            <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">1</div>
                            <div>
                                <div class="text-white font-bold">เลือกอุปกรณ์</div>
                                <div class="text-gray-300">คลิกที่อุปกรณ์ในกล่อง "Component Library" ด้านซ้าย (จะมีขอบสีเหลือง)</div>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">2</div>
                            <div>
                                <div class="text-white font-bold">วางอุปกรณ์</div>
                                <div class="text-gray-300">คลิกที่บอร์ดสีเขียวตรงกลางเพื่อวางอุปกรณ์ (หรือลากมาวางก็ได้)</div>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">3</div>
                            <div>
                                <div class="text-white font-bold">เชื่อมสาย</div>
                                <div class="text-gray-300">กดค้างที่จุดสีทองแล้วลากไปยังจุดที่ต้องการเชื่อม (จะมีเส้นสีแดงตามเมาส์)</div>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">4</div>
                            <div>
                                <div class="text-white font-bold">เปิดไฟ</div>
                                <div class="text-gray-300">กดปุ่ม "Power ON" สีแดงด้านบน</div>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">5</div>
                            <div>
                                <div class="text-white font-bold">ทดสอบ</div>
                                <div class="text-gray-300">กด "Run Simulation" แล้วกด "Play Symphony" เพื่อฟังเสียงเพลง!</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Level 1 Guide -->
                <div class="bg-purple-900/30 rounded-xl p-6 border border-purple-400/30">
                    <h4 class="text-2xl font-bold text-purple-300 mb-4">🟢 คำใบ้ด่าน 1 - วงจร LED ง่ายๆ</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="text-lg font-bold text-white mb-3">🎯 เป้าหมาย:</h5>
                            <ul class="text-gray-300 space-y-2">
                                <li>• ใช้ Battery 9V เป็นแหล่งจ่ายไฟ</li>
                                <li>• ใส่ Resistor เพื่อจำกัดกระแส</li>
                                <li>• เชื่อม LED ให้ติดไฟ</li>
                                <li>• ต้องมีการเชื่อมต่ออย่างน้อย 3 จุด</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="text-lg font-bold text-white mb-3">💡 เคล็ดลับ:</h5>
                            <ul class="text-yellow-300 space-y-2">
                                <li>• เริ่มจาก Battery ก่อน</li>
                                <li>• ต่อ Resistor เข้ากับขั้วบวก</li>
                                <li>• ต่อ LED เข้ากับ Resistor</li>
                                <li>• ปิดวงจรกลับไปที่ขั้วลบของ Battery</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-4 p-4 bg-black/30 rounded-lg">
                        <div class="text-green-400 font-bold mb-2">✅ สูตรสำเร็จ:</div>
                        <div class="text-white">Battery (+) → Resistor → LED → Battery (-)</div>
                    </div>
                </div>

                <!-- Level 2 Guide -->
                <div class="bg-orange-900/30 rounded-xl p-6 border border-orange-400/30">
                    <h4 class="text-2xl font-bold text-orange-300 mb-4">🟡 คำใบ้ด่าน 2 - วงจรขยายสัญญาณ</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="text-lg font-bold text-white mb-3">🎯 เป้าหมาย:</h5>
                            <ul class="text-gray-300 space-y-2">
                                <li>• ใช้ Op-Amp เป็นตัวขยาย</li>
                                <li>• เชื่อม Transistor เพื่อควบคุม</li>
                                <li>• ใส่ Capacitor กรองสัญญาณ</li>
                                <li>• สร้างวงจรป้อนกลับ (Feedback)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="text-lg font-bold text-white mb-3">💡 เคล็ดลับ:</h5>
                            <ul class="text-yellow-300 space-y-2">
                                <li>• Op-Amp ต้องมีไฟเลี้ยง</li>
                                <li>• Input ต่อที่ขา (-) ของ Op-Amp</li>
                                <li>• Output ต่อกลับไปที่ขา (+)</li>
                                <li>• Capacitor ต่อขนานกับ Output</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Level 3 Guide -->
                <div class="bg-red-900/30 rounded-xl p-6 border border-red-400/30">
                    <h4 class="text-2xl font-bold text-red-300 mb-4">🔴 คำใบ้ด่าน 3 - ระบบเสียงครบวงจร</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="text-lg font-bold text-white mb-3">🎯 เป้าหมาย:</h5>
                            <ul class="text-gray-300 space-y-2">
                                <li>• สร้างวงจรขยายเสียง LM386</li>
                                <li>• ใช้ 555 Timer สร้างสัญญาณ</li>
                                <li>• เชื่อม Speaker เป็น Output</li>
                                <li>• เชื่อม Microphone เป็น Input</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="text-lg font-bold text-white mb-3">💡 เคล็ดลับ:</h5>
                            <ul class="text-yellow-300 space-y-2">
                                <li>• 555 Timer สร้างสัญญาณพื้นฐาน</li>
                                <li>• LM386 ขยายสัญญาณให้แรงขึ้น</li>
                                <li>• Transformer จับคู่ impedance</li>
                                <li>• Speaker ต่อที่ Output สุดท้าย</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Tips and Tricks -->
                <div class="bg-gray-800/50 rounded-xl p-6 border border-gray-500/30">
                    <h4 class="text-2xl font-bold text-white mb-4">🔧 เทคนิคและคำแนะนำ</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="text-lg font-bold text-cyan-300 mb-3">⚡ การใช้งาน:</h5>
                            <ul class="text-gray-300 space-y-2 text-sm">
                                <li>• <strong>ดับเบิลคลิก</strong> อุปกรณ์เพื่อลบ</li>
                                <li>• <strong>คลิกขวา</strong> เพื่อยกเลิกการเชื่อมต่อ</li>
                                <li>• <strong>กดค้างลาก</strong> จุดทองเพื่อเชื่อมสาย</li>
                                <li>• ดูค่าแรงดันที่จุดต่างๆ</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="text-lg font-bold text-pink-300 mb-3">🎵 การทำคะแนน:</h5>
                            <ul class="text-gray-300 space-y-2 text-sm">
                                <li>• วางอุปกรณ์ = +10 คะแนน</li>
                                <li>• เชื่อมสาย = +20 คะแนน</li>
                                <li>• จำลองสำเร็จ = +50 คะแนน</li>
                                <li>• เล่นเพลงได้ = +100 คะแนน</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 text-center">
                <button onclick="closeInstructions()" class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white px-8 py-3 rounded-lg font-bold text-lg">
                    ✅ เข้าใจแล้ว เริ่มเล่นเลย!
                </button>
            </div>
        </div>
    </div>

    <!-- Hints Modal -->
    <div id="hintsModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="bg-gray-900 rounded-3xl p-8 max-w-2xl w-full mx-4 border border-gray-600 modal-enter">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-3xl font-bold text-white">💡 คำใบ้สำหรับด่านนี้</h3>
                <button onclick="closeHints()" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <div id="hintsContent" class="space-y-6">
                <!-- Hints content will be populated by JavaScript -->
            </div>
            
            <div class="mt-8 text-center">
                <button onclick="closeHints()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-8 py-3 rounded-lg font-bold text-lg">
                    ✅ เข้าใจแล้ว!
                </button>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // Game State Management
        class CircuitSymphonyGame {
            constructor() {
                this.currentLevel = 1;
                this.score = 0;
                this.isPowerOn = false;
                this.placedComponents = new Map();
                this.connections = [];
                this.selectedComponent = null;
                this.isConnecting = false;
                this.connectionStart = null;
                this.multimeterMode = 'voltage';
                this.analysisData = {};
                this.achievements = new Set();
                
                this.gameData = {
                    1: {
                        title: "🎼 Basic Circuit Lab - ง่ายมาก!",
                        description: "เรียนรู้พื้นฐาน - แค่วางอุปกรณ์ 2 ชิ้นแล้วเชื่อมสาย!",
                        components: [
                            { id: 'battery_9v', name: '🔋 Battery 9V', type: 'battery', voltage: 9, symbol: 'BAT', color: '#32CD32', sound: 'bass' },
                            { id: 'led_red', name: '💡 LED สีแดง', type: 'led', color: '#FF0000', symbol: 'LED', sound: 'C5' },
                            { id: 'resistor_1k', name: '⚡ ตัวต้านทาน', type: 'resistor', value: 1000, symbol: 'R1', color: '#8B4513', sound: 'C4' }
                        ],
                        objectives: [
                            "✅ วาง Battery และ LED",
                            "✅ เชื่อมสายระหว่างกัน", 
                            "✅ เปิดไฟและทดสอบ",
                            "✅ เล่นเพลงจากวงจร"
                        ],
                        targetScore: 50,
                        musicalKey: 'C Major',
                        hint: "แค่วาง Battery + LED แล้วเชื่อมสาย 2 เส้น ก็เสร็จแล้ว!"
                    },
                    2: {
                        title: "🎹 Advanced Synthesis Lab",
                        description: "Design complex circuits with operational amplifiers and digital logic",
                        components: [
                            { id: 'opamp_741', name: 'LM741 Op-Amp', type: 'ic', pins: 8, symbol: 'U1', color: '#2C2C2C', sound: 'harmony1' },
                            { id: 'transistor_2n2222', name: '2N2222 NPN', type: 'transistor', symbol: 'Q1', color: '#708090', sound: 'harmony2' },
                            { id: 'diode_1n4148', name: '1N4148 Diode', type: 'diode', symbol: 'D2', color: '#8B008B', sound: 'harmony3' },
                            { id: 'inductor_1mh', name: '1mH Inductor', type: 'inductor', value: 0.001, symbol: 'L1', color: '#FF6347', sound: 'bass_deep' },
                            { id: 'crystal_16mhz', name: '16MHz Crystal', type: 'crystal', frequency: 16000000, symbol: 'Y1', color: '#C0C0C0', sound: 'high_freq' }
                        ],
                        objectives: [
                            "Build operational amplifier circuit",
                            "Implement feedback control",
                            "Achieve signal amplification",
                            "Create complex waveforms"
                        ],
                        targetScore: 200,
                        musicalKey: 'A Minor'
                    },
                    3: {
                        title: "🎵 Master Engineer Lab",
                        description: "Design professional audio systems and RF circuits",
                        components: [
                            { id: 'amplifier_lm386', name: 'LM386 Audio Amp', type: 'amplifier', gain: 200, symbol: 'U2', color: '#4B0082', sound: 'amp' },
                            { id: 'oscillator_555', name: '555 Timer IC', type: 'oscillator', symbol: 'U3', color: '#8B008B', sound: 'wave' },
                            { id: 'speaker_8ohm', name: '8Ω Speaker', type: 'speaker', impedance: 8, symbol: 'SP1', color: '#2F4F4F', sound: 'output' },
                            { id: 'microphone', name: 'Electret Mic', type: 'microphone', symbol: 'MIC1', color: '#1C1C1C', sound: 'input' },
                            { id: 'transformer', name: 'Audio Transformer', type: 'transformer', ratio: '1:10', symbol: 'T1', color: '#8B4513', sound: 'transform' }
                        ],
                        objectives: [
                            "Design complete audio amplifier",
                            "Implement signal processing",
                            "Optimize power efficiency",
                            "Create full symphony output"
                        ],
                        targetScore: 300,
                        musicalKey: 'F# Major'
                    }
                };
                
                this.init();
            }
            
            init() {
                this.showLoadingScreen();
                setTimeout(() => {
                    this.hideLoadingScreen();
                    this.setupEventListeners();
                    this.initializeInstruments();
                    this.setupDemoMode();
                }, 2000);
            }
            
            setupDemoMode() {
                // Add demo button to main menu
                this.addDemoButton();
            }
            
            addDemoButton() {
                const menuButtons = document.querySelector('.text-center.space-y-6');
                if (menuButtons) {
                    const demoButton = document.createElement('button');
                    demoButton.onclick = () => this.startDemo();
                    demoButton.className = 'bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-full text-xl transform hover:scale-105 transition-all duration-300 shadow-xl';
                    demoButton.innerHTML = '🎬 ดูตัวอย่างการเล่น (Demo)';
                    
                    const instructionButton = menuButtons.querySelector('button[onclick="showInstructions()"]');
                    if (instructionButton) {
                        instructionButton.parentNode.insertBefore(demoButton, instructionButton);
                        
                        // Add spacing
                        const spacing = document.createElement('div');
                        spacing.className = 'mb-4';
                        instructionButton.parentNode.insertBefore(spacing, instructionButton);
                    }
                }
            }
            
            startDemo() {
                this.startGame();
                this.loadLevel(1);
                
                // Start automated demo
                setTimeout(() => {
                    this.runAutomatedDemo();
                }, 1000);
            }
            
            runAutomatedDemo() {
                this.showMessage('🎬 เริ่มการสาธิต! ดูให้ดีนะ จะสอนทีละขั้นตอน', 'info');
                
                // Step 1: Select component
                setTimeout(() => {
                    this.demoSelectComponent();
                }, 2000);
            }
            
            demoSelectComponent() {
                this.showMessage('ขั้นตอนที่ 1: เลือกอุปกรณ์จากกล่องด้านซ้าย', 'info');
                
                // Highlight first component
                const firstComponent = document.querySelector('.component');
                if (firstComponent) {
                    firstComponent.classList.add('border-4', 'border-yellow-400');
                    firstComponent.style.animation = 'pulse 1s infinite';
                    
                    setTimeout(() => {
                        firstComponent.click();
                        firstComponent.style.animation = '';
                        this.demoPlaceComponent();
                    }, 3000);
                }
            }
            
            demoPlaceComponent() {
                this.showMessage('ขั้นตอนที่ 2: คลิกที่บอร์ดสีเขียวเพื่อวางอุปกรณ์', 'info');
                
                // Highlight circuit board
                const board = document.getElementById('circuitBoard');
                board.style.boxShadow = '0 0 30px #FFD700';
                
                setTimeout(() => {
                    // Simulate placing component
                    const rect = board.getBoundingClientRect();
                    const x = 150;
                    const y = 100;
                    
                    if (this.selectedComponent) {
                        this.placeComponent(this.selectedComponent, x, y);
                    }
                    
                    board.style.boxShadow = '';
                    this.demoPlaceSecondComponent();
                }, 3000);
            }
            
            demoPlaceSecondComponent() {
                this.showMessage('ขั้นตอนที่ 3: วางอุปกรณ์ตัวที่สอง', 'info');
                
                // Select second component
                const components = document.querySelectorAll('.component');
                if (components[1]) {
                    components[1].classList.add('border-4', 'border-yellow-400');
                    components[1].style.animation = 'pulse 1s infinite';
                    
                    setTimeout(() => {
                        components[1].click();
                        components[1].style.animation = '';
                        
                        setTimeout(() => {
                            // Place second component
                            if (this.selectedComponent) {
                                this.placeComponent(this.selectedComponent, 300, 100);
                            }
                            this.demoMakeConnections();
                        }, 2000);
                    }, 2000);
                }
            }
            
            demoMakeConnections() {
                this.showMessage('ขั้นตอนที่ 4: กดค้างแล้วลากเชื่อมสายระหว่างอุปกรณ์', 'info');
                
                setTimeout(() => {
                    // Get connection points
                    const points = document.querySelectorAll('.connection-point');
                    if (points.length >= 2) {
                        // Highlight first point
                        points[0].style.animation = 'pulse 1s infinite';
                        points[0].style.background = '#FFD700';
                        points[0].style.transform = 'scale(2)';
                        
                        setTimeout(() => {
                            // Simulate drag connection
                            const mouseDownEvent = new MouseEvent('mousedown', {
                                bubbles: true,
                                clientX: points[0].getBoundingClientRect().left,
                                clientY: points[0].getBoundingClientRect().top
                            });
                            points[0].dispatchEvent(mouseDownEvent);
                            points[0].style.animation = '';
                            
                            // Highlight second point
                            setTimeout(() => {
                                points[2].style.animation = 'pulse 1s infinite';
                                points[2].style.background = '#FFD700';
                                points[2].style.transform = 'scale(2)';
                                
                                setTimeout(() => {
                                    // Simulate mouse up on second point
                                    const mouseUpEvent = new MouseEvent('mouseup', {
                                        bubbles: true,
                                        clientX: points[2].getBoundingClientRect().left,
                                        clientY: points[2].getBoundingClientRect().top
                                    });
                                    document.dispatchEvent(mouseUpEvent);
                                    points[2].style.animation = '';
                                    this.demoAddMoreConnections();
                                }, 2000);
                            }, 1000);
                        }, 2000);
                    }
                }, 1000);
            }
            
            demoAddMoreConnections() {
                this.showMessage('ขั้นตอนที่ 5: เชื่อมสายเพิ่มเติมให้ครบวงจร', 'info');
                
                setTimeout(() => {
                    const points = document.querySelectorAll('.connection-point');
                    if (points.length >= 4) {
                        // Make second connection with drag
                        const mouseDownEvent2 = new MouseEvent('mousedown', {
                            bubbles: true,
                            clientX: points[1].getBoundingClientRect().left,
                            clientY: points[1].getBoundingClientRect().top
                        });
                        points[1].dispatchEvent(mouseDownEvent2);
                        
                        setTimeout(() => {
                            const mouseUpEvent2 = new MouseEvent('mouseup', {
                                bubbles: true,
                                clientX: points[3].getBoundingClientRect().left,
                                clientY: points[3].getBoundingClientRect().top
                            });
                            document.dispatchEvent(mouseUpEvent2);
                            this.demoPowerOn();
                        }, 1500);
                    }
                }, 2000);
            }
            
            demoPowerOn() {
                this.showMessage('ขั้นตอนที่ 6: เปิดไฟเพื่อจ่ายกระแสให้วงจร', 'info');
                
                // Highlight power button
                const powerButton = document.getElementById('powerButton');
                powerButton.style.animation = 'pulse 1s infinite';
                powerButton.style.boxShadow = '0 0 20px #FFD700';
                
                setTimeout(() => {
                    powerButton.click();
                    powerButton.style.animation = '';
                    powerButton.style.boxShadow = '';
                    this.demoRunSimulation();
                }, 3000);
            }
            
            demoRunSimulation() {
                this.showMessage('ขั้นตอนที่ 7: รันการจำลองเพื่อทดสอบวงจร', 'info');
                
                // Highlight simulation button
                const simButton = document.querySelector('button[onclick="simulateCircuit()"]');
                if (simButton) {
                    simButton.style.animation = 'pulse 1s infinite';
                    simButton.style.boxShadow = '0 0 20px #FFD700';
                    
                    setTimeout(() => {
                        simButton.click();
                        simButton.style.animation = '';
                        simButton.style.boxShadow = '';
                        this.demoPlayMusic();
                    }, 3000);
                }
            }
            
            demoPlayMusic() {
                this.showMessage('ขั้นตอนสุดท้าย: เล่นเพลงจากวงจรที่สร้าง!', 'success');
                
                setTimeout(() => {
                    const musicButton = document.getElementById('playMusicBtn');
                    if (musicButton && !musicButton.classList.contains('hidden')) {
                        musicButton.style.animation = 'pulse 1s infinite';
                        musicButton.style.boxShadow = '0 0 20px #FFD700';
                        
                        setTimeout(() => {
                            musicButton.click();
                            musicButton.style.animation = '';
                            musicButton.style.boxShadow = '';
                            this.demoComplete();
                        }, 3000);
                    } else {
                        this.demoComplete();
                    }
                }, 2000);
            }
            
            demoComplete() {
                setTimeout(() => {
                    this.showMessage('🎉 การสาธิตเสร็จสิ้น! ตอนนี้ลองเล่นเองได้เลย', 'success');
                    
                    // Show completion message
                    setTimeout(() => {
                        const completionModal = this.createDemoCompletionModal();
                        document.body.appendChild(completionModal);
                    }, 2000);
                }, 3000);
            }
            
            createDemoCompletionModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-gradient-to-br from-green-900 to-blue-900 rounded-3xl p-8 max-w-lg w-full mx-4 border border-green-400 modal-enter">
                        <div class="text-center">
                            <div class="text-8xl mb-4">🎓</div>
                            <h3 class="text-3xl font-bold text-white mb-4">การสาธิตเสร็จสิ้น!</h3>
                            <p class="text-xl text-green-300 mb-6">ตอนนี้คุณรู้วิธีเล่นแล้ว ลองสร้างวงจรของคุณเองดู!</p>
                            
                            <div class="bg-black/30 rounded-lg p-4 mb-6">
                                <h4 class="text-lg font-bold text-white mb-3">📝 สรุปขั้นตอน:</h4>
                                <div class="text-left text-sm text-gray-300 space-y-1">
                                    <div>1. เลือกอุปกรณ์จากกล่องด้านซ้าย</div>
                                    <div>2. คลิกวางที่บอร์ดสีเขียว</div>
                                    <div>3. คลิกจุดทอง 2 จุดเพื่อเชื่อมสาย</div>
                                    <div>4. กดปุ่ม Power ON</div>
                                    <div>5. กด Run Simulation</div>
                                    <div>6. กด Play Symphony</div>
                                </div>
                            </div>
                            
                            <div class="flex justify-center space-x-4">
                                <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove(); game.resetCircuit();" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white px-6 py-3 rounded-lg font-semibold">
                                    🚀 เริ่มเล่นเลย!
                                </button>
                                <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove(); game.showMenu();" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                                    🏠 กลับเมนู
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                return modal;
            }
            
            showLoadingScreen() {
                document.getElementById('loadingScreen').classList.remove('hidden');
            }
            
            hideLoadingScreen() {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainMenu').classList.remove('hidden');
            }
            
            setupEventListeners() {
                // Power supply controls
                document.getElementById('voltageSlider').addEventListener('input', (e) => {
                    document.getElementById('voltageValue').textContent = `${e.target.value}V`;
                    this.updateCircuitAnalysis();
                });
                
                document.getElementById('currentSlider').addEventListener('input', (e) => {
                    document.getElementById('currentValue').textContent = `${e.target.value}mA`;
                    this.updateCircuitAnalysis();
                });
                
                // Function generator controls
                document.getElementById('frequencySlider').addEventListener('input', (e) => {
                    document.getElementById('frequencyValue').textContent = `${e.target.value} Hz`;
                    this.updateWaveform();
                });
                
                document.getElementById('amplitudeSlider').addEventListener('input', (e) => {
                    document.getElementById('amplitudeValue').textContent = `${e.target.value} V`;
                    this.updateWaveform();
                });
                
                document.getElementById('waveformType').addEventListener('change', () => {
                    this.updateWaveform();
                });
                
                // Circuit board interactions
                const circuitBoard = document.getElementById('circuitBoard');
                circuitBoard.addEventListener('click', (e) => {
                    this.handleCircuitBoardClick(e);
                });
                
                // Add drop support for drag and drop
                circuitBoard.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    circuitBoard.style.backgroundColor = 'rgba(74, 222, 128, 0.2)';
                });
                
                circuitBoard.addEventListener('dragleave', (e) => {
                    circuitBoard.style.backgroundColor = '';
                });
                
                circuitBoard.addEventListener('drop', (e) => {
                    e.preventDefault();
                    circuitBoard.style.backgroundColor = '';
                    const rect = circuitBoard.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    if (this.selectedComponent) {
                        this.placeComponent(this.selectedComponent, x, y);
                    }
                });
                
                // Breadboard interactions
                const breadboard = document.getElementById('breadboard');
                breadboard.addEventListener('click', (e) => {
                    this.handleBreadboardClick(e);
                });
                
                breadboard.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    breadboard.style.backgroundColor = 'rgba(255, 215, 0, 0.2)';
                });
                
                breadboard.addEventListener('dragleave', (e) => {
                    breadboard.style.backgroundColor = '';
                });
                
                breadboard.addEventListener('drop', (e) => {
                    e.preventDefault();
                    breadboard.style.backgroundColor = '';
                    const rect = breadboard.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    if (this.selectedComponent) {
                        this.placeBreadboardComponent(this.selectedComponent, x, y);
                    }
                });
                
                // Tooltip system
                document.addEventListener('mouseover', (e) => {
                    if (e.target.dataset.tooltip) {
                        this.showTooltip(e.target, e.target.dataset.tooltip);
                    }
                });
                
                document.addEventListener('mouseout', (e) => {
                    if (e.target.dataset.tooltip) {
                        this.hideTooltip();
                    }
                });
            }
            
            initializeInstruments() {
                this.createCircuitGrid();
                this.createBreadboard();
                this.updateWaveform();
                this.startSpectrumAnalyzer();
            }
            
            startGame() {
                document.getElementById('mainMenu').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                this.loadLevel(1);
                
                // Show welcome message with step-by-step hints
                setTimeout(() => {
                    this.showMessage('🎉 ยินดีต้อนรับ! ด่าน 1 ง่ายมาก - แค่วางอุปกรณ์ 2 ชิ้นแล้วเชื่อมสาย!', 'info');
                }, 500);
                
                // Show progressive hints
                setTimeout(() => {
                    this.showMessage('👆 ขั้นตอนที่ 1: คลิกที่ "🔋 Battery 9V" ในกล่องด้านซ้าย', 'info');
                }, 3000);
            }
            
            loadLevel(level) {
                this.currentLevel = level;
                const levelData = this.gameData[level];
                
                document.getElementById('levelTitle').textContent = levelData.title;
                document.getElementById('currentLevelDisplay').textContent = level;
                
                this.loadComponents(levelData.components);
                this.resetCircuit();
                this.updateUI();
            }
            
            loadComponents(components) {
                const library = document.getElementById('componentLibrary');
                library.innerHTML = '';
                
                components.forEach(component => {
                    const componentElement = this.createComponentElement(component);
                    library.appendChild(componentElement);
                });
            }
            
            createComponentElement(component) {
                const div = document.createElement('div');
                div.className = `component ${component.type} p-3 rounded-lg cursor-grab hover:scale-105 transition-all duration-300`;
                div.draggable = true;
                div.dataset.componentId = component.id;
                div.dataset.tooltip = `${component.name} - ${component.symbol}`;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-8 rounded flex items-center justify-center text-white font-bold text-xs" style="background-color: ${component.color}">
                            ${component.symbol}
                        </div>
                        <div class="flex-1">
                            <div class="text-white font-semibold text-sm">${component.name}</div>
                            <div class="text-gray-300 text-xs">${this.getComponentSpec(component)}</div>
                        </div>
                    </div>
                `;
                
                div.addEventListener('dragstart', (e) => this.handleDragStart(e, component));
                div.addEventListener('dragend', (e) => this.handleDragEnd(e));
                div.addEventListener('click', (e) => this.selectComponent(component));
                
                return div;
            }
            
            getComponentSpec(component) {
                switch (component.type) {
                    case 'resistor': return `${component.value >= 1000 ? component.value/1000 + 'kΩ' : component.value + 'Ω'}`;
                    case 'capacitor': return `${component.value * 1000000000}nF`;
                    case 'battery': return `${component.voltage}V`;
                    case 'ic': return `${component.pins} pins`;
                    case 'speaker': return `${component.impedance}Ω`;
                    default: return component.type.toUpperCase();
                }
            }
            
            createCircuitGrid() {
                const grid = document.getElementById('circuitGrid');
                grid.innerHTML = '';
                
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 12; col++) {
                        const point = document.createElement('div');
                        point.className = 'connection-point';
                        point.dataset.row = row;
                        point.dataset.col = col;
                        point.dataset.nodeId = `node_${row}_${col}`;
                        
                        point.style.gridColumn = col + 1;
                        point.style.gridRow = row + 1;
                        
                        point.addEventListener('mousedown', (e) => this.handleConnectionPointClick(e));
                        point.addEventListener('contextmenu', (e) => {
                            e.preventDefault();
                            e.button = 2;
                            this.handleConnectionPointClick(e);
                        });
                        
                        grid.appendChild(point);
                    }
                }
            }
            
            createBreadboard() {
                const breadboard = document.getElementById('breadboard');
                const container = breadboard.querySelector('.grid-cols-30') || document.createElement('div');
                container.className = 'grid grid-cols-30 gap-1';
                container.innerHTML = '';
                
                for (let i = 0; i < 150; i++) {
                    const hole = document.createElement('div');
                    hole.className = 'breadboard-hole';
                    hole.style.left = `${(i % 30) * 12 + 6}px`;
                    hole.style.top = `${Math.floor(i / 30) * 12 + 6}px`;
                    container.appendChild(hole);
                }
                
                breadboard.innerHTML = '';
                breadboard.appendChild(container);
            }
            
            handleDragStart(e, component) {
                e.target.classList.add('dragging');
                this.selectedComponent = component;
                e.dataTransfer.setData('text/plain', component.id);
            }
            
            handleDragEnd(e) {
                e.target.classList.remove('dragging');
                this.selectedComponent = null;
            }
            
            selectComponent(component) {
                // Remove previous selection
                document.querySelectorAll('.component').forEach(el => {
                    el.classList.remove('border-4', 'border-yellow-400');
                });
                
                // Highlight selected component
                event.target.closest('.component').classList.add('border-4', 'border-yellow-400');
                
                this.selectedComponent = component;
                
                // Show progressive instructions based on game state
                if (this.placedComponents.size === 0) {
                    this.showMessage(`✅ เลือก ${component.name} แล้ว! ขั้นตอนที่ 2: คลิกที่บอร์ดสีเขียวเพื่อวาง`, 'success');
                } else if (this.placedComponents.size === 1) {
                    this.showMessage(`✅ เลือก ${component.name} แล้ว! วางชิ้นที่ 2 แล้วเชื่อมสายกัน`, 'success');
                } else {
                    this.showMessage(`เลือก ${component.name} แล้ว! คลิกที่บอร์ดเพื่อวาง`, 'success');
                }
            }
            
            handleCircuitBoardClick(e) {
                // Don't place component if clicking on existing component or connection point
                if (e.target.classList.contains('connection-point') || 
                    e.target.classList.contains('placed-component') ||
                    e.target.closest('.placed-component')) {
                    return;
                }
                
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (this.selectedComponent && !this.isConnecting) {
                    this.placeComponent(this.selectedComponent, x, y);
                }
            }
            
            placeComponent(component, x, y) {
                const board = document.getElementById('circuitBoard');
                const componentElement = document.createElement('div');
                
                componentElement.className = `placed-component ${component.type} absolute cursor-pointer hover:scale-110 transition-transform`;
                componentElement.style.left = `${x - 25}px`;
                componentElement.style.top = `${y - 15}px`;
                componentElement.style.width = '50px';
                componentElement.style.height = '30px';
                componentElement.dataset.componentId = component.id;
                
                componentElement.innerHTML = `
                    <div class="w-full h-full rounded flex items-center justify-center text-white font-bold text-xs border-2 border-white/30" style="background-color: ${component.color}">
                        ${component.symbol}
                    </div>
                `;
                
                // Add connection points
                this.addComponentConnectionPoints(componentElement, component);
                
                // Add click to remove functionality
                componentElement.addEventListener('dblclick', () => {
                    this.removeComponent(component.id);
                });
                
                board.appendChild(componentElement);
                this.placedComponents.set(component.id, {
                    element: componentElement,
                    component: component,
                    position: { x, y },
                    connections: []
                });
                
                this.createSparkEffect(x, y);
                this.updateScore(10);
                
                // Show progressive hints based on how many components are placed
                if (this.placedComponents.size === 1) {
                    this.showMessage(`✅ วาง ${component.name} แล้ว! ขั้นตอนที่ 3: เลือกอุปกรณ์ชิ้นที่ 2`, 'success');
                } else if (this.placedComponents.size === 2) {
                    this.showMessage(`✅ วางครบ 2 ชิ้นแล้ว! ขั้นตอนที่ 4: กดค้างจุดทองแล้วลากเชื่อมสาย`, 'success');
                } else {
                    this.showMessage(`วาง ${component.name} เรียบร้อย! ดับเบิลคลิกเพื่อลบ`, 'success');
                }
                
                // Clear selection
                document.querySelectorAll('.component').forEach(el => {
                    el.classList.remove('border-4', 'border-yellow-400');
                });
                this.selectedComponent = null;
                
                this.checkObjectives();
            }
            
            removeComponent(componentId) {
                const componentData = this.placedComponents.get(componentId);
                if (componentData) {
                    componentData.element.remove();
                    this.placedComponents.delete(componentId);
                    this.showMessage('ลบอุปกรณ์แล้ว', 'warning');
                    this.updateScore(-5);
                }
            }
            
            addComponentConnectionPoints(element, component) {
                const connectionPoints = this.getComponentConnectionPoints(component);
                
                connectionPoints.forEach((point, index) => {
                    const connectionPoint = document.createElement('div');
                    connectionPoint.className = 'connection-point';
                    connectionPoint.style.left = `${point.x}px`;
                    connectionPoint.style.top = `${point.y}px`;
                    connectionPoint.dataset.componentId = component.id;
                    connectionPoint.dataset.pinIndex = index;
                    
                    connectionPoint.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        this.startDragConnection(e);
                    });
                    
                    connectionPoint.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.removeConnectionsFromPoint(e.target);
                    });
                    
                    element.appendChild(connectionPoint);
                });
            }
            
            getComponentConnectionPoints(component) {
                switch (component.type) {
                    case 'resistor':
                    case 'capacitor':
                    case 'diode':
                        return [
                            { x: -6, y: 12 },  // Left
                            { x: 44, y: 12 }   // Right
                        ];
                    case 'transistor':
                        return [
                            { x: 10, y: -6 },  // Collector
                            { x: -6, y: 12 },  // Base
                            { x: 10, y: 30 }   // Emitter
                        ];
                    case 'ic':
                        const points = [];
                        const pins = component.pins || 8;
                        for (let i = 0; i < pins / 2; i++) {
                            points.push({ x: -6, y: 5 + i * 5 });  // Left side
                            points.push({ x: 44, y: 5 + i * 5 }); // Right side
                        }
                        return points;
                    default:
                        return [
                            { x: -6, y: 12 },
                            { x: 44, y: 12 }
                        ];
                }
            }
            
            startDragConnection(e) {
                e.preventDefault();
                e.stopPropagation();
                
                // If right-click, remove connections
                if (e.button === 2) {
                    this.removeConnectionsFromPoint(e.target);
                    return;
                }
                
                this.isConnecting = true;
                this.connectionStart = e.target;
                this.dragLine = null;
                
                // Visual feedback for start point
                e.target.style.background = '#FF6347';
                e.target.style.transform = 'scale(1.8)';
                e.target.style.boxShadow = '0 0 20px #FF6347';
                e.target.style.border = '4px solid #FF0000';
                e.target.style.zIndex = '100';
                
                // Add mouse move and mouse up listeners
                document.addEventListener('mousemove', this.handleDragMove.bind(this));
                document.addEventListener('mouseup', this.handleDragEnd.bind(this));
                
                this.showMessage('กดค้างแล้วลากไปยังจุดที่ต้องการเชื่อม!', 'info');
            }
            
            handleDragMove(e) {
                if (!this.isConnecting || !this.connectionStart) return;
                
                // Remove old drag line
                if (this.dragLine) {
                    this.dragLine.remove();
                }
                
                // Create new drag line
                const svg = document.getElementById('connectionSvg');
                const board = document.getElementById('circuitBoard');
                const boardRect = board.getBoundingClientRect();
                
                const startRect = this.connectionStart.getBoundingClientRect();
                const x1 = startRect.left + startRect.width / 2 - boardRect.left;
                const y1 = startRect.top + startRect.height / 2 - boardRect.top;
                const x2 = e.clientX - boardRect.left;
                const y2 = e.clientY - boardRect.top;
                
                this.dragLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                this.dragLine.setAttribute('x1', x1);
                this.dragLine.setAttribute('y1', y1);
                this.dragLine.setAttribute('x2', x2);
                this.dragLine.setAttribute('y2', y2);
                this.dragLine.setAttribute('stroke', '#FF6347');
                this.dragLine.setAttribute('stroke-width', '3');
                this.dragLine.setAttribute('stroke-dasharray', '5,5');
                this.dragLine.style.pointerEvents = 'none';
                
                svg.appendChild(this.dragLine);
            }
            
            handleDragEnd(e) {
                if (!this.isConnecting) return;
                
                // Remove drag line
                if (this.dragLine) {
                    this.dragLine.remove();
                    this.dragLine = null;
                }
                
                // Find target connection point
                const target = document.elementFromPoint(e.clientX, e.clientY);
                
                if (target && target.classList.contains('connection-point') && target !== this.connectionStart) {
                    this.completeConnection(target);
                } else {
                    this.cancelConnection();
                    this.showMessage('ลากไปยังจุดสีทองเพื่อเชื่อมต่อ!', 'warning');
                }
                
                // Remove event listeners
                document.removeEventListener('mousemove', this.handleDragMove.bind(this));
                document.removeEventListener('mouseup', this.handleDragEnd.bind(this));
            }
            
            handleConnectionPointClick(e) {
                // Keep old method as backup
                e.stopPropagation();
                
                if (e.button === 2) {
                    this.removeConnectionsFromPoint(e.target);
                    return;
                }
                
                if (!this.isConnecting) {
                    this.startConnection(e.target);
                } else {
                    this.completeConnection(e.target);
                }
            }
            
            startConnection(point) {
                // Cancel any existing connection attempt
                this.cancelConnection();
                
                this.isConnecting = true;
                this.connectionStart = point;
                
                // Visual feedback for start point
                point.style.background = '#FF6347';
                point.style.transform = 'scale(1.8)';
                point.style.boxShadow = '0 0 20px #FF6347';
                point.style.border = '4px solid #FF0000';
                point.style.zIndex = '100';
                point.classList.add('connecting-start');
                
                this.showMessage('เลือกจุดแรกแล้ว! คลิกจุดที่สองเพื่อเชื่อมสาย', 'info');
            }
            
            completeConnection(endPoint) {
                if (this.connectionStart === endPoint) {
                    this.showMessage('ไม่สามารถเชื่อมจุดเดียวกันได้!', 'warning');
                    this.cancelConnection();
                    return;
                }
                
                // Check if connection already exists
                const existingConnection = this.connections.find(conn => 
                    (conn.start === this.connectionStart && conn.end === endPoint) ||
                    (conn.start === endPoint && conn.end === this.connectionStart)
                );
                
                if (existingConnection) {
                    this.showMessage('การเชื่อมต่อนี้มีอยู่แล้ว!', 'warning');
                    this.cancelConnection();
                    return;
                }
                
                // Create the wire connection - ALWAYS works now
                const wireElement = this.createWire(this.connectionStart, endPoint);
                const connectionId = `conn_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                this.connections.push({
                    start: this.connectionStart,
                    end: endPoint,
                    active: false,
                    id: connectionId,
                    wireElement: wireElement
                });
                
                // Visual feedback for both points - mark as connected
                [this.connectionStart, endPoint].forEach(point => {
                    point.classList.add('connected');
                    point.classList.remove('connecting-start');
                    point.style.background = '#32CD32';
                    point.style.boxShadow = '0 0 15px #32CD32';
                    point.style.border = '4px solid #00FF00';
                    point.style.transform = 'scale(1.4)';
                    point.style.zIndex = '50';
                });
                
                // Show progressive success messages
                if (this.connections.length === 1 && this.placedComponents.size >= 2) {
                    this.showMessage('🎉 เชื่อมสายสำเร็จ! ขั้นตอนที่ 5: กด "Run Simulation" เพื่อทดสอบ', 'success');
                } else {
                    this.showMessage('เชื่อมสายสำเร็จ! 🔗 ลองเชื่อมจุดอื่นต่อ', 'success');
                }
                
                // Get actual positions for spark effect
                const startRect = this.connectionStart.getBoundingClientRect();
                const endRect = endPoint.getBoundingClientRect();
                const boardRect = document.getElementById('circuitBoard').getBoundingClientRect();
                
                const sparkX = ((startRect.left + startRect.width/2) + (endRect.left + endRect.width/2))/2 - boardRect.left;
                const sparkY = ((startRect.top + startRect.height/2) + (endRect.top + endRect.height/2))/2 - boardRect.top;
                
                this.createSparkEffect(sparkX, sparkY);
                
                this.cancelConnection();
                this.updateCircuitAnalysis();
                this.updateScore(20);
                
                // Auto-check if we can play music - much easier requirements
                if (this.connections.length >= 1 && this.placedComponents.size >= 2) {
                    setTimeout(() => {
                        this.showMessage('🎵 วงจรพร้อมแล้ว! ลองกด "Run Simulation" แล้วกด "Play Symphony"', 'success');
                    }, 1000);
                }
            }
            
            removeConnectionsFromPoint(point) {
                // Find and remove all connections involving this point
                const connectionsToRemove = this.connections.filter(conn => 
                    conn.start === point || conn.end === point
                );
                
                connectionsToRemove.forEach(conn => {
                    // Remove wire element
                    if (conn.wireElement) {
                        conn.wireElement.remove();
                    }
                    
                    // Reset visual state of connected points
                    [conn.start, conn.end].forEach(p => {
                        p.classList.remove('connected');
                        p.style.background = '#FFD700';
                        p.style.border = '2px solid #FFA500';
                        p.style.transform = 'scale(1)';
                        p.style.boxShadow = '';
                        p.style.zIndex = '10';
                    });
                    
                    // Remove from connections array
                    const index = this.connections.indexOf(conn);
                    if (index > -1) {
                        this.connections.splice(index, 1);
                    }
                });
                
                if (connectionsToRemove.length > 0) {
                    this.showMessage(`ลบการเชื่อมต่อ ${connectionsToRemove.length} เส้น`, 'warning');
                    this.updateScore(-10);
                    this.updateCircuitAnalysis();
                }
            }
            
            cancelConnection() {
                if (this.connectionStart) {
                    this.connectionStart.classList.remove('connecting-start');
                    
                    // Reset start point if it wasn't already connected
                    if (!this.connectionStart.classList.contains('connected')) {
                        this.connectionStart.style.background = '#FFD700';
                        this.connectionStart.style.border = '2px solid #FFA500';
                        this.connectionStart.style.transform = 'scale(1)';
                        this.connectionStart.style.boxShadow = '';
                        this.connectionStart.style.zIndex = '10';
                    } else {
                        // Reset to connected state
                        this.connectionStart.style.background = '#32CD32';
                        this.connectionStart.style.border = '4px solid #00FF00';
                        this.connectionStart.style.transform = 'scale(1.4)';
                        this.connectionStart.style.boxShadow = '0 0 15px #32CD32';
                        this.connectionStart.style.zIndex = '50';
                    }
                }
                
                // Clean up drag connection
                if (this.dragLine) {
                    this.dragLine.remove();
                    this.dragLine = null;
                }
                
                this.isConnecting = false;
                this.connectionStart = null;
            }
            
            createWire(startPoint, endPoint) {
                const svg = document.getElementById('connectionSvg');
                const board = document.getElementById('circuitBoard');
                const boardRect = board.getBoundingClientRect();
                
                // Get positions relative to the circuit board
                const startRect = startPoint.getBoundingClientRect();
                const endRect = endPoint.getBoundingClientRect();
                
                const x1 = startRect.left + startRect.width / 2 - boardRect.left;
                const y1 = startRect.top + startRect.height / 2 - boardRect.top;
                const x2 = endRect.left + endRect.width / 2 - boardRect.left;
                const y2 = endRect.top + endRect.height / 2 - boardRect.top;
                
                const wire = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                
                // Create smooth curved wire path
                const midX = (x1 + x2) / 2;
                const midY = (y1 + y2) / 2;
                const controlOffset = Math.abs(x2 - x1) > Math.abs(y2 - y1) ? 
                    Math.min(30, Math.abs(y2 - y1) / 2) : 
                    Math.min(30, Math.abs(x2 - x1) / 2);
                
                const d = `M ${x1} ${y1} Q ${midX} ${midY - controlOffset} ${x2} ${y2}`;
                wire.setAttribute('d', d);
                wire.setAttribute('stroke', '#FFD700');
                wire.setAttribute('stroke-width', '4');
                wire.setAttribute('fill', 'none');
                wire.setAttribute('stroke-linecap', 'round');
                wire.className = 'wire';
                
                // Add glow effect
                wire.style.filter = 'drop-shadow(0 0 6px #FFD700)';
                
                svg.appendChild(wire);
                
                return wire;
            }
            
            createSparkEffect(x, y) {
                const board = document.getElementById('circuitBoard');
                const spark = document.createElement('div');
                spark.className = 'spark-effect';
                spark.style.left = `${x - 10}px`;
                spark.style.top = `${y - 10}px`;
                
                board.appendChild(spark);
                
                setTimeout(() => {
                    spark.remove();
                }, 500);
            }
            
            togglePower() {
                this.isPowerOn = !this.isPowerOn;
                const button = document.getElementById('powerButton');
                
                if (this.isPowerOn) {
                    button.textContent = '🟢 Power ON';
                    button.className = 'bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors';
                    this.activateCircuit();
                } else {
                    button.textContent = '🔴 Power OFF';
                    button.className = 'bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors';
                    this.deactivateCircuit();
                }
            }
            
            activateCircuit() {
                // Animate wires
                this.connections.forEach(connection => {
                    if (connection.wireElement) {
                        connection.wireElement.classList.add('active');
                        connection.active = true;
                    }
                });
                
                // Start voltage ripples
                this.startVoltageRipples();
                
                // Update measurements
                this.updateCircuitAnalysis();
                
                // Show play music button if circuit is complete
                if (this.isCircuitComplete()) {
                    document.getElementById('playMusicBtn').classList.remove('hidden');
                }
            }
            
            deactivateCircuit() {
                this.connections.forEach(connection => {
                    if (connection.wireElement) {
                        connection.wireElement.classList.remove('active');
                        connection.active = false;
                    }
                });
                
                this.stopVoltageRipples();
                document.getElementById('playMusicBtn').classList.add('hidden');
            }
            
            startVoltageRipples() {
                this.placedComponents.forEach((data, id) => {
                    if (data.component.type === 'battery' || data.component.type === 'power') {
                        this.createVoltageRipple(data.position.x, data.position.y);
                    }
                });
            }
            
            createVoltageRipple(x, y) {
                const board = document.getElementById('circuitBoard');
                const ripple = document.createElement('div');
                ripple.className = 'voltage-ripple';
                ripple.style.left = `${x - 25}px`;
                ripple.style.top = `${y - 25}px`;
                
                board.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 1000);
            }
            
            stopVoltageRipples() {
                document.querySelectorAll('.voltage-ripple').forEach(ripple => {
                    ripple.remove();
                });
            }
            
            analyzeCircuit() {
                if (!this.isPowerOn) {
                    this.showError('Please turn on power first!');
                    return;
                }
                
                this.performCircuitAnalysis();
                this.showAnalysisModal();
            }
            
            performCircuitAnalysis() {
                const voltage = parseFloat(document.getElementById('voltageSlider').value);
                const current = parseFloat(document.getElementById('currentSlider').value);
                
                // Calculate circuit parameters
                const totalResistance = this.calculateTotalResistance();
                const totalCurrent = voltage / totalResistance * 1000; // mA
                const powerConsumption = voltage * totalCurrent / 1000; // mW
                const efficiency = Math.min(95, (powerConsumption / (voltage * current / 1000)) * 100);
                
                // Update displays
                document.getElementById('totalResistance').textContent = `${totalResistance.toFixed(1)} Ω`;
                document.getElementById('totalCurrent').textContent = `${totalCurrent.toFixed(2)} mA`;
                document.getElementById('powerConsumption').textContent = `${powerConsumption.toFixed(2)} mW`;
                document.getElementById('efficiency').textContent = `${efficiency.toFixed(1)}%`;
                
                // Update multimeter
                document.getElementById('voltageReading').textContent = `${voltage.toFixed(2)}V`;
                document.getElementById('currentReading').textContent = `${totalCurrent.toFixed(2)}mA`;
                
                // Store analysis data
                this.analysisData = {
                    voltage,
                    current: totalCurrent,
                    resistance: totalResistance,
                    power: powerConsumption,
                    efficiency
                };
                
                this.updateCircuitStatus();
            }
            
            calculateTotalResistance() {
                let totalResistance = 0;
                
                this.placedComponents.forEach((data, id) => {
                    if (data.component.type === 'resistor') {
                        totalResistance += data.component.value;
                    }
                });
                
                return Math.max(totalResistance, 100); // Minimum 100Ω
            }
            
            updateCircuitStatus() {
                const status = document.getElementById('circuitStatus');
                
                if (this.isCircuitComplete()) {
                    status.innerHTML = '<div class="text-green-400">✅ Circuit Complete & Functional</div>';
                    status.classList.add('success-glow');
                } else if (this.placedComponents.size > 0) {
                    status.innerHTML = '<div class="text-yellow-400">⚠️ Circuit Incomplete</div>';
                } else {
                    status.innerHTML = '<div class="text-gray-400">⏳ Ready for components</div>';
                }
            }
            
            isCircuitComplete() {
                // Super easy requirements for level 1
                if (this.currentLevel === 1) {
                    let hasComponents = this.placedComponents.size >= 2;
                    let hasConnections = this.connections.length >= 1;
                    return hasComponents && hasConnections;
                }
                
                // Normal requirements for other levels
                let hasComponents = this.placedComponents.size >= 2;
                let hasConnections = this.connections.length >= 2;
                
                return hasComponents && hasConnections && this.isPowerOn;
            }
            
            simulateCircuit() {
                // Make simulation work even without power for easier gameplay
                if (this.placedComponents.size === 0) {
                    this.showError('วางอุปกรณ์ก่อนนะ!');
                    return;
                }
                
                // Auto turn on power if not on
                if (!this.isPowerOn) {
                    this.togglePower();
                    this.showMessage('เปิดไฟอัตโนมัติแล้ว!', 'info');
                }
                
                this.performCircuitAnalysis();
                this.startSimulation();
                
                // Show music button immediately if circuit has components
                if (this.placedComponents.size >= 1) {
                    document.getElementById('playMusicBtn').classList.remove('hidden');
                    this.showMessage('🎵 ตอนนี้กดปุ่ม "Play Symphony" ได้แล้ว!', 'success');
                }
            }
            
            startSimulation() {
                // Animate current flow
                this.animateCurrentFlow();
                
                // Update oscilloscope
                this.updateOscilloscope();
                
                // Update spectrum analyzer
                this.updateSpectrumAnalyzer();
                
                // Show voltage indicators
                this.showVoltageIndicators();
                
                this.updateScore(50);
            }
            
            animateCurrentFlow() {
                this.connections.forEach((connection, index) => {
                    setTimeout(() => {
                        if (connection.wireElement) {
                            connection.wireElement.style.strokeDasharray = '10 5';
                            connection.wireElement.style.strokeDashoffset = '0';
                            connection.wireElement.style.animation = 'wireFlow 1s infinite linear';
                        }
                    }, index * 200);
                });
            }
            
            showVoltageIndicators() {
                const container = document.getElementById('voltageIndicators');
                container.innerHTML = '';
                
                this.placedComponents.forEach((data, id) => {
                    const voltage = this.calculateNodeVoltage(data);
                    const indicator = document.createElement('div');
                    indicator.className = 'node-voltage';
                    indicator.style.left = `${data.position.x + 25}px`;
                    indicator.style.top = `${data.position.y - 20}px`;
                    indicator.textContent = `${voltage.toFixed(1)}V`;
                    
                    container.appendChild(indicator);
                });
            }
            
            calculateNodeVoltage(componentData) {
                const baseVoltage = parseFloat(document.getElementById('voltageSlider').value);
                const random = (Math.random() - 0.5) * 0.5; // ±0.25V variation
                
                switch (componentData.component.type) {
                    case 'battery':
                        return componentData.component.voltage;
                    case 'resistor':
                        return baseVoltage * 0.7 + random;
                    case 'led':
                        return 2.1 + random;
                    default:
                        return baseVoltage * 0.5 + random;
                }
            }
            
            updateOscilloscope() {
                const waveform = document.getElementById('waveform');
                const frequency = parseFloat(document.getElementById('frequencySlider').value);
                const amplitude = parseFloat(document.getElementById('amplitudeSlider').value);
                const waveType = document.getElementById('waveformType').value;
                
                let path = 'M 0 64';
                const points = 200;
                const width = 300;
                
                for (let i = 0; i <= points; i++) {
                    const x = (i / points) * width;
                    const t = (i / points) * 4 * Math.PI;
                    let y = 64;
                    
                    switch (waveType) {
                        case 'sine':
                            y = 64 - (Math.sin(t * frequency / 100) * amplitude * 5);
                            break;
                        case 'square':
                            y = 64 - (Math.sign(Math.sin(t * frequency / 100)) * amplitude * 5);
                            break;
                        case 'triangle':
                            y = 64 - ((2 / Math.PI) * Math.asin(Math.sin(t * frequency / 100)) * amplitude * 5);
                            break;
                        case 'sawtooth':
                            y = 64 - (((t * frequency / 100) % (2 * Math.PI) - Math.PI) / Math.PI * amplitude * 5);
                            break;
                    }
                    
                    path += ` L ${x} ${y}`;
                }
                
                waveform.setAttribute('d', path);
            }
            
            updateWaveform() {
                this.updateOscilloscope();
            }
            
            startSpectrumAnalyzer() {
                setInterval(() => {
                    this.updateSpectrumAnalyzer();
                }, 100);
            }
            
            updateSpectrumAnalyzer() {
                const bars = document.querySelectorAll('.spectrum-bar');
                bars.forEach((bar, index) => {
                    const height = Math.random() * 80 + 20;
                    bar.style.height = `${height}%`;
                });
                
                // Update peak frequency
                const frequency = 440 + Math.random() * 200;
                document.getElementById('peakFrequency').textContent = `${frequency.toFixed(0)} Hz`;
                
                // Update THD
                const thd = Math.random() * 5;
                document.getElementById('thd').textContent = `${thd.toFixed(1)}%`;
            }
            
            playCircuitMusic() {
                // Make music work with just 1 component for easier gameplay
                if (this.placedComponents.size === 0) {
                    this.showError('วางอุปกรณ์ก่อนนะ!');
                    return;
                }
                
                this.generateCircuitSymphony();
                this.showSuccessModal();
            }
            
            generateCircuitSymphony() {
                // Create musical notes based on circuit components
                const notes = [];
                this.placedComponents.forEach((data, id) => {
                    if (data.component.sound) {
                        notes.push(data.component.sound);
                    }
                });
                
                // Simulate playing music with visual effects
                this.createMusicalNotes();
                this.createSuccessParticles();
                
                // Update score based on circuit complexity
                const complexityBonus = this.calculateComplexityBonus();
                this.updateScore(complexityBonus);
            }
            
            createMusicalNotes() {
                const board = document.getElementById('circuitBoard');
                const notes = ['🎵', '🎶', '♪', '♫', '🎼'];
                
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const note = document.createElement('div');
                        note.textContent = notes[Math.floor(Math.random() * notes.length)];
                        note.className = 'absolute text-3xl text-yellow-400 pointer-events-none';
                        note.style.left = Math.random() * 80 + '%';
                        note.style.top = Math.random() * 80 + '%';
                        note.style.animation = 'sparkAnimation 3s ease-out forwards';
                        
                        board.appendChild(note);
                        
                        setTimeout(() => note.remove(), 3000);
                    }, i * 150);
                }
            }
            
            createSuccessParticles() {
                const burst = document.querySelector('.success-burst');
                if (!burst) return;
                
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'success-particle';
                    
                    const angle = (i / 20) * 2 * Math.PI;
                    const distance = 100 + Math.random() * 100;
                    const dx = Math.cos(angle) * distance;
                    const dy = Math.sin(angle) * distance;
                    
                    particle.style.setProperty('--dx', `${dx}px`);
                    particle.style.setProperty('--dy', `${dy}px`);
                    particle.style.left = '50%';
                    particle.style.top = '50%';
                    
                    burst.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 2000);
                }
            }
            
            calculateComplexityBonus() {
                let bonus = 0;
                
                // Component variety bonus
                const componentTypes = new Set();
                this.placedComponents.forEach((data, id) => {
                    componentTypes.add(data.component.type);
                });
                bonus += componentTypes.size * 20;
                
                // Connection bonus
                bonus += this.connections.length * 10;
                
                // Efficiency bonus
                if (this.analysisData.efficiency > 80) {
                    bonus += 50;
                }
                
                return bonus;
            }
            
            checkObjectives() {
                const levelData = this.gameData[this.currentLevel];
                // Implementation for checking level objectives
                // This would check if the player has met the specific requirements for the current level
            }
            
            showAnalysisModal() {
                const modal = document.getElementById('analysisModal');
                
                // Populate analysis data
                document.getElementById('nodeVoltages').innerHTML = this.generateNodeVoltageReport();
                document.getElementById('branchCurrents').innerHTML = this.generateCurrentReport();
                document.getElementById('powerDistribution').innerHTML = this.generatePowerReport();
                document.getElementById('harmonicContent').innerHTML = this.generateHarmonicReport();
                document.getElementById('musicalKey').innerHTML = this.generateMusicalKeyReport();
                document.getElementById('rhythmPattern').innerHTML = this.generateRhythmReport();
                
                modal.classList.remove('hidden');
            }
            
            generateNodeVoltageReport() {
                let report = '';
                this.placedComponents.forEach((data, id) => {
                    const voltage = this.calculateNodeVoltage(data);
                    report += `${data.component.symbol}: ${voltage.toFixed(2)}V<br>`;
                });
                return report || 'No components placed';
            }
            
            generateCurrentReport() {
                let report = '';
                this.connections.forEach((connection, index) => {
                    const current = (Math.random() * 50 + 10).toFixed(2);
                    report += `Branch ${index + 1}: ${current}mA<br>`;
                });
                return report || 'No connections made';
            }
            
            generatePowerReport() {
                let report = '';
                this.placedComponents.forEach((data, id) => {
                    const power = (Math.random() * 100 + 10).toFixed(2);
                    report += `${data.component.symbol}: ${power}mW<br>`;
                });
                return report || 'No power consumption';
            }
            
            generateHarmonicReport() {
                const harmonics = ['Fundamental: 440Hz', '2nd Harmonic: 880Hz', '3rd Harmonic: 1320Hz'];
                return harmonics.join('<br>');
            }
            
            generateMusicalKeyReport() {
                const levelData = this.gameData[this.currentLevel];
                return `Key: ${levelData.musicalKey}<br>Tempo: 120 BPM<br>Time Signature: 4/4`;
            }
            
            generateRhythmReport() {
                return 'Pattern: Quarter-Quarter-Half<br>Syncopation: Moderate<br>Complexity: Advanced';
            }
            
            closeAnalysisModal() {
                document.getElementById('analysisModal').classList.add('hidden');
            }
            
            exportAnalysis() {
                const analysisData = {
                    level: this.currentLevel,
                    score: this.score,
                    components: Array.from(this.placedComponents.keys()),
                    connections: this.connections.length,
                    analysis: this.analysisData,
                    timestamp: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(analysisData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `circuit_analysis_level_${this.currentLevel}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
            }
            
            showSuccessModal() {
                const modal = document.getElementById('successModal');
                const message = document.getElementById('successMessage');
                const metrics = document.getElementById('performanceMetrics');
                
                const levelData = this.gameData[this.currentLevel];
                message.textContent = `You've completed ${levelData.title}!`;
                
                metrics.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="text-gray-300">Components Used:</div>
                            <div class="text-white font-bold">${this.placedComponents.size}</div>
                        </div>
                        <div>
                            <div class="text-gray-300">Connections Made:</div>
                            <div class="text-white font-bold">${this.connections.length}</div>
                        </div>
                        <div>
                            <div class="text-gray-300">Circuit Efficiency:</div>
                            <div class="text-white font-bold">${this.analysisData.efficiency?.toFixed(1) || 0}%</div>
                        </div>
                        <div>
                            <div class="text-gray-300">Musical Harmony:</div>
                            <div class="text-white font-bold">Perfect</div>
                        </div>
                    </div>
                `;
                
                // Show/hide next level button
                const nextBtn = document.getElementById('nextLevelBtn');
                if (this.currentLevel < 3) {
                    nextBtn.classList.remove('hidden');
                } else {
                    nextBtn.classList.add('hidden');
                    setTimeout(() => this.showGameCompleteModal(), 2000);
                }
                
                modal.classList.remove('hidden');
            }
            
            closeSuccessModal() {
                document.getElementById('successModal').classList.add('hidden');
            }
            
            nextLevel() {
                this.closeSuccessModal();
                if (this.currentLevel < 3) {
                    this.loadLevel(this.currentLevel + 1);
                }
            }
            
            showGameCompleteModal() {
                this.closeSuccessModal();
                const modal = document.getElementById('gameCompleteModal');
                const finalScore = document.getElementById('finalScoreDisplay');
                const rating = document.getElementById('engineerRating');
                const achievements = document.getElementById('achievements');
                
                finalScore.textContent = `Final Score: ${this.score} points`;
                
                let engineerLevel = '';
                if (this.score >= 800) {
                    engineerLevel = '🏆 Master Circuit Composer - You have achieved the highest level of electronic artistry!';
                } else if (this.score >= 600) {
                    engineerLevel = '🥈 Advanced Circuit Designer - Your skills are impressive and professional-grade!';
                } else if (this.score >= 400) {
                    engineerLevel = '🥉 Competent Electronics Engineer - You have solid fundamentals and good potential!';
                } else {
                    engineerLevel = '📚 Aspiring Circuit Builder - Keep practicing to improve your skills!';
                }
                
                rating.innerHTML = `
                    <div class="text-xl font-bold text-white mb-4">${engineerLevel}</div>
                    <div class="text-gray-300">
                        You've demonstrated proficiency in circuit design, component selection, 
                        and musical synthesis. Your understanding of electronics principles 
                        combined with creative problem-solving makes you a valuable engineer!
                    </div>
                `;
                
                // Show achievements
                const achievementList = [
                    { icon: '⚡', name: 'Power Master', description: 'Successfully powered all circuits' },
                    { icon: '🔗', name: 'Connection Expert', description: 'Made perfect wire connections' },
                    { icon: '🎵', name: 'Symphony Creator', description: 'Generated beautiful circuit music' },
                    { icon: '🔬', name: 'Analysis Pro', description: 'Performed detailed circuit analysis' }
                ];
                
                achievements.innerHTML = achievementList.map(achievement => `
                    <div class="bg-black/30 p-3 rounded-lg text-center">
                        <div class="text-2xl mb-1">${achievement.icon}</div>
                        <div class="text-white font-semibold text-sm">${achievement.name}</div>
                        <div class="text-gray-400 text-xs">${achievement.description}</div>
                    </div>
                `).join('');
                
                modal.classList.remove('hidden');
            }
            
            restartGame() {
                document.getElementById('gameCompleteModal').classList.add('hidden');
                this.currentLevel = 1;
                this.score = 0;
                this.placedComponents.clear();
                this.connections = [];
                this.isPowerOn = false;
                this.loadLevel(1);
            }
            
            resetCircuit() {
                // Clear placed components
                this.placedComponents.forEach((data, id) => {
                    data.element.remove();
                });
                this.placedComponents.clear();
                
                // Clear connections
                document.getElementById('connectionSvg').innerHTML = '';
                this.connections = [];
                
                // Reset connection points
                document.querySelectorAll('.connection-point').forEach(point => {
                    point.classList.remove('connected');
                    point.style.background = '#FFD700';
                    point.style.transform = 'scale(1)';
                });
                
                // Clear indicators
                document.getElementById('voltageIndicators').innerHTML = '';
                document.getElementById('currentIndicators').innerHTML = '';
                
                // Reset power
                this.isPowerOn = false;
                document.getElementById('powerButton').textContent = '🔴 Power OFF';
                document.getElementById('powerButton').className = 'bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors';
                
                // Hide music button
                document.getElementById('playMusicBtn').classList.add('hidden');
                
                this.updateCircuitStatus();
            }
            
            updateScore(points) {
                this.score += points;
                document.getElementById('score').textContent = this.score;
                
                // Animate score update
                const scoreElement = document.getElementById('score');
                scoreElement.style.transform = 'scale(1.2)';
                scoreElement.style.color = '#FFD700';
                
                setTimeout(() => {
                    scoreElement.style.transform = 'scale(1)';
                    scoreElement.style.color = 'black';
                }, 300);
            }
            
            updateUI() {
                this.updateCircuitStatus();
                document.getElementById('score').textContent = this.score;
                document.getElementById('currentLevelDisplay').textContent = this.currentLevel;
            }
            
            showMenu() {
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('mainMenu').classList.remove('hidden');
            }
            
            showError(message) {
                this.showMessage(message, 'error');
            }
            
            showMessage(message, type = 'info') {
                const messageDiv = document.createElement('div');
                let bgColor = 'bg-blue-600';
                
                switch(type) {
                    case 'error': bgColor = 'bg-red-600'; break;
                    case 'success': bgColor = 'bg-green-600'; break;
                    case 'warning': bgColor = 'bg-yellow-600'; break;
                    default: bgColor = 'bg-blue-600';
                }
                
                messageDiv.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg z-50 transform translate-x-full transition-transform duration-300`;
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                // Animate in
                setTimeout(() => {
                    messageDiv.style.transform = 'translateX(0)';
                }, 10);
                
                // Animate out and remove
                setTimeout(() => {
                    messageDiv.style.transform = 'translateX(100%)';
                    setTimeout(() => messageDiv.remove(), 300);
                }, 3000);
            }
            
            showHints() {
                const modal = document.getElementById('hintsModal');
                const content = document.getElementById('hintsContent');
                const levelData = this.gameData[this.currentLevel];
                
                let hintsHTML = '';
                
                if (this.currentLevel === 1) {
                    hintsHTML = `
                        <div class="bg-green-900/30 rounded-xl p-6 border border-green-400/30">
                            <h4 class="text-xl font-bold text-green-300 mb-4">🟢 ด่าน 1: วงจร LED พื้นฐาน</h4>
                            <div class="space-y-4">
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 1: วาง Battery</div>
                                    <div class="text-white">คลิกที่ "9V Battery" ในกล่องด้านซ้าย แล้วคลิกวางที่บอร์ดสีเขียว</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 2: วาง Resistor</div>
                                    <div class="text-white">เลือก "1kΩ Resistor" แล้ววางข้างๆ Battery</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 3: วาง LED</div>
                                    <div class="text-white">เลือก "Red LED" แล้ววางต่อจาก Resistor</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 4: เชื่อมสาย</div>
                                    <div class="text-white">กดค้างจุดสีทองของ Battery แล้วลากไป Resistor → LED → กลับไปที่ Battery</div>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-green-800/30 rounded-lg">
                                <div class="text-green-300 font-bold">🎯 เป้าหมาย: ต้องมีการเชื่อมต่ออย่างน้อย 3 จุด และเปิดไฟได้</div>
                            </div>
                        </div>
                    `;
                } else if (this.currentLevel === 2) {
                    hintsHTML = `
                        <div class="bg-orange-900/30 rounded-xl p-6 border border-orange-400/30">
                            <h4 class="text-xl font-bold text-orange-300 mb-4">🟡 ด่าน 2: วงจรขยายสัญญาณ</h4>
                            <div class="space-y-4">
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 1: วาง Op-Amp</div>
                                    <div class="text-white">เลือก "LM741 Op-Amp" เป็นหัวใจของวงจร</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 2: เพิ่ม Transistor</div>
                                    <div class="text-white">วาง "2N2222 NPN" เพื่อควบคุมกระแส</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 3: ใส่ Capacitor</div>
                                    <div class="text-white">เพิ่ม Capacitor เพื่อกรองสัญญาณ</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 4: สร้าง Feedback</div>
                                    <div class="text-white">เชื่อม Output กลับไปที่ Input เพื่อควบคุมการขยาย</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (this.currentLevel === 3) {
                    hintsHTML = `
                        <div class="bg-red-900/30 rounded-xl p-6 border border-red-400/30">
                            <h4 class="text-xl font-bold text-red-300 mb-4">🔴 ด่าน 3: ระบบเสียงครบวงจร</h4>
                            <div class="space-y-4">
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 1: สร้างสัญญาณ</div>
                                    <div class="text-white">ใช้ "555 Timer IC" สร้างสัญญาณพื้นฐาน</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 2: ขยายสัญญาณ</div>
                                    <div class="text-white">ใช้ "LM386 Audio Amp" ขยายสัญญาณให้แรงขึ้น</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 3: จับคู่สัญญาณ</div>
                                    <div class="text-white">ใช้ "Audio Transformer" จับคู่ impedance</div>
                                </div>
                                <div class="bg-black/30 p-4 rounded-lg">
                                    <div class="text-yellow-400 font-bold mb-2">ขั้นตอนที่ 4: Output เสียง</div>
                                    <div class="text-white">เชื่อม "8Ω Speaker" เป็นตัวออกเสียง</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // Add current progress hints
                const progressHints = this.generateProgressHints();
                if (progressHints) {
                    hintsHTML += progressHints;
                }
                
                content.innerHTML = hintsHTML;
                modal.classList.remove('hidden');
            }
            
            generateProgressHints() {
                let hints = '';
                
                if (this.placedComponents.size === 0) {
                    hints = `
                        <div class="bg-blue-900/30 rounded-xl p-4 border border-blue-400/30">
                            <div class="text-blue-300 font-bold mb-2">🚀 เริ่มต้น:</div>
                            <div class="text-white">คลิกที่อุปกรณ์ในกล่อง "Component Library" ด้านซ้ายก่อน!</div>
                        </div>
                    `;
                } else if (this.connections.length === 0) {
                    hints = `
                        <div class="bg-purple-900/30 rounded-xl p-4 border border-purple-400/30">
                            <div class="text-purple-300 font-bold mb-2">🔗 ขั้นตอนต่อไป:</div>
                            <div class="text-white">กดค้างจุดสีทองแล้วลากไปยังจุดอื่นเพื่อเชื่อมสายไฟ!</div>
                        </div>
                    `;
                } else if (!this.isPowerOn) {
                    hints = `
                        <div class="bg-yellow-900/30 rounded-xl p-4 border border-yellow-400/30">
                            <div class="text-yellow-300 font-bold mb-2">⚡ เกือบเสร็จแล้ว:</div>
                            <div class="text-white">กดปุ่ม "Power ON" สีแดงด้านบนเพื่อเปิดไฟ!</div>
                        </div>
                    `;
                } else if (this.isCircuitComplete()) {
                    hints = `
                        <div class="bg-green-900/30 rounded-xl p-4 border border-green-400/30">
                            <div class="text-green-300 font-bold mb-2">🎉 เสร็จสมบูรณ์:</div>
                            <div class="text-white">กด "Run Simulation" แล้วกด "Play Symphony" เพื่อฟังเพลง!</div>
                        </div>
                    `;
                }
                
                return hints;
            }
            
            showTooltip(element, text) {
                const tooltip = document.getElementById('tooltip');
                tooltip.textContent = text;
                tooltip.classList.add('show');
                
                const rect = element.getBoundingClientRect();
                tooltip.style.left = `${rect.left + rect.width / 2}px`;
                tooltip.style.top = `${rect.top - 40}px`;
                tooltip.style.transform = 'translateX(-50%)';
            }
            
            hideTooltip() {
                document.getElementById('tooltip').classList.remove('show');
            }
            
            setMultimeterMode(mode) {
                this.multimeterMode = mode;
                // Update multimeter display based on mode
                this.updateCircuitAnalysis();
            }
            
            toggleGrid() {
                // Toggle grid visibility on PCB board
                const board = document.getElementById('circuitBoard');
                board.classList.toggle('show-grid');
            }
            
            autoRoute() {
                // Implement automatic routing algorithm
                this.showError('Auto-routing feature coming soon!');
            }
            
            updateCircuitAnalysis() {
                if (this.isPowerOn && this.placedComponents.size > 0) {
                    this.performCircuitAnalysis();
                }
            }
            
            handleBreadboardClick(e) {
                if (this.selectedComponent && !e.target.classList.contains('breadboard-component')) {
                    const rect = e.currentTarget.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    this.placeBreadboardComponent(this.selectedComponent, x, y);
                }
            }
            
            placeBreadboardComponent(component, x, y) {
                const breadboard = document.getElementById('breadboard');
                
                // Clear placeholder text if it exists
                const placeholder = breadboard.querySelector('.text-center');
                if (placeholder) {
                    placeholder.remove();
                }
                
                const componentElement = document.createElement('div');
                componentElement.className = `breadboard-component absolute cursor-pointer hover:scale-110 transition-transform ${component.type}`;
                componentElement.style.left = `${x - 20}px`;
                componentElement.style.top = `${y - 10}px`;
                componentElement.style.width = '40px';
                componentElement.style.height = '20px';
                componentElement.dataset.componentId = component.id;
                
                componentElement.innerHTML = `
                    <div class="w-full h-full rounded flex items-center justify-center text-white font-bold text-xs border border-white/50" style="background-color: ${component.color}">
                        ${component.symbol}
                    </div>
                `;
                
                // Add connection points for breadboard
                this.addBreadboardConnectionPoints(componentElement, component);
                
                // Add remove functionality
                componentElement.addEventListener('dblclick', () => {
                    componentElement.remove();
                    this.showMessage('ลบอุปกรณ์จาก Breadboard แล้ว', 'warning');
                });
                
                breadboard.appendChild(componentElement);
                
                this.createSparkEffect(x, y);
                this.updateScore(5);
                this.showMessage(`วาง ${component.name} บน Breadboard แล้ว!`, 'success');
                
                // Clear selection
                document.querySelectorAll('.component').forEach(el => {
                    el.classList.remove('border-4', 'border-yellow-400');
                });
                this.selectedComponent = null;
            }
            
            addBreadboardConnectionPoints(element, component) {
                // Add simple connection points for breadboard components
                const points = [
                    { x: -4, y: 8 },   // Left
                    { x: 36, y: 8 }    // Right
                ];
                
                points.forEach((point, index) => {
                    const connectionPoint = document.createElement('div');
                    connectionPoint.className = 'connection-point';
                    connectionPoint.style.left = `${point.x}px`;
                    connectionPoint.style.top = `${point.y}px`;
                    connectionPoint.style.width = '8px';
                    connectionPoint.style.height = '8px';
                    connectionPoint.dataset.componentId = component.id;
                    connectionPoint.dataset.pinIndex = index;
                    connectionPoint.dataset.breadboard = 'true';
                    
                    connectionPoint.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        this.startDragConnection(e);
                    });
                    
                    element.appendChild(connectionPoint);
                });
            }
        }
        
        // Global functions for HTML event handlers
        let game;
        
        function startGame() {
            game.startGame();
        }
        
        function startLevel(level) {
            game.startGame();
            game.loadLevel(level);
        }
        
        function showInstructions() {
            document.getElementById('instructionsModal').classList.remove('hidden');
        }
        
        function closeInstructions() {
            document.getElementById('instructionsModal').classList.add('hidden');
        }
        
        function showQuickGuide() {
            // Create quick guide modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gradient-to-br from-orange-900 to-red-900 rounded-3xl p-8 max-w-2xl w-full mx-4 border border-orange-400 modal-enter">
                    <div class="text-center">
                        <div class="text-6xl mb-4">⚡</div>
                        <h3 class="text-3xl font-bold text-white mb-4">เริ่มเล่นด่วน!</h3>
                        <p class="text-xl text-orange-300 mb-6">แค่ 6 ขั้นตอนง่ายๆ เล่นได้เลย!</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-black/30 p-4 rounded-lg">
                                <div class="text-2xl mb-2">1️⃣</div>
                                <div class="text-white font-bold">คลิกอุปกรณ์</div>
                                <div class="text-gray-300 text-sm">จากกล่องด้านซ้าย</div>
                            </div>
                            <div class="bg-black/30 p-4 rounded-lg">
                                <div class="text-2xl mb-2">2️⃣</div>
                                <div class="text-white font-bold">วางบนบอร์ด</div>
                                <div class="text-gray-300 text-sm">คลิกบอร์ดสีเขียว</div>
                            </div>
                            <div class="bg-black/30 p-4 rounded-lg">
                                <div class="text-2xl mb-2">3️⃣</div>
                                <div class="text-white font-bold">เชื่อมสาย</div>
                                <div class="text-gray-300 text-sm">กดค้างแล้วลากจุดทอง</div>
                            </div>
                            <div class="bg-black/30 p-4 rounded-lg">
                                <div class="text-2xl mb-2">4️⃣</div>
                                <div class="text-white font-bold">เปิดไฟ</div>
                                <div class="text-gray-300 text-sm">กดปุ่ม Power ON</div>
                            </div>
                            <div class="bg-black/30 p-4 rounded-lg">
                                <div class="text-2xl mb-2">5️⃣</div>
                                <div class="text-white font-bold">รันทดสอบ</div>
                                <div class="text-gray-300 text-sm">กด Run Simulation</div>
                            </div>
                            <div class="bg-black/30 p-4 rounded-lg">
                                <div class="text-2xl mb-2">6️⃣</div>
                                <div class="text-white font-bold">เล่นเพลง</div>
                                <div class="text-gray-300 text-sm">กด Play Symphony</div>
                            </div>
                        </div>
                        
                        <div class="bg-green-800/30 rounded-lg p-4 mb-6">
                            <div class="text-green-300 font-bold mb-2">💡 เคล็ดลับ:</div>
                            <div class="text-white text-sm">
                                • จุดทองจะเป็นสีแดงเมื่อคลิกครั้งแรก แล้วเป็นสีเขียวเมื่อเชื่อมสำเร็จ<br>
                                • คลิกขวาที่จุดใดก็ได้เพื่อลบการเชื่อมต่อ<br>
                                • ดับเบิลคลิกอุปกรณ์เพื่อลบออก
                            </div>
                        </div>
                        
                        <div class="flex justify-center space-x-4">
                            <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove(); startLevel(1);" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white px-8 py-3 rounded-lg font-bold text-lg">
                                🚀 เริ่มเล่นเลย!
                            </button>
                            <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove();" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                                ปิด
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function showHints() {
            if (game) {
                game.showHints();
            }
        }
        
        function closeHints() {
            document.getElementById('hintsModal').classList.add('hidden');
        }
        
        function showMenu() {
            game.showMenu();
        }
        
        function togglePower() {
            game.togglePower();
        }
        
        function resetCircuit() {
            game.resetCircuit();
        }
        
        function analyzeCircuit() {
            game.analyzeCircuit();
        }
        
        function simulateCircuit() {
            game.simulateCircuit();
        }
        
        function playCircuitMusic() {
            game.playCircuitMusic();
        }
        
        function closeAnalysisModal() {
            game.closeAnalysisModal();
        }
        
        function exportAnalysis() {
            game.exportAnalysis();
        }
        
        function closeSuccessModal() {
            game.closeSuccessModal();
        }
        
        function nextLevel() {
            game.nextLevel();
        }
        
        function restartGame() {
            game.restartGame();
        }
        
        function setMultimeterMode(mode) {
            game.setMultimeterMode(mode);
        }
        
        function toggleGrid() {
            game.toggleGrid();
        }
        
        function autoRoute() {
            game.autoRoute();
        }
        
        function skipLevel() {
            if (game.currentLevel < 3) {
                game.loadLevel(game.currentLevel + 1);
                game.showMessage(`ข้ามไปด่าน ${game.currentLevel} แล้ว!`, 'info');
            } else {
                game.showMessage('นี่คือด่านสุดท้ายแล้ว!', 'warning');
            }
        }
        
        function clearBreadboard() {
            const breadboard = document.getElementById('breadboard');
            breadboard.innerHTML = `
                <div class="text-center text-white/60 py-8">
                    <div class="text-2xl mb-2">🔌</div>
                    <div>คลิกเพื่อวางอุปกรณ์บน Breadboard</div>
                    <div class="text-sm mt-1">หรือลากอุปกรณ์มาวางที่นี่</div>
                </div>
            `;
            game.showMessage('ล้าง Breadboard แล้ว!', 'info');
        }
        
        function saveBreadboard() {
            game.showMessage('บันทึก Breadboard layout แล้ว!', 'success');
        }
        
        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            game = new CircuitSymphonyGame();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978d735732e77b50',t:'MTc1NjgyMDc1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
